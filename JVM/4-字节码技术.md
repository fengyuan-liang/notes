# å­—èŠ‚ç æŠ€æœ¯

è¿™é‡Œä¸»è¦å­¦ä¹ ï¼š

1. ç±»æ–‡ä»¶ç»“æ„ 2. å­—èŠ‚ç æŒ‡ä»¤ 3. ç¼–è¯‘æœŸå¤„ç† 4. ç±»åŠ è½½é˜¶æ®µ 5. ç±»åŠ è½½å™¨ 6. è¿è¡ŒæœŸä¼˜åŒ–

![image-20220602164840888](https://cdn.fengxianhub.top/resources-master/202206021648062.png)

## 1. ç±»æ–‡ä»¶ç»“æ„

ä¸€æ®µç®€å•çš„ä»£ç ï¼š

```java
public class TestClassLoader {
    public static void main(String[] args) {
        System.out.println("hello world");
    }
}
```

æˆ‘ä»¬éœ€è¦ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œï¼ˆLinuxï¼‰ï¼š

```java
javac -parameters -d . TestClassLoader.java
```

ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰“å°å­—èŠ‚ç æ–‡ä»¶

```java
od -t xC TestClassLoader.class
```

ç»“æœï¼š

```shell
[root@localhost javascript]# od -t xC TestClassLoader.class 
0000000 ca fe ba be 00 00 00 34 00 1f 0a 00 06 00 11 09
0000020 00 12 00 13 08 00 14 0a 00 15 00 16 07 00 17 07
0000040 00 18 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29
0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e
0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 04 6d 61 69
0000120 6e 01 00 16 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67
0000140 2f 53 74 72 69 6e 67 3b 29 56 01 00 10 4d 65 74
0000160 68 6f 64 50 61 72 61 6d 65 74 65 72 73 01 00 04
0000200 61 72 67 73 01 00 0a 53 6f 75 72 63 65 46 69 6c
0000220 65 01 00 14 54 65 73 74 43 6c 61 73 73 4c 6f 61
0000240 64 65 72 2e 6a 61 76 61 0c 00 07 00 08 07 00 19
0000260 0c 00 1a 00 1b 01 00 0b 68 65 6c 6c 6f 20 77 6f
0000300 72 6c 64 07 00 1c 0c 00 1d 00 1e 01 00 0f 54 65
0000320 73 74 43 6c 61 73 73 4c 6f 61 64 65 72 01 00 10
0000340 6a 61 76 61 2f 6c 61 6e 67 2f 4f 62 6a 65 63 74
0000360 01 00 10 6a 61 76 61 2f 6c 61 6e 67 2f 53 79 73
0000400 74 65 6d 01 00 03 6f 75 74 01 00 15 4c 6a 61 76
0000420 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d
0000440 3b 01 00 13 6a 61 76 61 2f 69 6f 2f 50 72 69 6e
0000460 74 53 74 72 65 61 6d 01 00 07 70 72 69 6e 74 6c
0000500 6e 01 00 15 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f
0000520 53 74 72 69 6e 67 3b 29 56 00 21 00 05 00 06 00
0000540 00 00 00 00 02 00 01 00 07 00 08 00 01 00 09 00
0000560 00 00 1d 00 01 00 01 00 00 00 05 2a b7 00 01 b1
0000600 00 00 00 01 00 0a 00 00 00 06 00 01 00 00 00 01
0000620 00 09 00 0b 00 0c 00 02 00 09 00 00 00 25 00 02
0000640 00 01 00 00 00 09 b2 00 02 12 03 b6 00 04 b1 00
0000660 00 00 01 00 0a 00 00 00 0a 00 02 00 00 00 03 00
0000700 08 00 04 00 0d 00 00 00 05 01 00 0e 00 00 00 01
0000720 00 0f 00 00 00 02 00 10
0000730

```

æ ¹æ®JVMè§„èŒƒï¼Œç±»æ–‡ä»¶ç»“æ„ä¸ºï¼š

```java
ClassFile { // u4è¡¨ç¤ºå­—èŠ‚æ•°
    u4 magic; // é­”æœ¯å­—
    u2 minor_version; // å°ç‰ˆæœ¬å·
    u2 major_version; // ä¸»ç‰ˆæœ¬å·
    u2 constant_pool_count; // å¸¸é‡æ± ä¿¡æ¯
    cp_info constant_pool[constant_pool_count-1];
    u2 access_flags; // ç±»çš„è®¿é—®æƒé™
    u2 this_class; // ç±»åä¿¡æ¯
    u2 super_class; // çˆ¶ç±»ä¿¡æ¯
    u2 interfaces_count; // æ¥å£æ•°é‡
    u2 interfaces[interfaces_count]; // æ¥å£ä¿¡æ¯
    u2 fields_count; // å±æ€§æ•°é‡
    field_info fields[fields_count];  // å±æ€§ä¿¡æ¯
    u2 methods_count; // æ–¹æ³•æ•°é‡
    method_info methods[methods_count]; // æ–¹æ³•ä¿¡æ¯
    u2 attributes_count; // å±æ€§ä¿¡æ¯
    attribute_info attributes[attributes_count];
}
```

### 1.1 é­”æ•°

0~3 å­—èŠ‚ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯ã€classã€‘ç±»å‹çš„æ–‡ä»¶

0000000 ***ca fe ba be*** 00 00 00 34 00 23 0a 00 06 00 15 09

### 1.2 ç‰ˆæœ¬

4~7 å­—èŠ‚ï¼Œè¡¨ç¤ºç±»çš„ç‰ˆæœ¬16è¿›åˆ¶ 00 34ï¼ˆåè¿›åˆ¶ï¼š52ï¼‰ è¡¨ç¤ºæ˜¯ Java 8

0000000 ca fe ba be ***00 00 00 34*** 00 23 0a 00 06 00 15 09

### 1.3 å¸¸é‡æ± 

| Constant Type               | Value |
| --------------------------- | ----- |
| CONSTANT_Class              | 7     |
| CONSTANT_Fieldref           | 9     |
| CONSTANT_Methodref          | 10    |
| CONSTANT_InterfaceMethodref | 11    |
| CONSTANT_String             | 8     |
| CONSTANT_Integer            | 3     |
| CONSTANT_Float              | 4     |
| CONSTANT_Long               | 5     |
| CONSTANT_Double             | 6     |
| CONSTANT_NameAndType        | 12    |
| CONSTANT_Utf8               | 1     |
| CONSTANT_MethodHandle       | 15    |
| CONSTANT_MethodType         | 16    |
| CONSTANT_InvokeDynamic      | 18    |

8~9 å­—èŠ‚ï¼Œè¡¨ç¤ºå¸¸é‡æ± é•¿åº¦ï¼Œ00 23 ï¼ˆ35ï¼‰ è¡¨ç¤ºå¸¸é‡æ± æœ‰ #1~#34é¡¹ï¼Œæ³¨æ„ #0 é¡¹ä¸è®¡å…¥ï¼Œä¹Ÿæ²¡æœ‰å€¼

0000000 ca fe ba be 00 00 00 34 <em>00 23 </em>0a 00 06 00 15 09



ç¬¬#1é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 06 å’Œ 00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #6 å’Œ #21 é¡¹æ¥è·å¾— è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±ç±»ã€‘å’Œã€æ–¹æ³•åã€‘

0000000 ca fe ba be 00 00 00 34 00 23 <em>0a 00 06 00 15</em> 09



ç¬¬#2é¡¹ 09 è¡¨ç¤ºä¸€ä¸ª Field ä¿¡æ¯ï¼Œ00 16ï¼ˆ22ï¼‰å’Œ 00 17ï¼ˆ23ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #22 å’Œ # 23 é¡¹ æ¥è·å¾—è¿™ä¸ªæˆå‘˜å˜é‡çš„ã€æ‰€å±ç±»ã€‘å’Œã€æˆå‘˜å˜é‡åã€‘

0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 <em>09</em> 

0000020 <em>00 16 00 17</em> 08 00 18 0a 00 19 00 1a 07 00 1b 07



ç¬¬#3é¡¹ 08 è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡åç§°ï¼Œ00 18ï¼ˆ24ï¼‰è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #24 é¡¹ 

0000020 00 16 00 17 <em>08 00 18</em> 0a 00 19 00 1a 07 00 1b 07



ç¬¬#4é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 19ï¼ˆ25ï¼‰ å’Œ 00 1aï¼ˆ26ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #25 å’Œ #26 é¡¹æ¥è·å¾—è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±ç±»ã€‘å’Œã€æ–¹æ³•åã€‘ 

0000020 00 16 00 17 08 00 18 <em>0a 00 19 00 1a</em> 07 00 1b 07



ç¬¬#5é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #27 é¡¹

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a <em>07 00 1b</em> 07



ç¬¬#6é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1cï¼ˆ28ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #28 é¡¹

0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b <em>07</em>

0000040 <em>00 1c</em> 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29



ç¬¬#7é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 06 è¡¨ç¤ºé•¿åº¦ï¼Œ3c 69 6e 69 74 3e æ˜¯ã€ `<init>` ã€‘

0000040 00 1c <em>01 00 06 3c 69 6e 69 74 3e</em> 01 00 03 28 29



ç¬¬#8é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œ28 29 56 æ˜¯ã€()Vã€‘å…¶å®å°±æ˜¯è¡¨ç¤ºæ— å‚ã€æ— è¿”å›å€¼

0000040 00 1c 01 00 06 3c 69 6e 69 74 3e <em>01 00 03 28 29</em>

0000060 <em>56</em> 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e



ç¬¬#9é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ43 6f 64 65 æ˜¯ã€Codeã€‘

 0000060 56 <em>01 00 04 43 6f 64 65</em> 01 00 0f 4c 69 6e 65 4e



ç¬¬#10é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 æ˜¯ã€LineNumberTableã€‘

0000060 56 01 00 04 43 6f 64 65 <em>01 00 0f 4c 69 6e 65 4e </em>

0000100 <em>75 6d 62 65 72 54 61 62 6c 65</em> 01 00 12 4c 6f 63



ç¬¬#11é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 12ï¼ˆ18ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65æ˜¯ã€LocalVariableTableã€‘

0000100 75 6d 62 65 72 54 61 62 6c 65 <em>01 00 12 4c 6f 63 </em>

0000120 <em>61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65</em> 01



ç¬¬#12é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€thisã€‘

0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01 

0000140 <em>00 04 74 68 69 73</em> 01 00 1d 4c 63 6e 2f 69 74 63



ç¬¬#13é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1dï¼ˆ29ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘

0000140 00 04 74 68 69 73 <em>01 00 1d 4c 63 6e 2f 69 74 63</em>

0000160 <em>61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f</em>

0000200 <em>57 6f 72 6c 64 3b</em> 01 00 04 6d 61 69 6e 01 00 16



ç¬¬#14é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€mainã€‘

0000200 57 6f 72 6c 64 3b <em>01 00 04 6d 61 69 6e</em> 01 00 16



ç¬¬#15é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 16ï¼ˆ22ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€([Ljava/lang/String;)Vã€‘å…¶å®å°±æ˜¯å‚æ•°ä¸º å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ— è¿”å›å€¼

0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e <em>01 00 16 </em>

0000220 <em>28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 </em>

0000240 <em>69 6e 67 3b 29 56</em> 01 00 04 61 72 67 73 01 00 13



ç¬¬#16é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€argsã€‘

0000240 69 6e 67 3b 29 56 <em>01 00 04 61 72 67 73</em> 01 00 13



ç¬¬#17é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘

0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 <em>01 00 13 </em>

0000260 <em>5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 </em>

0000300 <em>6e 67 3b</em> 01 00 10 4d 65 74 68 6f 64 50 61 72 61



ç¬¬#18é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€MethodParametersã€‘

0000300 6e 67 3b <em>01 00 10 4d 65 74 68 6f 64 50 61 72 61 </em>

0000320 <em>6d 65 74 65 72 73</em> 01 00 0a 53 6f 75 72 63 65 46



ç¬¬#19é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0aï¼ˆ10ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€SourceFileã€‘

0000320 6d 65 74 65 72 73 <em>01 00 0a 53 6f 75 72 63 65 46 </em>

0000340 <em>69 6c 65</em> 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64



ç¬¬#20é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€HelloWorld.javaã€‘

0000340 69 6c 65 <em>01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 </em>

0000360 <em>2e 6a 61 76 61</em> 0c 00 07 00 08 07 00 1d 0c 00 1e



ç¬¬#21é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 07 00 08 å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #7 #8 ä¸¤é¡¹

0000360 2e 6a 61 76 61 <em>0c 00 07 00 08</em> 07 00 1d 0c 00 1e



ç¬¬#22é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1dï¼ˆ29ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #29 é¡¹

0000360 2e 6a 61 76 61 0c 00 07 00 08 <em>07 00 1d</em> 0c 00 1e



ç¬¬#23é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 1eï¼ˆ30ï¼‰ 00 1f ï¼ˆ31ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #30 #31 ä¸¤é¡¹

0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d <em>0c 00 1e </em>

0000400 <em>00 1f</em> 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64



ç¬¬#24é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€hello worldã€‘ 

0000400 00 1f <em>01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</em>



ç¬¬#25é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 20ï¼ˆ32ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #32 é¡¹

0000420 <em>07 00 20</em> 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74



ç¬¬#26é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»å‹ã€‘ï¼Œ00 21ï¼ˆ33ï¼‰ 00 22ï¼ˆ34ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #33 #34 ä¸¤é¡¹

0000420 07 00 20 <em>0c 00 21 00 22</em> 01 00 1b 63 6e 2f 69 74



ç¬¬#27é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€cn/itcast/jvm/t5/HelloWorldã€‘

0000420 07 00 20 0c 00 21 00 22 <em>01 00 1b 63 6e 2f 69 74 </em>

0000440 <em>63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c</em> 

0000460 <em>6f 57 6f 72 6c 64</em> 01 00 10 6a 61 76 61 2f 6c 61



ç¬¬#28é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Objectã€‘

0000460 6f 57 6f 72 6c 64 <em>01 00 10 6a 61 76 61 2f 6c 61 </em>

0000500 <em>6e 67 2f 4f 62 6a 65 63 74</em> 01 00 10 6a 61 76 61



ç¬¬#29é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Systemã€‘

0000500 6e 67 2f 4f 62 6a 65 63 74 <em>01 00 10 6a 61 76 61 </em>

0000520 <em>2f 6c 61 6e 67 2f 53 79 73 74 65 6d</em> 01 00 03 6f



ç¬¬#30é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€outã€‘

0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d <em>01 00 03 6f </em>

0000540 <em>75 74</em> 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72



ç¬¬#31é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Ljava/io/PrintStream;ã€‘

0000540 75 74 <em>01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 </em>

0000560 <em>69 6e 74 53 74 72 65 61 6d 3b</em> 01 00 13 6a 61 76



ç¬¬#32é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/io/PrintStreamã€‘

0000560 69 6e 74 53 74 72 65 61 6d 3b <em>01 00 13 6a 61 76 </em>

0000600 <em>61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d</em>



ç¬¬#33é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 07 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€printlnã€‘ 

0000620 <em>01 00 07 70 72 69 6e 74 6c 6e</em> 01 00 15 28 4c 6a



ç¬¬#34é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€(Ljava/lang/String;)Vã€‘

0000620 01 00 07 70 72 69 6e 74 6c 6e <em>01 00 15 28 4c 6a </em>

0000640 <em>61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b</em> 

0000660 <em>29 56</em> 00 21 00 05 00 06 00 00 00 00 00 02 00 01

## 2. å­—èŠ‚ç æŒ‡ä»¤

### 2.1 å…¥é—¨

### 2.2 javapå·¥å…·

è‡ªå·±åˆ†æç±»æ–‡ä»¶ç»“æ„å¤ªéº»çƒ¦äº†ï¼ŒOracle æä¾›äº† javap å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶

```java
javap -v HelloWorld.class //-væ‰“å°è¯¦ç»†ä¿¡æ¯
```

```java
[root@localhost javascript]# javap -v TestClassLoader.class 
Classfile /root/fengyuanDir/javascript/TestClassLoader.class
  Last modified Jun 2, 2022; size 472 bytes
  MD5 checksum 11b3be535f6465a2a971c9d6fd448c5c
  Compiled from "TestClassLoader.java"
public class TestClassLoader
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #6.#17         // java/lang/Object."<init>":()V
   #2 = Fieldref           #18.#19        // java/lang/System.out:Ljava/io/PrintStream;
   #3 = String             #20            // hello world
   #4 = Methodref          #21.#22        // java/io/PrintStream.println:(Ljava/lang/String;)V
   #5 = Class              #23            // TestClassLoader
   #6 = Class              #24            // java/lang/Object
   #7 = Utf8               <init>
   #8 = Utf8               ()V
   #9 = Utf8               Code
  #10 = Utf8               LineNumberTable
  #11 = Utf8               main
  #12 = Utf8               ([Ljava/lang/String;)V
  #13 = Utf8               MethodParameters
  #14 = Utf8               args
  #15 = Utf8               SourceFile
  #16 = Utf8               TestClassLoader.java
  #17 = NameAndType        #7:#8          // "<init>":()V
  #18 = Class              #25            // java/lang/System
  #19 = NameAndType        #26:#27        // out:Ljava/io/PrintStream;
  #20 = Utf8               hello world
  #21 = Class              #28            // java/io/PrintStream
  #22 = NameAndType        #29:#30        // println:(Ljava/lang/String;)V
  #23 = Utf8               TestClassLoader
  #24 = Utf8               java/lang/Object
  #25 = Utf8               java/lang/System
  #26 = Utf8               out
  #27 = Utf8               Ljava/io/PrintStream;
  #28 = Utf8               java/io/PrintStream
  #29 = Utf8               println
  #30 = Utf8               (Ljava/lang/String;)V
{
  public TestClassLoader();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object."<init>":()V
         4: return
      LineNumberTable:
        line 1: 0

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=1, args_size=1
         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
         3: ldc           #3                  // String hello world
         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V
         8: return
      LineNumberTable:
        line 3: 0
        line 4: 8
    MethodParameters:
      Name                           Flags
      args
}
SourceFile: "TestClassLoader.java"
```

### 2.3 å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹

åŸå§‹çš„javaä»£ç ï¼š

```java
public class TestByteCode {
    public static void main(String[] args) {
        int a = 10;
        int b = Short.MAX_VALUE + 1; //ä¸€æ—¦è¶…å‡ºäº†shortçš„å®¹é‡å°±ä¼šå­˜å‚¨åœ¨å¸¸é‡æ± ä¸­
        int c = a + b;
        System.out.println(c);
    }
}
```

ç¼–è¯‘åçš„å­—èŠ‚ç ï¼š

```java
Classfile /E:/workspacesJ2SE_idea/JavaVirtualMachine/target/classes/com/fx/cla
ssLoader/TestByteCode.class
  Last modified 2022-6-2; size 636 bytes
  MD5 checksum d8dc32170dc1cafe0b1a118eac2d5693
  Compiled from "TestByteCode.java"
public class com.fx.classLoader.TestByteCode
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #7.#25         // java/lang/Object."<init>":()V
   #2 = Class              #26            // java/lang/Short
   #3 = Integer            32768
   #4 = Fieldref           #27.#28        // java/lang/System.out:Ljava/io/Pri
ntStream;
   #5 = Methodref          #29.#30        // java/io/PrintStream.println:(I)V
   #6 = Class              #31            // com/fx/classLoader/TestByteCode
   #7 = Class              #32            // java/lang/Object
   #8 = Utf8               <init>
   #9 = Utf8               ()V
  #10 = Utf8               Code
  #11 = Utf8               LineNumberTable
  #12 = Utf8               LocalVariableTable
  #13 = Utf8               this
  #14 = Utf8               Lcom/fx/classLoader/TestByteCode;
  #15 = Utf8               main
  #16 = Utf8               ([Ljava/lang/String;)V
  #17 = Utf8               args
  #18 = Utf8               [Ljava/lang/String;
  #19 = Utf8               a
  #20 = Utf8               I
  #21 = Utf8               b
  #22 = Utf8               c
  #23 = Utf8               SourceFile
  #24 = Utf8               TestByteCode.java
  #25 = NameAndType        #8:#9          // "<init>":()V
  #26 = Utf8               java/lang/Short
  #27 = Class              #33            // java/lang/System
  #28 = NameAndType        #34:#35        // out:Ljava/io/PrintStream;
  #29 = Class              #36            // java/io/PrintStream
  #30 = NameAndType        #37:#38        // println:(I)V
  #31 = Utf8               com/fx/classLoader/TestByteCode
  #32 = Utf8               java/lang/Object
  #33 = Utf8               java/lang/System
  #34 = Utf8               out
  #35 = Utf8               Ljava/io/PrintStream;
  #36 = Utf8               java/io/PrintStream
  #37 = Utf8               println
  #38 = Utf8               (I)V
{
  public com.fx.classLoader.TestByteCode();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object."<ini
t>":()V
         4: return
      LineNumberTable:
        line 8: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       5     0  this   Lcom/fx/classLoader/TestByteCode;

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=4, args_size=1
         0: bipush        10
         2: istore_1
         3: ldc           #3                  // int 32768
         5: istore_2
         6: iload_1
         7: iload_2
         8: iadd
         9: istore_3
        10: getstatic     #4                  // Field java/lang/System.out:Lj
ava/io/PrintStream;
        13: iload_3
        14: invokevirtual #5                  // Method java/io/PrintStream.pr
intln:(I)V
        17: return
      LineNumberTable:
        line 10: 0
        line 11: 3
        line 12: 6
        line 13: 10
        line 14: 17
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      18     0  args   [Ljava/lang/String;
            3      15     1     a   I
            6      12     2     b   I
           10       8     3     c   I
}
SourceFile: "TestByteCode.java"

```

#### 2.3.1 å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± 

![image-20220602185624658](https://cdn.fengxianhub.top/resources-master/202206021856005.png)

#### 2.3.2 æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº

![image-20220602185827214](https://cdn.fengxianhub.top/resources-master/202206021858315.png)

#### 2.3.3 mainçº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜

ï¼ˆstack=2ï¼Œlocals=4ï¼‰

![image-20220602185909177](https://cdn.fengxianhub.top/resources-master/202206021859281.png)

#### 2.3.4 æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç 

bipush 10

- å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰ 
- sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ 
- ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ 
- ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆåˆ†ä¸¤æ¬¡å‹å…¥ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰ 
- è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± 

![image-20220602190255637](https://cdn.fengxianhub.top/resources-master/202206021902716.png)

istore_1

- å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 1

![image-20220602190319218](https://cdn.fengxianhub.top/resources-master/202206021903309.png)

ldc #3

- ä»å¸¸é‡æ± åŠ è½½ #3 æ•°æ®åˆ°æ“ä½œæ•°æ ˆ
- æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®— å¥½çš„

![image-20220602190442020](https://cdn.fengxianhub.top/resources-master/202206021904133.png)



istore_2

![image-20220602190706612](https://cdn.fengxianhub.top/resources-master/202206021907721.png)

iload_1

![image-20220602190719418](https://cdn.fengxianhub.top/resources-master/202206021907515.png)

iload_2

![image-20220602190738629](https://cdn.fengxianhub.top/resources-master/202206021907720.png)

iadd

![image-20220602190755955](https://cdn.fengxianhub.top/resources-master/202206021907050.png)

istore_3

![image-20220602190808633](https://cdn.fengxianhub.top/resources-master/202206021908746.png)

getstatic #4

![image-20220602190822643](https://cdn.fengxianhub.top/resources-master/202206021908748.png)

![image-20220602190829544](https://cdn.fengxianhub.top/resources-master/202206021908621.png)

iload_3

![image-20220602190841413](https://cdn.fengxianhub.top/resources-master/202206021908517.png)

invokevirtual #5

- æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ 
- å®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³• 
- ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰ 
- ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç 

![image-20220602190915169](https://cdn.fengxianhub.top/resources-master/202206021909256.png)

- æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§ 
- æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹

![image-20220602190936458](https://cdn.fengxianhub.top/resources-master/202206021909544.png)

return

- å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ 
- ç¨‹åºç»“æŸ

### 2.4 åˆ†æi++

æˆ‘ä»¬åˆ†æä¸‹é¢çš„ä»£ç ï¼š

```java
public class TestByteCode {
    public static void main(String[] args) {
        int a = 10;
        int b = a++ + ++a + a--;
        System.out.println(a);
        System.out.println(b);
    }
}
```

æˆ‘ä»¬å¯ä»¥å¾ˆå¿«å¾—å‡ºç­”æ¡ˆæ˜¯ 11 34ï¼Œç°åœ¨æˆ‘ä»¬ä»å­—èŠ‚ç çš„è§’åº¦åˆ†æä¸€ä¸‹

å¯¹åº”å­—èŠ‚ç ä¸ºï¼š

```java
Classfile /E:/workspacesJ2SE_idea/JavaVirtualMachine/target/classes/com/fx/cla
ssLoader/TestByteCode.class
  Last modified 2022-6-2; size 611 bytes
  MD5 checksum 7c46f961f2a081fae72c22c2a6f62b41
  Compiled from "TestByteCode.java"
public class com.fx.classLoader.TestByteCode
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #5.#22         // java/lang/Object."<init>":()V
   #2 = Fieldref           #23.#24        // java/lang/System.out:Ljava/io/Pri
ntStream;
   #3 = Methodref          #25.#26        // java/io/PrintStream.println:(I)V
   #4 = Class              #27            // com/fx/classLoader/TestByteCode
   #5 = Class              #28            // java/lang/Object
   #6 = Utf8               <init>
   #7 = Utf8               ()V
   #8 = Utf8               Code
   #9 = Utf8               LineNumberTable
  #10 = Utf8               LocalVariableTable
  #11 = Utf8               this
  #12 = Utf8               Lcom/fx/classLoader/TestByteCode;
  #13 = Utf8               main
  #14 = Utf8               ([Ljava/lang/String;)V
  #15 = Utf8               args
  #16 = Utf8               [Ljava/lang/String;
  #17 = Utf8               a
  #18 = Utf8               I
  #19 = Utf8               b
  #20 = Utf8               SourceFile
  #21 = Utf8               TestByteCode.java
  #22 = NameAndType        #6:#7          // "<init>":()V
  #23 = Class              #29            // java/lang/System
  #24 = NameAndType        #30:#31        // out:Ljava/io/PrintStream;
  #25 = Class              #32            // java/io/PrintStream
  #26 = NameAndType        #33:#34        // println:(I)V
  #27 = Utf8               com/fx/classLoader/TestByteCode
  #28 = Utf8               java/lang/Object
  #29 = Utf8               java/lang/System
  #30 = Utf8               out
  #31 = Utf8               Ljava/io/PrintStream;
  #32 = Utf8               java/io/PrintStream
  #33 = Utf8               println
  #34 = Utf8               (I)V
{
  public com.fx.classLoader.TestByteCode();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object."<ini
t>":()V
         4: return
      LineNumberTable:
        line 8: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       5     0  this   Lcom/fx/classLoader/TestByteCode;

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=3, args_size=1
         0: bipush        10
         2: istore_1
         3: iload_1
         4: iinc          1, 1
         7: iinc          1, 1
        10: iload_1
        11: iadd
        12: iload_1
        13: iinc          1, -1
        16: iadd
        17: istore_2
        18: getstatic     #2                  // Field java/lang/System.out:Lj
ava/io/PrintStream;
        21: iload_1
        22: invokevirtual #3                  // Method java/io/PrintStream.pr
intln:(I)V
        25: getstatic     #2                  // Field java/lang/System.out:Lj
ava/io/PrintStream;
        28: iload_2
        29: invokevirtual #3                  // Method java/io/PrintStream.pr
intln:(I)V
        32: return
      LineNumberTable:
        line 10: 0
        line 11: 3
        line 12: 18
        line 13: 25
        line 14: 32
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      33     0  args   [Ljava/lang/String;
            3      30     1     a   I
           18      15     2     b   I
}
SourceFile: "TestByteCode.java"
```

åˆ†æï¼š

- æ³¨æ„ iinc æŒ‡ä»¤æ˜¯ç›´æ¥åœ¨å±€éƒ¨å˜é‡ slot ä¸Šè¿›è¡Œè¿ç®—
- a++ å’Œ ++a çš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œ iload è¿˜æ˜¯ å…ˆæ‰§è¡Œ iinc

![image-20220602191704155](https://cdn.fengxianhub.top/resources-master/202206021917332.png)



![image-20220602191727469](https://cdn.fengxianhub.top/resources-master/202206021917571.png)



![image-20220602191912521](https://cdn.fengxianhub.top/resources-master/202206021919613.png)

![image-20220602191919146](https://cdn.fengxianhub.top/resources-master/202206021919245.png)

![image-20220602191924693](https://cdn.fengxianhub.top/resources-master/202206021919791.png)

![image-20220602191930740](https://cdn.fengxianhub.top/resources-master/202206021919874.png)

![image-20220602191936968](https://cdn.fengxianhub.top/resources-master/202206021919066.png)

![image-20220602191943506](https://cdn.fengxianhub.top/resources-master/202206021919624.png)

![image-20220602191949482](https://cdn.fengxianhub.top/resources-master/202206021919573.png)

![image-20220602191957320](https://cdn.fengxianhub.top/resources-master/202206021919447.png)

### 2.5 æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤

![image-20220602192249707](https://cdn.fengxianhub.top/resources-master/202206021922830.png)

å‡ ç‚¹è¯´æ˜ï¼š

- byteï¼Œshortï¼Œchar éƒ½ä¼šæŒ‰ int æ¯”è¾ƒï¼Œå› ä¸ºæ“ä½œæ•°æ ˆéƒ½æ˜¯ 4 å­—èŠ‚ 
- goto ç”¨æ¥è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šè¡Œå·çš„å­—èŠ‚ç 

æºç ï¼š

```java
public class Demo3_3 {
    public static void main(String[] args) {
        int a = 0;
        if(a == 0) {
            a = 10;
        } else {
            a = 20;
        }
    }
}
```

å­—èŠ‚ç ï¼š

```java
0: iconst_0
1: istore_1
2: iload_1
3: ifne 		12
6: bipush 		10
8: istore_1
9: goto 		15
12: bipush 		20
14: istore_1
15: return
```

ä»¥ä¸Šæ¯”è¾ƒæŒ‡ä»¤ä¸­æ²¡æœ‰ longï¼Œfloatï¼Œdouble çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆå®ƒä»¬è¦æ¯”è¾ƒæ€ ä¹ˆåŠï¼Ÿ

å‚è€ƒ https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp

### 2.6 å¾ªç¯æ§åˆ¶æŒ‡ä»¤

å…¶å®å¾ªç¯æ§åˆ¶è¿˜æ˜¯å‰é¢ä»‹ç»çš„é‚£äº›æŒ‡ä»¤ï¼Œä¾‹å¦‚ while å¾ªç¯ï¼š

```java
public class Demo3_4 {
    public static void main(String[] args) {
        int a = 0;
        while (a < 10) {
            a++;
        }
    }
}
```

å­—èŠ‚ç ï¼š

```java
0: iconst_0
1: istore_1
2: iload_1
3: bipush 		10
5: if_icmpge 	14
8: iinc 1, 		1
11: goto 		2
14: return
```

å†æ¯”å¦‚ do while å¾ªç¯ï¼š

```java
public class Demo3_5 {
    public static void main(String[] args) {
        int a = 0;
        do {
            a++;
        } while (a < 10);
    }
}
```

å­—èŠ‚ç æ˜¯ï¼š

```java
0: iconst_0
 1: istore_1
 2: iinc 1, 	1
 5: iload_1
 6: bipush 		10
 8: if_icmplt 	2
11: return
```

æœ€åå†çœ‹çœ‹ for å¾ªç¯ï¼š

```java
public class Demo3_6 {
    public static void main(String[] args) {
        for (int i = 0; i < 10; i++) {
        }
    }
}
```

```java
iconst_0
1: istore_1
2: iload_1
3: bipush 		10
5: if_icmpge 	14
8: iinc 1, 		1
11: goto 		2
14: return
```

>æ¯”è¾ƒ while å’Œ for çš„å­—èŠ‚ç ï¼Œä½ å‘ç°å®ƒä»¬æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ®Šé€”ä¹Ÿèƒ½åŒå½’ğŸ˜™

### 2.7 ç»ƒä¹  - åˆ¤æ–­ç»“æœ

è¯·ä»å­—èŠ‚ç è§’åº¦åˆ†æï¼Œä¸‹åˆ—ä»£ç è¿è¡Œçš„ç»“æœï¼š

```java
public class Demo3_6_1 {
    public static void main(String[] args) {
        int i = 0;
        int x = 0;
        while (i < 10) {
            x = x++;
            i++;
        }
        System.out.println(x); // ç»“æœæ˜¯ 0
    }
}
```

### 2.8 æ„é€ æ–¹æ³•

`<cinit>()V`  (æ•´ä¸ªç±»çš„æ„é€ æ–¹æ³•)

```java
public class Demo3_8_1 {
    static int i = 10;
    static {
        i = 20;
    }
    static {
        i = 30;
    }
}
```

ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•`<cinit>()V`

```java
0: bipush 10
2: putstatic #2 // Field i:I
5: bipush 20
7: putstatic #2 // Field i:I
10: bipush 30
12: putstatic #2 // Field i:I
15: return
```

`<cinit>()V` æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨ï¼



`<init>()V`

å…ˆæ¥çœ‹ä¸€åˆ°é¢è¯•é¢˜ï¼š

```java
public class Demo3_8_2 {
    private String a = "s1";

    {
        b = 20;
    }

    private int b = 10;

    {
        a = "s2";
    }

    public Demo3_8_2(String a, int b) {
        this.a = a;
        this.b = b;
    }
    public static void main(String[] args) {
        Demo3_8_2 d = new Demo3_8_2("s3", 30);
        System.out.println(d.a);
        System.out.println(d.b);
    }
}
```

>ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œå½¢æˆæ–°çš„æ„é€ æ–¹æ³•ï¼Œä½†åŸå§‹æ„é€ æ–¹æ³•å†…çš„ä»£ç æ€»æ˜¯åœ¨æœ€åï¼

```java
Classfile /E:/workspacesJ2SE_idea/JavaVirtualMachine/target/classes/com/fx/classLoader/Demo3_8_2.class
  Last modified 2022-6-2; size 824 bytes
  MD5 checksum 07221e940ad9f0edb6f8c24e33c12a6c
  Compiled from "Demo3_8_2.java"
public class com.fx.classLoader.Demo3_8_2
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #12.#31        // java/lang/Object."<init>":()V
   #2 = String             #32            // s1
   #3 = Fieldref           #6.#33         // com/fx/classLoader/Demo3_8_2.a:Ljava/lang/String;
   #4 = Fieldref           #6.#34         // com/fx/classLoader/Demo3_8_2.b:I
   #5 = String             #35            // s2
   #6 = Class              #36            // com/fx/classLoader/Demo3_8_2
   #7 = String             #37            // s3
   #8 = Methodref          #6.#38         // com/fx/classLoader/Demo3_8_2."<init>":(Ljava/lang/String;I)V
   #9 = Fieldref           #39.#40        // java/lang/System.out:Ljava/io/PrintStream;
  #10 = Methodref          #41.#42        // java/io/PrintStream.println:(Ljava/lang/String;)V
  #11 = Methodref          #41.#43        // java/io/PrintStream.println:(I)V
  #12 = Class              #44            // java/lang/Object
  #13 = Utf8               a
  #14 = Utf8               Ljava/lang/String;
  #15 = Utf8               b
  #16 = Utf8               I
  #17 = Utf8               <init>
  #18 = Utf8               (Ljava/lang/String;I)V
  #19 = Utf8               Code
  #20 = Utf8               LineNumberTable
  #21 = Utf8               LocalVariableTable
  #22 = Utf8               this
  #23 = Utf8               Lcom/fx/classLoader/Demo3_8_2;
  #24 = Utf8               main
  #25 = Utf8               ([Ljava/lang/String;)V
  #26 = Utf8               args
  #27 = Utf8               [Ljava/lang/String;
  #28 = Utf8               d
  #29 = Utf8               SourceFile
  #30 = Utf8               Demo3_8_2.java
  #31 = NameAndType        #17:#45        // "<init>":()V
  #32 = Utf8               s1
  #33 = NameAndType        #13:#14        // a:Ljava/lang/String;
  #34 = NameAndType        #15:#16        // b:I
  #35 = Utf8               s2
  #36 = Utf8               com/fx/classLoader/Demo3_8_2
  #37 = Utf8               s3
  #38 = NameAndType        #17:#18        // "<init>":(Ljava/lang/String;I)V
  #39 = Class              #46            // java/lang/System
  #40 = NameAndType        #47:#48        // out:Ljava/io/PrintStream;
  #41 = Class              #49            // java/io/PrintStream
  #42 = NameAndType        #50:#51        // println:(Ljava/lang/String;)V
  #43 = NameAndType        #50:#52        // println:(I)V
  #44 = Utf8               java/lang/Object
  #45 = Utf8               ()V
  #46 = Utf8               java/lang/System
  #47 = Utf8               out
  #48 = Utf8               Ljava/io/PrintStream;
  #49 = Utf8               java/io/PrintStream
  #50 = Utf8               println
  #51 = Utf8               (Ljava/lang/String;)V
  #52 = Utf8               (I)V
{
  public com.fx.classLoader.Demo3_8_2(java.lang.String, int);
    descriptor: (Ljava/lang/String;I)V
    flags: ACC_PUBLIC
    Code:
      stack=2, locals=3, args_size=3
         0: aload_0     
         1: invokespecial #1                  // Method java/lang/Object."<init>":()V
         4: aload_0
         5: ldc           #2                  // <- "s1"
         7: putfield      #3                  // -> this.a a:Ljava/lang/String;
        10: aload_0
        11: bipush        20   				  // <- 20
        13: putfield      #4                  // -> this.b
        16: aload_0
        17: bipush        10			      // <- 10
        19: putfield      #4                  // -> this.b
        22: aload_0
        23: ldc           #5                  // String s2
        25: putfield      #3                  // -> this.b a:Ljava/lang/String;
        28: aload_0							  // --------------------
        29: aload_1							  // <- slot 1(a) "s3"  
        30: putfield      #3                  // -> this.a   a:Ljava/lang/String;                                                
        33: aload_0
        34: iload_2							  // <- slot 2(b) 30
        35: putfield      #4                  // -> this.b -----------
        38: return
      LineNumberTable:
        line 21: 0
        line 9: 4
        line 12: 10
        line 15: 16
        line 18: 22
        line 22: 28
        line 23: 33
        line 24: 38
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      39     0  this   Lcom/fx/classLoader/Demo3_8_2;
            0      39     1     a   Ljava/lang/String;
            0      39     2     b   I

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=4, locals=2, args_size=1
         0: new           #6                  // class com/fx/classLoader/Demo3_8_2
         3: dup
         4: ldc           #7                  // String s3
         6: bipush        30
         8: invokespecial #8                  // Method "<init>":(Ljava/lang/String;I)V
        11: astore_1
        12: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;
        15: aload_1
        16: getfield      #3                  // Field a:Ljava/lang/String;
        19: invokevirtual #10                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V
        22: getstatic     #9                  // Field java/lang/System.out:Ljava/io/PrintStream;
        25: aload_1
        26: getfield      #4                  // Field b:I
        29: invokevirtual #11                 // Method java/io/PrintStream.println:(I)V
        32: return
      LineNumberTable:
        line 26: 0
        line 27: 12
        line 28: 22
        line 29: 32
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      33     0  args   [Ljava/lang/String;
           12      21     1     d   Lcom/fx/classLoader/Demo3_8_2;
}
SourceFile: "Demo3_8_2.java"

```

### 2.9 æ–¹æ³•è°ƒç”¨

çœ‹ä¸€ä¸‹å‡ ç§ä¸åŒçš„æ–¹æ³•è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤

```java
public class Demo3_9 {
    public Demo3_9() { }
    private void test1() { }
    private final void test2() { }
    public void test3() { }
    public static void test4() { }
    public static void main(String[] args) {
        Demo3_9 d = new Demo3_9();
        d.test1();
        d.test2();
        d.test3();
        d.test4();
        Demo3_9.test4();
    }
}
```

å­—èŠ‚ç ï¼š

```java
0: new #2 // class cn/itcast/jvm/t3/bytecode/Demo3_9
3: dup
4: invokespecial #3 // Method "<init>":()V
7: astore_1
8: aload_1
9: invokespecial #4 // Method test1:()V
12: aload_1
13: invokespecial #5 // Method test2:()V
16: aload_1
17: invokevirtual #6 // Method test3:()V
20: aload_1
21: pop
22: invokestatic #7 // Method test4:()V
25: invokestatic #7 // Method test4:()V
28: return

```

- new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘å‹å…¥æ“ä½œæ•°æ ˆ
- dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é… åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• "`<cinit>()V`":()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡
- æœ€ç»ˆæ–¹æ³•ï¼ˆfinalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š
- æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äºåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€
- æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘
- æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ d.test4(); æ˜¯é€šè¿‡ã€å¯¹è±¡å¼•ç”¨ã€‘è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨ invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠã€å¯¹è±¡å¼•ç”¨ã€‘ä»æ“ä½œæ•°æ ˆå¼¹æ‰äº†
- è¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œ invokespecial çš„æƒ…å†µæ˜¯é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹æ³•

### 2.10 å¤šæ€çš„åŸç†

æ¼”ç¤ºä»£ç ï¼š

```java
**
 * æ¼”ç¤ºå¤šæ€åŸç†ï¼Œæ³¨æ„åŠ ä¸Šä¸‹é¢çš„ JVM å‚æ•°ï¼Œç¦ç”¨æŒ‡é’ˆå‹ç¼©
 * -XX:-UseCompressedOops -XX:-UseCompressedClassPointers
 */
public class Demo3_10 {
    public static void test(Animal animal) {
        animal.eat();
        System.out.println(animal.toString());
    }
    public static void main(String[] args) throws IOException {
        test(new Cat());
        test(new Dog());
        System.in.read();
    }
}
abstract class Animal {
    public abstract void eat();
    @Override
    public String toString() {
        return "æˆ‘æ˜¯" + this.getClass().getSimpleName();
    }
}
class Dog extends Animal {
    @Override
    public void eat() {
        System.out.println("å•ƒéª¨å¤´");
    }
}
class Cat extends Animal {
    @Override
    public void eat() {
        System.out.println("åƒé±¼");
    }
}
```

**è¿è¡ŒHSDBå·¥å…·**

æ‰§è¡Œ

```java
java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB
```

è¿›å…¥å›¾å½¢åŒ–ç•Œé¢attachå¹¶è¾“å…¥è¿›ç¨‹ idï¼ˆå¯ä»¥é€šè¿‡jpsæŒ‡ä»¤è·å–ï¼‰

![image-20220602223234534](https://cdn.fengxianhub.top/resources-master/202206022232657.png)



![image-20220602223155760](https://cdn.fengxianhub.top/resources-master/202206022231082.png)

ç„¶åæˆ‘å°±å¯ä»¥æŸ¥æ‰¾æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡äº†

![image-20220602223716082](https://cdn.fengxianhub.top/resources-master/202206022237236.png)

è¿™é‡Œçš„å‘½ä»¤ç±»ä¼¼æœ‰sqlï¼Œä¾‹å¦‚æˆ‘æƒ³æŸ¥æ‰¾Dogï¼Œè¿™é‡Œæˆ‘éœ€è¦å¸¦ä¸ŠåŒ…åï¼Œå¹¶ä¸”å¯ä»¥ç»™ç±»èµ·åˆ«ç§°

```java
select d from com.fx.classLoader.Dog d
```

![image-20220602224102081](https://cdn.fengxianhub.top/resources-master/202206022241199.png)

è¿™æ ·å°±å¯ä»¥æŸ¥è¯¢å‡ºå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬Dogå¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€ä¸€å®šæ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£ä¸ªåœ°å€ï¼Œæˆ‘ä»¬ç‚¹è¿›å»å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡çš„ä¿¡æ¯

<img src="https://cdn.fengxianhub.top/resources-master/202206022244715.png" alt="image-20220602224420586" style="zoom:80%;" />

æ¥ç€æˆ‘ä»¬åœ¨windowä¸­æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œè¾“å…¥è¿™ä¸ªå¯¹è±¡çš„åœ°å€æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹è±¡æŒ‡é’ˆçš„åœ°å€ï¼Œæ˜¯ä¸‹é¢çš„é‚£ä¸ª

<img src="https://cdn.fengxianhub.top/resources-master/202206022246530.png" alt="image-20220602224622415" style="zoom: 67%;" />



### 2.11 å¼‚å¸¸å¤„ç†

```java
public class Demo3_11_1 {
    public static void main(String[] args) {
        int i = 0;
        try {
            i = 10;
        } catch (Exception e) {
            i = 20;
        }
    }
}
```



```java
public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
        stack=1, locals=3, args_size=1
            0: iconst_0
            1: istore_1
            2: bipush 10
            4: istore_1
            5: goto 12
            8: astore_2
            9: bipush 20
            11: istore_1
            12: return
        Exception table:
            from 	to 	target type
                2 	5 	8 		Class java/lang/Exception
        LineNumberTable: ...
        LocalVariableTable:
            Start 	Length 	Slot	 Name 	Signature
                9 	3	 	2 			e 		Ljava/lang/Exception;
                0 	13 		0 			args 	[Ljava/lang/String;
                2 	11 		1 			i 		I
        StackMapTable: ...
      MethodParameters: ...
}

```

- å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯å‰é—­åå¼€çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´ å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·
- 8 è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 2 ä½ç½®



### 2.12 finallyåŸç†

* finallyçš„åŸç†æ˜¯å°†finally{}å—ä¸­çš„ä»£ç åˆ†åˆ«æ”¾åœ¨try{...}çš„æœ€åå’Œcatch{...}çš„æœ€å

* å¦‚æœtryå‡ºäº†é—®é¢˜,ç›´æ¥è¿›å…¥catchä¸­,ç„¶åcatchåé¢å¤åˆ¶çš„finallyå°±ä¼šè¢«æ‰§è¡Œ

* å¦‚æœæ²¡æœ‰å‡ºé—®é¢˜,try{}åé¢çš„ä»£ç å°±ä¼šè¢«æ‰§è¡Œ

* å¯ä»¥çœ‹åˆ° finally ä¸­çš„ä»£ç è¢«å¤åˆ¶äº† 3 ä»½ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catch å‰©ä½™çš„å¼‚å¸¸ç±»å‹æµ ç¨‹

### 2.13 finallyé¢è¯•é¢˜

```java
public class Demo3_11_4 {
    public static void main(String[] args) {
        int i = 0;
        try {
            i = 10;
        } catch (Exception e) {
            i = 20;
        } finally {
            i = 30;
        }
    }
}
```

å­—èŠ‚ç ï¼š

```java
public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=4, args_size=1
         0: iconst_0
         1: istore_1
         2: bipush        10
         4: istore_1
         5: bipush        30
         7: istore_1
         8: goto          27
        11: astore_2
        12: bipush        20
        14: istore_1
        15: bipush        30
        17: istore_1
        18: goto          27
        21: astore_3
        22: bipush        30
        24: istore_1
        25: aload_3
        26: athrow
        27: return
      Exception table:
         from    to  target type
             2     5    11   Class java/lang/Exception
             2     5    21   any
            11    15    21   any
      LineNumberTable:
        line 10: 0
        line 12: 2
        line 16: 5
        line 17: 8
        line 13: 11
        line 14: 12
        line 16: 15
        line 17: 18
        line 16: 21
        line 17: 25
        line 18: 27
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
           12       3     2     e   Ljava/lang/Exception;
            0      28     0  args   [Ljava/lang/String;
            2      26     1     i   I
      StackMapTable: number_of_entries = 3
        frame_type = 255 /* full_frame */
          offset_delta = 11
          locals = [ class "[Ljava/lang/String;", int ]
          stack = [ class java/lang/Exception ]
        frame_type = 73 /* same_locals_1_stack_item */
          stack = [ class java/lang/Throwable ]
        frame_type = 5 /* same */
}

```



#### finallyä¸­å‡ºç°äº†return

```java
public class Demo3_12_2 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        try {
            return 10;
        } finally {
            return 20;
        }
    }
}

```

å­—èŠ‚ç ï¼š

```java
 public static int test();
    descriptor: ()I
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=2, args_size=0
         0: bipush        10  // <- 10 æ”¾å…¥æ ˆé¡¶
         2: istore_0		  // 10 -> slot 0 (ä»æ ˆé¡¶ç§»é™¤)
         3: bipush        20  // <- 20 æ”¾å…¥æ ˆé¡¶
         5: ireturn			  // è¿”å›æ ˆé¡¶ int(20)
         6: astore_1	 	  // catch any -> slot 1
         7: bipush        20  // <- 20 æ”¾å…¥æ ˆé¡¶
         9: ireturn			  // è¿”å›æ ˆé¡¶ int(20)
      Exception table:
         from    to  target type
             0     3     6   any
      LineNumberTable:
        line 15: 0
        line 17: 3
      StackMapTable: number_of_entries = 1
        frame_type = 70 /* same_locals_1_stack_item */
          stack = [ class java/lang/Throwable ]
}

```

- ç”±äº finally ä¸­çš„ ireturn è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ finally çš„ä¸ºå‡†
- è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­
- è·Ÿä¸Šä¾‹ä¸­çš„ finally ç›¸æ¯”ï¼Œå‘ç°æ²¡æœ‰ athrow äº†ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ finally ä¸­å‡ºç°äº† returnï¼Œä¼š åæ‰å¼‚å¸¸ğŸ˜±ğŸ˜±ğŸ˜±ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ä¸‹é¢çš„ä»£ç 

#### finallyåæ‰å¼‚å¸¸

```java
public class Demo3_12_1 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        try {
            int i = 1/0;
            return 10;
        } finally {
            return 20;
        }
    }
}
```

ç»“æœæ˜¯è¾“å‡º20ï¼Œå¼‚å¸¸è¢«åæ‰äº†ï¼Œæˆ‘ä»¬çœ‹ä¸‹å­—èŠ‚ç 

```java
public static int test();
    descriptor: ()I
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=3, args_size=0
         0: iconst_1
         1: iconst_0
         2: idiv
         3: istore_0
         4: bipush        10
         6: istore_1
         7: bipush        20
         9: ireturn
        10: astore_2
        11: bipush        20
        13: ireturn
      Exception table:
         from    to  target type
             0     7    10   any
      LineNumberTable:
        line 15: 0
        line 16: 4
        line 18: 7
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            4       6     0     i   I
      StackMapTable: number_of_entries = 1
        frame_type = 74 /* same_locals_1_stack_item */
          stack = [ class java/lang/Throwable ]
}

```

#### finallyå¯¹è¿”å›å€¼çš„å½±å“

```java
public class Demo3_12_2 {
    public static void main(String[] args) {
        int result = test();
        System.out.println(result);
    }
    public static int test() {
        int i = 10;
        try {
            return i;
        } finally {
            i = 20;
        }
    }
}
```

å­—èŠ‚ç ï¼š

```java
public static int test();
    descriptor: ()I
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=3, args_size=0
         0: bipush        10	// <- æ”¾å…¥æ ˆé¡¶
         2: istore_0			// 10 -> i
         3: iload_0				// <- i(10)
         4: istore_1			// 10 -> slot 1,æš‚å­˜è‡³ slot 1ï¼Œç›®çš„æ˜¯ä¸ºäº†å›ºå®šè¿”å›å€¼
         5: bipush        20	// <- 20 æ”¾å…¥æ ˆé¡¶
         7: istore_0			// 20 -> i
         8: iload_1				// <- slot 1(10) è½½å…¥ slot 1 æš‚å­˜çš„å€¼
         9: ireturn				// è¿”å›æ ˆé¡¶çš„ int(10)
        10: astore_2
        11: bipush        20
        13: istore_0
        14: aload_2
        15: athrow
      Exception table:
         from    to  target type
             3     5    10   any
      LineNumberTable:
        line 14: 0
        line 16: 3
        line 18: 5
        line 16: 8
        line 18: 10
        line 19: 14
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            3      13     0     i   I
      StackMapTable: number_of_entries = 1
        frame_type = 255 /* full_frame */
          offset_delta = 10
          locals = [ int ]
          stack = [ class java/lang/Throwable ]
}

```

### 2.13 synchronizedåº•å±‚åŸç†

```java
public class TestSynchronized {
    public static void main(String[] args) {
        Object lock = new Object();
        synchronized (lock){
            System.out.println("ok");
        }
    }
}
```

å­—èŠ‚ç ï¼š

```java
public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=4, args_size=1
         0: new           #2                  // class java/lang/Object
         3: dup				//å°†å¯¹è±¡çš„åº”ç”¨åœ°å€å¤åˆ¶äº†ä¸€ä»½æ”¾å…¥æ“ä½œæ•°æ ˆ
         4: invokespecial #1                  // Method java/lang/Object."<ini
t>":()V
         7: astore_1		// lockå¼•ç”¨ -> lock
         8: aload_1			// <- lock ï¼ˆsynchronizedå¼€å§‹ï¼‰
         9: dup				// å¤åˆ¶lockçš„å¼•ç”¨
        10: astore_2		// lockå¼•ç”¨ -> slot 2
        11: monitorenter    // monitorenter(lockå¼•ç”¨)
        12: getstatic     #3                  // Field java/lang/System.out:Lj
ava/io/PrintStream;
        15: ldc           #4                  // String ok
        17: invokevirtual #5                  // Method java/io/PrintStream.pr
intln:(Ljava/lang/String;)V
        20: aload_2
        21: monitorexit		// monitorexit(lockå¼•ç”¨)
        22: goto          30
        25: astore_3		// any -> slot 3
        26: aload_2			// <- slot 2(lockå¼•ç”¨)
        27: monitorexit		// monitorexit(lockå¼•ç”¨)
        28: aload_3
        29: athrow
        30: return
      Exception table:
         from    to  target type
            12    22    25   any
            25    28    25   any
      LineNumberTable:
        line 10: 0
        line 11: 8
        line 12: 12
        line 13: 20
        line 14: 30
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      31     0  args   [Ljava/lang/String;
            8      23     1  lock   Ljava/lang/Object;
      StackMapTable: number_of_entries = 2
        frame_type = 255 /* full_frame */
          offset_delta = 25
          locals = [ class "[Ljava/lang/String;", class java/lang/Object, clas
s java/lang/Object ]
          stack = [ class java/lang/Throwable ]
        frame_type = 250 /* chop */
          offset_delta = 4
}
```

>æ³¨æ„ï¼š
>
>æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“ç°

## 3. ç¼–è¯‘å™¨å¤„ç†

æ‰€è°“çš„ è¯­æ³•ç³– ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ `*.java` æºç ç¼–è¯‘ä¸º `*.class` å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆ å’Œè½¬æ¢çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©ï¼ˆç»™ç³–åƒå˜›ï¼‰ 

æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº†` å‡ ä¹ç­‰ä»·` çš„ java æºç æ–¹å¼ï¼Œå¹¶ ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚

### 3.1 é»˜è®¤æ„é€ å™¨

```java
public class Candy1 {
}

```

ç¼–è¯‘æˆå­—èŠ‚ç åçš„ä¼ªä»£ç ï¼š

```java
public class Candy1 {
    // è¿™ä¸ªæ— å‚æ„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„
    public Candy1() {
        super(); // å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object."<init>":()V
    }
}
```

### 3.2 è‡ªåŠ¨æ‹†è£…ç®±

è¿™ä¸ªç‰¹æ€§æ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„ï¼Œ ä»£ç ç‰‡æ®µ1 ï¼š

```java
public class Candy2 {
    public static void main(String[] args) {
        Integer x = 1;
        int y = x;
    }
}
```

è¿™æ®µä»£ç åœ¨ JDK 5 ä¹‹å‰æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå¿…é¡»æ”¹å†™ä¸º ä»£ç ç‰‡æ®µ2 :

```java
public class Candy2 {
    public static void main(String[] args) {
        Integer x = Integer.valueOf(1);
        int y = x.intValue();
    }
}
```

æ˜¾ç„¶ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç å¤ªéº»çƒ¦äº†ï¼Œéœ€è¦åœ¨åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´æ¥å›è½¬æ¢ï¼ˆå°¤å…¶æ˜¯é›†åˆç±»ä¸­æ“ä½œçš„éƒ½æ˜¯ åŒ…è£…ç±»å‹ï¼‰ï¼Œå› æ­¤è¿™äº›è½¬æ¢çš„äº‹æƒ…åœ¨ JDK 5 ä»¥åéƒ½ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆã€‚å³ `ä»£ç ç‰‡æ®µ1` éƒ½ä¼šåœ¨ç¼– è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸º `ä»£ç ç‰‡æ®µ2`

### 3.3 æ³›å‹é›†åˆå–å€¼

æ³›å‹ä¹Ÿæ˜¯åœ¨ `JDK 5` å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›å‹ä»£ç åä¼šæ‰§è¡Œ `æ³›å‹æ“¦é™¤` çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯ åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±ä¸¢å¤±äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† Object ç±»å‹æ¥å¤„ç†ï¼š

```java
public class Candy3 {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        list.add(10); // å®é™…è°ƒç”¨çš„æ˜¯ List.add(Object e)
        Integer x = list.get(0); // å®é™…è°ƒç”¨çš„æ˜¯ Object obj = List.get(int index);
    }
}
```

æ‰€ä»¥åœ¨å–å€¼æ—¶ï¼Œç¼–è¯‘å™¨çœŸæ­£ç”Ÿæˆçš„å­—èŠ‚ç ä¸­ï¼Œè¿˜è¦é¢å¤–åšä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œï¼š

```java
// éœ€è¦å°† Object è½¬ä¸º Integer
Integer x = (Integer)list.get(0);
```

å¦‚æœå‰é¢çš„ x å˜é‡ç±»å‹ä¿®æ”¹ä¸º int åŸºæœ¬ç±»å‹é‚£ä¹ˆæœ€ç»ˆç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ï¼š

```java
// éœ€è¦å°† Object è½¬ä¸º Integer, å¹¶æ‰§è¡Œæ‹†ç®±æ“ä½œ
int x = ((Integer)list.get(0)).intValue();
```

è¿˜å¥½è¿™äº›éº»çƒ¦äº‹éƒ½ä¸ç”¨è‡ªå·±åšã€‚

æ“¦é™¤çš„æ˜¯å­—èŠ‚ç ä¸Šçš„æ³›å‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ° `LocalVariableTypeTable` ä»ç„¶ä¿ç•™äº†æ–¹æ³•å‚æ•°æ³›å‹çš„ä¿¡æ¯

```java
 public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=3, args_size=1
         0: new           #2                  // class java/util/ArrayList
         3: dup
         4: invokespecial #3                  // Method java/util/ArrayList."<init>":()V
         7: astore_1
         8: aload_1
         9: bipush        10
        11: invokestatic  #4                  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
        14: invokeinterface #5,  2            // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z
        19: pop
        20: aload_1
        21: iconst_0
        22: invokeinterface #6,  2            // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;
        27: checkcast     #7                  // class java/lang/Integer
        30: astore_2
        31: return
      LineNumberTable:
        line 13: 0
        line 14: 8
        line 15: 20
        line 16: 31
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      32     0  args   [Ljava/lang/String;
            8      24     1  list   Ljava/util/List;
           31       1     2     x   Ljava/lang/Integer;
      LocalVariableTypeTable:
        Start  Length  Slot  Name   Signature
            8      24     1  list   Ljava/util/List<Ljava/lang/Integer;>;
}

```

ä½¿ç”¨åå°„ï¼Œä»ç„¶èƒ½å¤Ÿè·å¾—è¿™äº›ä¿¡æ¯ï¼š

```java
public Set<Integer> test(List<String> list, Map<Integer, Object> map) {
}
```

```java
Method test = Candy3.class.getMethod("test", List.class, Map.class);
Type[] types = test.getGenericParameterTypes();
for (Type type : types) {
    if (type instanceof ParameterizedType) {
        ParameterizedType parameterizedType = (ParameterizedType) type;
        System.out.println("åŸå§‹ç±»å‹ - " + parameterizedType.getRawType());
        Type[] arguments = parameterizedType.getActualTypeArguments();
        for (int i = 0; i < arguments.length; i++) {
            System.out.printf("æ³›å‹å‚æ•°[%d] - %s\n", i, arguments[i]);
        }
    }
}

```

è¾“å‡ºï¼š

```java
åŸå§‹ç±»å‹ - interface java.util.List
æ³›å‹å‚æ•°[0] - class java.lang.String
åŸå§‹ç±»å‹ - interface java.util.Map
æ³›å‹å‚æ•°[0] - class java.lang.Integer
æ³›å‹å‚æ•°[1] - class java.lang.Object
```

### 3.4 å¯å˜å‚æ•°

å¯å˜å‚æ•°ä¹Ÿæ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„æ–°ç‰¹æ€§ï¼š

ä¾‹å¦‚ï¼š

```java
public class Candy4 {
    public static void foo(String... args) {
        String[] array = args; // ç›´æ¥èµ‹å€¼
        System.out.println(array);
    }
    public static void main(String[] args) {
        foo("hello", "world");
    }
}
```

å¯å˜å‚æ•° `String... args `å…¶å®æ˜¯ä¸€ä¸ª `String[] args `ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒæ · `java `ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°† ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š

```java
public class Candy4 {
    public static void foo(String[] args) {
        String[] array = args; // ç›´æ¥èµ‹å€¼
        System.out.println(array);
    }
    public static void main(String[] args) {
        foo(new String[]{"hello", "world"});
    }
}

```

>æ³¨æ„ å¦‚æœè°ƒç”¨äº† `foo()` åˆ™ç­‰ä»·ä»£ç ä¸º `foo(new String[]{})` ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè€Œä¸ä¼šä¼ é€’ `null `è¿›å»

### 3.5 foreach å¾ªç¯

ä»æ˜¯ `JDK 5` å¼€å§‹å¼•å…¥çš„è¯­æ³•ç³–ï¼Œæ•°ç»„çš„å¾ªç¯ï¼š

```java
public class Candy5_1 {
    public static void main(String[] args) {
        int[] array = {1, 2, 3, 4, 5}; // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦
        for (int e : array) {
            System.out.println(e);
        }
    }
}
```

ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š

```java
public class Candy5_1 {
    public Candy5_1() {
    }
    public static void main(String[] args) {
        int[] array = new int[]{1, 2, 3, 4, 5};
        for(int i = 0; i < array.length; ++i) {
            int e = array[i];
            System.out.println(e);
        }
    }
}
```

è€Œé›†åˆçš„å¾ªç¯ï¼š

```java
public class Candy5_2 {
    public static void main(String[] args) {
    List<Integer> list = Arrays.asList(1,2,3,4,5);
        for (Integer i : list) {
            System.out.println(i);
        }
    }
}
```

å®é™…è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå¯¹è¿­ä»£å™¨çš„è°ƒç”¨ï¼š

```java
public class Candy5_2 {
    public Candy5_2() {
    }
    public static void main(String[] args) {
    List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);
    Iterator iter = list.iterator();
        while(iter.hasNext()) {
            Integer e = (Integer)iter.next();
            System.out.println(e);
        }
    }
}
```

>æ³¨æ„ 
>
>foreach å¾ªç¯å†™æ³•ï¼Œèƒ½å¤Ÿé…åˆæ•°ç»„ï¼Œä»¥åŠæ‰€æœ‰å®ç°äº† `Iterable `æ¥å£çš„é›†åˆç±»ä¸€èµ·ä½¿ç”¨ï¼Œå…¶ä¸­ Iterable ç”¨æ¥è·å–é›†åˆçš„è¿­ä»£å™¨ï¼ˆ `Iterator `ï¼‰

### 3.6 switch å­—ç¬¦ä¸²

ä» `JDK 7` å¼€å§‹ï¼Œswitch å¯ä»¥ä½œç”¨äºå­—ç¬¦ä¸²å’Œæšä¸¾ç±»ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®ä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œä¾‹å¦‚ï¼š

```java
public class Candy6_1 {
    public static void choose(String str) {
        switch (str) {
            case "hello": {
                System.out.println("h");
                break;
            }
            case "world": {
                System.out.println("w");
                break;
            }
        }
    }
}
```

>æ³¨æ„ 
>
>switch é…åˆ String å’Œæšä¸¾ä½¿ç”¨æ—¶ï¼Œå˜é‡ä¸èƒ½ä¸ºnullï¼ŒåŸå› åˆ†æå®Œè¯­æ³•ç³–è½¬æ¢åçš„ä»£ç åº”å½“è‡ªç„¶æ¸… æ¥š

ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š

```java
public class Candy6_1 {
    public Candy6_1() {
    }
    public static void choose(String str) {
        byte x = -1;
        switch(str.hashCode()) {
            case 99162322: // hello çš„ hashCode
                if (str.equals("hello")) {
                    x = 0;
                }
                break;
            case 113318802: // world çš„ hashCode
                if (str.equals("world")) {
                    x = 1;
                }
        }
        switch(x) {
            case 0:
                System.out.println("h");
                break;
            case 1:
                System.out.println("w");
        }
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†ä¸¤é switchï¼Œç¬¬ä¸€éæ˜¯æ ¹æ®å­—ç¬¦ä¸²çš„ hashCode å’Œ equals å°†å­—ç¬¦ä¸²çš„è½¬æ¢ä¸ºç›¸åº” byte ç±»å‹ï¼Œç¬¬äºŒéæ‰æ˜¯åˆ©ç”¨ byte æ‰§è¡Œè¿›è¡Œæ¯”è¾ƒã€‚ 

ä¸ºä»€ä¹ˆç¬¬ä¸€éæ—¶å¿…é¡»æ—¢æ¯”è¾ƒ hashCodeï¼Œåˆåˆ©ç”¨ equals æ¯”è¾ƒå‘¢ï¼ŸhashCode æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‡å°‘å¯ èƒ½çš„æ¯”è¾ƒï¼›è€Œ equals æ˜¯ä¸ºäº†é˜²æ­¢ hashCode å†²çªï¼Œä¾‹å¦‚ BM å’Œ C. è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashCodeå€¼éƒ½æ˜¯ 2123 ï¼Œå¦‚æœæœ‰å¦‚ä¸‹ä»£ç ï¼š

```java
public class Candy6_2 {
    public static void choose(String str) {
        switch (str) {
            case "BM": {
                System.out.println("h");
                break;
            }
            case "C.": {
                System.out.println("w");
                break;
            }
        }
    }
}
```

ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š

```java
public class Candy6_2 {
    public Candy6_2() {
    }
    public static void choose(String str) {
        byte x = -1;
        switch(str.hashCode()) {
            case 2123: // hashCode å€¼å¯èƒ½ç›¸åŒï¼Œéœ€è¦è¿›ä¸€æ­¥ç”¨ equals æ¯”è¾ƒ
                if (str.equals("C.")) {
                    x = 1;
                } else if (str.equals("BM")) {
                    x = 0;
                }
            default:
                switch(x) {
                    case 0:
                        System.out.println("h");
                        break;
                    case 1:
                        System.out.println("w");
                }
        }
    }
}
```

### 3.7 switch æšä¸¾

switch æšä¸¾çš„ä¾‹å­ï¼ŒåŸå§‹ä»£ç ï¼š

```java
enum Sex {
    MALE, FEMALE
}
```

```java
public class Candy7 {
    public static void foo(Sex sex) {
        switch (sex) {
            case MALE:
                System.out.println("ç”·"); break;
            case FEMALE:
                System.out.println("å¥³"); break;
        }
    }
}
```

è½¬æ¢åä»£ç ï¼š

>æšä¸¾ç±»å…¶å®åº•å±‚ä¼šç”Ÿæˆä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåˆæˆç±»

```java
public class Candy7 {
    /**
     * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰
     * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»
     * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹
     * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1
     */
    static class $MAP {
        // æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­—
        static int[] map = new int[2];
        static {
            map[Sex.MALE.ordinal()] = 1;
            map[Sex.FEMALE.ordinal()] = 2;
        }
    }
    public static void foo(Sex sex) {
        int x = $MAP.map[sex.ordinal()];// sex.ordinal()æšä¸¾çš„ç¼–å·
        switch (x) {
            case 1:
                System.out.println("ç”·");
                break;
            case 2:
                System.out.println("å¥³");
                break;
        }
    }
}
```

### 3.8 æšä¸¾ç±»

JDK 7 æ–°å¢äº†æšä¸¾ç±»ï¼Œä»¥å‰é¢çš„æ€§åˆ«æšä¸¾ä¸ºä¾‹ï¼š

```java
enum Sex {
    MALE, FEMALE
}
```

è½¬æ¢åä»£ç ï¼š

```java
public final class Sex extends Enum<Sex> {
    public static final Sex MALE;
    public static final Sex FEMALE;
    private static final Sex[] $VALUES;
    static {
        MALE = new Sex("MALE", 0);
        FEMALE = new Sex("FEMALE", 1);
        $VALUES = new Sex[]{MALE, FEMALE};
    }
    /**
     * Sole constructor. Programmers cannot invoke this constructor.
     * It is for use by code emitted by the compiler in response to
     * enum type declarations.
     *
     * @param name - The name of this enum constant, which is the identifier
     * used to declare it.
     * @param ordinal - The ordinal of this enumeration constant (its position
     * in the enum declaration, where the initial constant is assigned
     */
    private Sex(String name, int ordinal) {
        super(name, ordinal);
    }
    public static Sex[] values() {
        return $VALUES.clone();
    }
    public static Sex valueOf(String name) {
        return Enum.valueOf(Sex.class, name);
    }
}

```

### 3.9 try-with-resources

JDK 7 å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³• `try-with-resources`ï¼š

```java
try(èµ„æºå˜é‡ = åˆ›å»ºèµ„æºå¯¹è±¡){
    
} catch( ) {
    
}
```

å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç° **AutoCloseable** æ¥å£ï¼Œä¾‹å¦‚ **InputStream** ã€ **OutputStream** ã€ **Connection** ã€ **Statement** ã€ **ResultSet** ç­‰æ¥å£éƒ½å®ç°äº† **AutoCloseable** ï¼Œä½¿ç”¨ `try-with[]resources` å¯ä»¥ä¸ç”¨å†™ finally è¯­å¥å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç ï¼Œä¾‹å¦‚

```java
public class Candy9 {
    public static void main(String[] args) {
        try(InputStream is = new FileInputStream("d:\\1.txt")) {
            System.out.println(is);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

ä¼šè¢«jvmè½¬æ¢ä¸ºï¼š

```java
public class Candy9 {
    public Candy9() {
    }
    public static void main(String[] args) {
        try {
            InputStream is = new FileInputStream("d:\\1.txt");
            Throwable t = null;
            try {
                System.out.println(is);
            } catch (Throwable e1) {
                // t æ˜¯æˆ‘ä»¬ä»£ç å‡ºç°çš„å¼‚å¸¸
                t = e1;
                throw e1;
            } finally {
                // åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º
                if (is != null) {
                    // å¦‚æœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸
                    if (t != null) {
                        try {
                            is.close();
                        } catch (Throwable e2) {
                            // å¦‚æœ close å‡ºç°å¼‚å¸¸ï¼Œä½œä¸ºè¢«å‹åˆ¶å¼‚å¸¸æ·»åŠ 
                            t.addSuppressed(e2);
                        }
                    } else {
                        // å¦‚æœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºç°çš„å¼‚å¸¸å°±æ˜¯æœ€å catch å—ä¸­çš„ e
                        is.close();
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ª **addSuppressed(Throwable e)** ï¼ˆæ·»åŠ è¢«å‹åˆ¶å¼‚å¸¸ï¼‰çš„æ–¹æ³•å‘¢ï¼Ÿæ˜¯ä¸ºäº†é˜²æ­¢å¼‚å¸¸ä¿¡ æ¯çš„ä¸¢å¤±ï¼ˆæƒ³æƒ³ try-with-resources ç”Ÿæˆçš„ fianlly ä¸­å¦‚æœæŠ›å‡ºäº†å¼‚å¸¸ï¼‰ï¼š

```java
public class Test6 {
    public static void main(String[] args) {
        try (MyResource resource = new MyResource()) {
            int i = 1/0;
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
class MyResource implements AutoCloseable {
    public void close() throws Exception {
        throw new Exception("close å¼‚å¸¸");
    }
}
```

è¾“å‡ºï¼š

```ruby
java.lang.ArithmeticException: / by zero
    at test.Test6.main(Test6.java:7)
    Suppressed: java.lang.Exception: close å¼‚å¸¸
        at test.MyResource.close(Test6.java:18)
        at test.Test6.main(Test6.java:6)
```

å¦‚ä»¥ä¸Šä»£ç æ‰€ç¤ºï¼Œä¸¤ä¸ªå¼‚å¸¸ä¿¡æ¯éƒ½ä¸ä¼šä¸¢ã€‚

### 3.10 æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³• 

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ–¹æ³•é‡å†™æ—¶å¯¹è¿”å›å€¼åˆ†ä¸¤ç§æƒ…å†µ

- çˆ¶å­ç±»çš„è¿”å›å€¼å®Œå…¨ä¸€è‡´ 
- å­ç±»è¿”å›å€¼å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›å€¼çš„å­ç±»ï¼ˆæ¯”è¾ƒç»•å£ï¼Œè§ä¸‹é¢çš„ä¾‹å­ï¼‰

### 3.11 åŒ¿åå†…éƒ¨ç±»

æºä»£ç ï¼š

```java
public class Candy11 {
    public static void main(String[] args) {
        Runnable runnable = new Runnable() {
            @Override
            public void run() {
                System.out.println("ok");
            }
        };
    }
}
```

è½¬æ¢åä»£ç ï¼š

```java
final class Candy11$1 implements Runnable {
    Candy11$1() {
    }
    public void run() {
        System.out.println("ok");
    }
}
```

```java
public class Candy11 {
    public static void main(String[] args) {
        Runnable runnable = new Candy11$1();
    }
}
```

å¼•ç”¨å±€éƒ¨å˜é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œæºä»£ç ï¼š

```java
public class Candy11 {
    public static void test(final int x) {
        Runnable runnable = new Runnable() {
            @Override
            public void run() {
                System.out.println("ok:" + x);
            }
        };
    }
}
```

è½¬æ¢åä»£ç ï¼š

```java
// é¢å¤–ç”Ÿæˆçš„ç±»
final class Candy11$1 implements Runnable {
    int val$x;
    Candy11$1(int x) {
        this.val$x = x;
    }
    public void run() {
        System.out.println("ok:" + this.val$x);
    }
}
```

```java
public class Candy11 {
    public static void test(final int x) { //java8ä¸­å¯ä»¥ä¸ç”¨å†™final è¯­æ³•ç³–
        Runnable runnable = new Candy11$1(x);
    }
}
```

>æ³¨æ„ 
>
>è¿™åŒæ—¶è§£é‡Šäº†ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»å¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œå±€éƒ¨å˜é‡å¿…é¡»æ˜¯ `final `çš„ï¼šå› ä¸ºåœ¨åˆ›å»º Candy11$1 å¯¹è±¡æ—¶ï¼Œå°† x çš„å€¼èµ‹å€¼ç»™äº† Candy11$1 å¯¹è±¡çš„ val$x å±æ€§ï¼Œæ‰€ä»¥ x ä¸åº”è¯¥å†å‘ç”Ÿå˜ åŒ–äº†ï¼Œå¦‚æœå˜åŒ–ï¼Œé‚£ä¹ˆ val$x å±æ€§æ²¡æœ‰æœºä¼šå†è·Ÿç€ä¸€èµ·å˜åŒ–

