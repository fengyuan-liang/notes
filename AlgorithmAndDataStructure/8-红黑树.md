# çº¢é»‘æ ‘

## 1. çº¢é»‘æ ‘æ€§è´¨

çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œä»¥å‰ä¹Ÿå«å¹³è¡¡äºŒå‰Bæ ‘(Symmetric Binary B-tree)

çº¢é»‘æ ‘å¿…é¡»æ»¡è¶³ä»¥ä¸‹äº”æ¡æ€§è´¨ï¼š

1. ç»“ç‚¹æ˜¯`RED`æˆ–è€…`BLACK`
2. æ ¹ç»“ç‚¹æ˜¯`BLACK`
3. å¶å­ç»“ç‚¹(å¤–éƒ¨ç»“ç‚¹ï¼Œä¸ºç©ºç»“ç‚¹)éƒ½æ˜¯`BLACK`
4. `RED`ç»“ç‚¹çš„å­ç»“ç‚¹éƒ½æ˜¯`BLACK`
   - redç»“ç‚¹çš„parentéƒ½æ˜¯black
     - ä»æ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„redç»“ç‚¹

5. ä»ä»»æ„ç»“ç‚¹åˆ°`å¶å­ç»“ç‚¹`çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„`BLACK`ç»“ç‚¹

![image-20220419180531046](https://cdn.fengxianhub.top/resources-master/202204191805243.png)

>å¯èƒ½åˆšçœ‹å®Œï¼Œä¼šæ„Ÿè§‰å®Œå…¨æ‘¸ä¸åˆ°å¤´è„‘ï¼Œè¿™ï¼Ÿè¿™å•¥ç©æ„ï¼ï¼Ÿæ­¤æ—¶æˆ‘ä»¬çš„è¡¨æƒ…å¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œæ²¡æœ‰å…³ç³»ï¼Œå¥½å¥½å­¦ä¸€å®šèƒ½å­¦ä¼š

![image-20220419181105375](https://cdn.fengxianhub.top/resources-master/202204191811589.png)

åœ¨æˆ‘ä»¬åˆ†æçº¢é»‘æ ‘ä¹‹å‰éœ€è¦å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ£µæ ‘æ»¡ä¸æ»¡è¶³çº¢é»‘æ ‘çš„æ€§è´¨ï¼š

![image-20220517152525868](https://cdn.fengxianhub.top/resources-master/202205171525988.png)

>æˆ‘ä»¬é‡ç‚¹çœ‹æ€§è´¨äº”ï¼Œä»ä»»æ„ç»“ç‚¹åˆ°`å¶å­ç»“ç‚¹`çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„`BLACK`ç»“ç‚¹
>
>è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ï¼Œåœ¨çº¢é»‘æ ‘ä¸­ï¼Œå¶å­ç»“ç‚¹å¹¶ä¸æ˜¯å›¾ä¸­çš„åƒ`25`ã€`74`çš„ç»“ç‚¹ï¼Œåœ¨çº¢é»‘æ ‘ä¸­ï¼Œå¶å­ç»“ç‚¹æ˜¯è™šæ„å‡ºæ¥çš„ç»“ç‚¹ï¼Œä¸”å…¨éƒ¨ä¸ºblackç»“ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä½ç½®`1`ï¼Œæ˜¾ç„¶ä¸æ»¡è¶³çº¢é»‘æ ‘ä¸­çš„æ€§è´¨äº”ï¼Œæ‰€ä»¥è¿™äº”æ¡æ€§è´¨æˆ‘ä»¬åº”è¯¥ç‰¢è®°æ¸…é™¤ï¼

![image-20220517152804712](https://cdn.fengxianhub.top/resources-master/202205171528816.png)

## 2. çº¢é»‘æ ‘ä¸Bæ ‘çš„ç­‰ä»·å˜æ¢

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ£µçº¢é»‘æ ‘

![image-20220517153215382](https://cdn.fengxianhub.top/resources-master/202205171532452.png)

æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹è¿™æ£µçº¢é»‘æ ‘åšå‡ºä¸€äº›è°ƒæ•´ï¼Œæˆ‘ä»¬è®©æ‰€æœ‰çš„`çº¢è‰²ç»“ç‚¹`éƒ½ä¸Šå‡ä¸€å±‚ï¼Œå’Œå…¶çˆ¶ç»“ç‚¹åŒä¸€å±‚æ’åˆ—

![image-20220517153340973](https://cdn.fengxianhub.top/resources-master/202205171533043.png)

æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆçœ¼ç†ŸğŸ˜ï¼Œè¿™ä¸å°±æ˜¯`Bæ ‘`å—ï¼Ÿè€Œä¸”è¿˜æ˜¯ä¸€æ£µå››é˜¶Bæ ‘

![image-20220517153508552](https://cdn.fengxianhub.top/resources-master/202205171535607.png)

>ç»“è®ºï¼š
>
>- çº¢é»‘æ ‘ å’Œ 4é˜¶Bæ ‘ï¼ˆ2-3-4æ ‘ï¼‰å…·æœ‰ç­‰ä»·æ€§
>- `BLACK` èŠ‚ç‚¹ä¸å®ƒçš„ `RED `å­èŠ‚ç‚¹èåˆåœ¨ä¸€èµ·ï¼Œå½¢æˆ`1ä¸ªBæ ‘èŠ‚ç‚¹`
>- çº¢é»‘æ ‘çš„ BLACK èŠ‚ç‚¹ä¸ªæ•° ä¸ 4é˜¶Bæ ‘çš„èŠ‚ç‚¹æ€»ä¸ªæ•°ç›¸ç­‰

å…¶ä»–å¸¸è§å˜æ¢æœ‰ï¼š

![image-20220517154150856](https://cdn.fengxianhub.top/resources-master/202205171541957.png)

## 3. æ·»åŠ 

**åœ¨å®Œæˆçº¢é»‘æ ‘æ·»åŠ ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨åŸæœ‰çš„ä»£ç ä¸­æ·»åŠ ä¸€äº›è¾…åŠ©å‡½æ•°**

çº¢é»‘æ ‘å…·æœ‰BSTçš„æ€§è´¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è®©çº¢é»‘æ ‘ç»§æ‰¿BSTï¼Œå¹¶ä¸”æˆ‘ä»¬æ·»åŠ ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œä¾¿äºä¹‹åæˆ‘ä»¬çš„æ“ä½œ

```java
/**
 * @Description: çº¢é»‘æ ‘
 * @date: 2022/5/17 15:47
 * @author: æ¢å³°æº
 */
public class RedBlackTree<E> extends BinarySearchTree<E> {
    private static final boolean RED = false;
    private static final boolean BLACK = true;

    public RedBlackTree() {
    }

    public RedBlackTree(Comparator<E> comparator) {
        super(comparator);
    }

    /**
     * çº¢é»‘æ ‘ç»“ç‚¹
     *
     * @param <E>
     */
    private static class RBNode<E> extends Node<E> {
        boolean color;
        public RBNode(E element, Node<E> parent) {
            super(element, parent);
        }
    }

    @Override
    protected void afterAdd(Node<E> node) {
        super.afterAdd(node);
    }

    @Override
    protected void afterRemove(Node<E> node) {
        super.afterRemove(node);
    }

    /**
     * å°†å…ƒç´ æŸ“è‰²
     * @param node å¸¦æŸ“è‰²çš„ç»“ç‚¹
     * @param color éœ€è¦æŸ“çš„é¢œè‰²
     * @return å°†æŸ“è‰²çš„ç»“ç‚¹è¿”å›
     */
    private Node<E> color(Node<E> node,boolean color){
        if(node == null) return node;
        ((RBNode<E>)node).color = color;
        return node;
    }
    //æŸ“æˆçº¢è‰²
    private Node<E> red(Node<E> node){
        return color(node,RED);
    }
    //æŸ“æˆé»‘è‰²
    private Node<E> black(Node<E> node){
        return color(node,BLACK);
    }
    //æŸ¥çœ‹å½“å‰ç»“ç‚¹é¢œè‰²
    private boolean colorOf(Node<E> node){
        return node == null ? BLACK : ((RBNode<E>)node).color;
    }
    private boolean isBlack(Node<E> node){
        return colorOf(node) == BLACK;
    }
    private boolean isRea(Node<E> node){
        return colorOf(node) == RED;
    }
}
```

åœ¨BSTçš„ç»“ç‚¹ä¸­æˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€äº›æ–¹æ³•

```java
// è¿”å›å½“å‰ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹
public Node<E> sibling(){
    if(isLeftChild()){
        return parent.right;
    }
    if(isRightChild()){
        return parent.left;
    }
    //æ²¡æœ‰å…„å¼Ÿç»“ç‚¹
    return null;
}
```

>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®Œæˆçº¢é»‘æ ‘çš„æ·»åŠ ä»£ç 
>
>åœ¨çº¢é»‘æ ‘çš„æ·»åŠ ä¸­æˆ‘ä»¬è¦æ—¶åˆ»ç‰¢è®°`Bæ ‘`çš„ä¸€äº›åŸºæœ¬æ€§è´¨ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ›´å¥½çš„ç†è§£çº¢é»‘æ ‘çš„æ€§è´¨

æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¾ˆå¤š`Bæ ‘`çš„æ€§è´¨

- Bæ ‘ä¸­ï¼Œæ–°å…ƒç´ å¿…å®šæ˜¯æ·»åŠ åˆ°å¶å­èŠ‚ç‚¹ä¸­
- 4é˜¶Bæ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å…ƒç´ ä¸ªæ•° x éƒ½ç¬¦åˆ `1 â‰¤ x â‰¤ 3`

**å»ºè®®æ–°æ·»åŠ çš„èŠ‚ç‚¹é»˜è®¤ä¸º REDï¼Œè¿™æ ·èƒ½å¤Ÿè®©çº¢é»‘æ ‘çš„æ€§è´¨å°½å¿«æ»¡è¶³ï¼ˆæ€§è´¨ 1ã€2ã€3ã€5 éƒ½æ»¡è¶³ï¼Œæ€§è´¨ 4 ä¸ä¸€å®šï¼‰**

**å¦‚æœæ·»åŠ çš„æ˜¯æ ¹èŠ‚ç‚¹ï¼ŒæŸ“æˆ BLACK å³å¯**

>æˆ‘ä»¬ä»¥ä¸‹é¢çš„çº¢é»‘æ ‘ä¸ºä¾‹æ¥çœ‹åˆ†ææ·»åŠ å…ƒç´ çš„æ‰€æœ‰æƒ…å†µ

![image-20220517163922449](https://cdn.fengxianhub.top/resources-master/202205171639538.png)

æˆ‘ä»¬åœ¨æ­¤æ£µçº¢é»‘æ ‘ä¸Šæ·»åŠ å…ƒç´ ä¸€å…±ä¼šæœ‰**12ç§æƒ…å†µ**ï¼ˆç»“åˆ`Bæ ‘`çš„æ€§è´¨æˆ‘ä»¬çŸ¥é“æ·»åŠ çš„å…ƒç´ ä¸€å®šä¼šåˆ°å¶å­ç»“ç‚¹ä¸Šï¼‰

![image-20220517164321529](https://cdn.fengxianhub.top/resources-master/202205171643625.png)

å…¶ä¸­åœ¨å››ä¸ªåœ°æ–¹æ·»åŠ ç»“ç‚¹å¯ä»¥æ»¡è¶³çº¢é»‘æ ‘æ‰€æœ‰çš„æ€§è´¨ï¼ˆ`parent ä¸º BLACK`ï¼‰ï¼Œ**å› æ­¤ä¸ç”¨åšä»»ä½•é¢å¤–å¤„ç†**

![image-20220517164658153](https://cdn.fengxianhub.top/resources-master/202205171646235.png)



>å‰©ä¸‹**8ç§æƒ…å†µ**çš„æ·»åŠ éƒ½ä¸èƒ½æ»¡è¶³çº¢é»‘æ ‘çš„æ€§è´¨ï¼ˆä¸æ»¡è¶³æ€§è´¨å››ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ†åˆ«è®¨è®ºå¹¶è§£å†³

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æƒ…å†µå°±æ˜¯`parentä¸ºredï¼ˆdouble redï¼‰`çš„æƒ…å†µ

![image-20220517165201462](https://cdn.fengxianhub.top/resources-master/202205171652556.png)

### 3.1 double red - LL/RR-å³æ—‹/å·¦æ—‹

å½“æˆ‘ä»¬æ·»åŠ çš„ç»“ç‚¹å‡ºç°ä»¥ä¸‹çš„ä¸¤ç§æƒ…å†µçš„æ—¶å€™ï¼ˆçœ‹`52`å’Œ`60`ä¸¤ä¸ªç»“ç‚¹ï¼‰ï¼š

- æˆ‘ä»¬çš„åšæ³•æ˜¯å°†`50`ç»“ç‚¹æŸ“æˆé»‘è‰²å¹¶ä¸”å°†`46`ç»“ç‚¹æŸ“æˆçº¢è‰²ï¼Œå¹¶å¯¹`46`ç»“ç‚¹è¿›è¡Œå·¦æ—‹

  å°†parentæŸ“æˆé»‘è‰²ï¼Œå†å°†grandæŸ“æˆçº¢è‰²ï¼Œæœ€åå¯¹parentè¿›è¡Œå·¦æ—‹

- å…¶å®å¾ˆæœ‰è§„å¾‹ï¼Œé»‘è‰²ç»“ç‚¹çš„RRä¸¤ä¸ªç»“ç‚¹éƒ½ä¸ºçº¢è‰²ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ`RR-å·¦æ—‹`ï¼Œè¿™ç‚¹å’ŒAVLæ ‘éå¸¸çš„åƒï¼Œåªæ˜¯çº¢é»‘æ ‘éœ€è¦å°†ç»“ç‚¹é‡æ–°æŸ“è‰²

åŒç†æˆ‘ä»¬å¯¹`76`ç»“ç‚¹é‡‡å–çš„æ–¹å¼ä¸€æ ·ï¼Œå› ä¸ºé»‘ç»“ç‚¹çš„`LL`ä¸¤ä¸ªç»“ç‚¹ä¸æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨å››ï¼Œæˆ‘ä»¬å°±éœ€è¦å®Œæˆ`LL-å³æ—‹`ï¼Œå¹¶å°†`72`å’Œ`76`ä¸¤ä¸ªç»“ç‚¹é‡æ–°æŸ“è‰²

![image-20220517170525137](https://cdn.fengxianhub.top/resources-master/202205171705219.png)

ğŸˆğŸˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“æ­¥éª¤ï¼š

åˆ¤å®šæ¡ä»¶ï¼š`uncle ä¸æ˜¯ RED`ï¼ˆuncle ä¸ºå…¶çˆ¶ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹ï¼‰

1. parent æŸ“æˆ BLACKï¼Œgrand æŸ“æˆ RED
2. grand è¿›è¡Œå•æ—‹æ“ä½œï¼ˆLLï¼šå³æ—‹è½¬ã€RRï¼šå·¦æ—‹è½¬ï¼‰

å®Œæˆåçš„æ•ˆæœå›¾ä¸ºï¼š

![image-20220517171246737](https://cdn.fengxianhub.top/resources-master/202205171712823.png)

### 3.2 double red - LR/RL-åŒæ—‹

ä¸‹é¢çš„ä¸¤ç§double redäº§ç”Ÿçš„æƒ…å†µæ˜¯å› ä¸ºé»‘è‰²ç»“ç‚¹çš„**RL**å’Œ**LR**ç»“ç‚¹éƒ½ä¸ºçº¢è‰²ç»“ç‚¹è€Œå¯¼è‡´å¼‚å¸¸

æˆ‘ä»¬åœ¨AVLæ ‘ä¸­å·²ç»çŸ¥é“éœ€è¦è¿›è¡ŒåŒæ—‹æ¥è§£å†³è¿™ç§æƒ…å†µï¼š

- RLï¼šLLå³æ—‹è½¬ï¼ŒRRå·¦æ—‹è½¬ï¼ˆå¯¹ç»“ç‚¹`50`è¿›è¡Œå³æ—‹è½¬æ¥ç€å¯¹ç»“ç‚¹`46`è¿›è¡Œå·¦æ—‹è½¬ï¼‰
- LRï¼šRRå·¦æ—‹è½¬ï¼ŒLLå³æ—‹è½¬ï¼ˆå¯¹ç»“ç‚¹`72`è¿›è¡Œå·¦æ—‹è½¬æ¥ç€å¯¹ç»“ç‚¹`76`è¿›è¡Œå³æ—‹è½¬ï¼‰

![image-20220517171413653](https://cdn.fengxianhub.top/resources-master/202205171714741.png)

è°ƒæ•´åçš„ç»“ç‚¹ä¸ºï¼š

![image-20220517172219148](https://cdn.fengxianhub.top/resources-master/202205171722231.png)

ğŸˆğŸˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“æ­¥éª¤ï¼š

åˆ¤å®šæ¡ä»¶ï¼š`uncle ä¸æ˜¯ RED`ï¼ˆuncle ä¸ºå…¶çˆ¶ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹ï¼‰

1. è‡ªå·±æŸ“æˆ `BLACK`ï¼Œgrand æŸ“æˆ `RED`
2. è¿›è¡ŒåŒæ—‹æ“ä½œ
   - LRï¼šparent å·¦æ—‹è½¬ï¼Œ grand å³æ—‹è½¬
   - RLï¼šparent å³æ—‹è½¬ï¼Œ grand å·¦æ—‹è½¬

### 3.3 æ·»åŠ  â€“ ä¿®å¤æ€§è´¨4 â€“ä¸Šæº¢ â€“ LL

![image-20220629125055598](https://cdn.fengxianhub.top/resources-master/202206291255454.png)

ä¸Šé¢çš„çº¢é»‘æ ‘ä¸­å› ä¸ºå…ƒç´ `10`ï¼Œå¯¼è‡´å››é˜¶Bæ ‘ç»“ç‚¹è¶…è¿‡ä¸‰ä¸ªï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šè¿›è¡Œä¸Šæº¢ï¼Œä¸Šæº¢å°±æ˜¯è·³å‡ºä¸­é—´å…ƒç´ å¹¶å‘ä¸Šåˆå¹¶ï¼Œå·¦å³åˆ†è£‚

**åˆ¤å®šæ¡ä»¶ï¼šuncle æ˜¯ RED**

è§£å†³æ–¹æ¡ˆï¼š

-  parentã€uncle æŸ“æˆ **BLACK**ï¼ˆå°†17å’Œ33ä¸¤ä¸ªç»“ç‚¹æŸ“æˆé»‘è‰²å¹¶åˆ†è£‚ï¼‰
-  grand å‘ä¸Šåˆå¹¶ï¼ˆå°†ç»“ç‚¹25å½“åšæ˜¯æ–°æ’å…¥çš„ç»“ç‚¹å¹¶è¿›è¡Œä¿®å¤å³å¯ï¼‰

è¿™æ—¶å€™ç»“ç‚¹`25`ä¼šä¸Šæº¢ï¼Œä½†æ˜¯åˆä¼šé€ æˆï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯å°†ç»“ç‚¹`25`å½“åšæ˜¯ä¸€ä¸ªæ–°æ’å…¥çš„ç»“ç‚¹ï¼Œç»§ç»­ä¸Šé¢çš„æµç¨‹ï¼Œé€’å½’å¤„ç†

- **æŸ“æˆ REDï¼Œå½“åšæ˜¯æ–°æ·»åŠ çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼ˆé€’å½’æ“ä½œï¼‰**

![image-20220629130421438](https://cdn.fengxianhub.top/resources-master/202206291304532.png)

-  grand å‘ä¸Šåˆå¹¶æ—¶ï¼Œå¯èƒ½ç»§ç»­å‘ç”Ÿä¸Šæº¢
- è‹¥ä¸Šæº¢æŒç»­åˆ°æ ¹èŠ‚ç‚¹ï¼Œåªéœ€å°†æ ¹èŠ‚ç‚¹æŸ“æˆ BLACK

>å¯ä»¥çœ‹å‡ºå…¶å®å‡ºç°LLä¸Šæº¢çš„æƒ…å†µï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹ç»“ç‚¹è¿›è¡Œæ—‹è½¬ï¼Œåªè¿›è¡Œäº†æŸ“è‰²

### 3.4 æ·»åŠ  â€“ ä¿®å¤æ€§è´¨4 â€“ä¸Šæº¢ â€“ RR

åˆ¤å®šæ¡ä»¶ï¼šuncle æ˜¯ RED

- parentã€uncle æŸ“æˆ BLACK
- grand å‘ä¸Šåˆå¹¶

æŸ“æˆ REDï¼Œå½“åšæ˜¯æ–°æ·»åŠ çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†

![image-20220629200535165](https://cdn.fengxianhub.top/resources-master/202206292005516.png)

è§£å†³åï¼š

![image-20220629201140039](https://cdn.fengxianhub.top/resources-master/202206292011174.png)

### 3.5 æ·»åŠ  â€“ ä¿®å¤æ€§è´¨4 â€“ä¸Šæº¢ â€“ LR

åˆ¤å®šæ¡ä»¶ï¼šuncle æ˜¯ RED

- parentã€uncle æŸ“æˆ BLACK
- grand å‘ä¸Šåˆå¹¶

æŸ“æˆ REDï¼Œå½“åšæ˜¯æ–°æ·»åŠ çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†

![image-20220629200759599](https://cdn.fengxianhub.top/resources-master/202206292007711.png)

è§£å†³åï¼š

![image-20220629201111360](https://cdn.fengxianhub.top/resources-master/202206292011489.png)

### 3.6 æ·»åŠ  â€“ ä¿®å¤æ€§è´¨4 â€“ä¸Šæº¢ â€“ RL

åˆ¤å®šæ¡ä»¶ï¼šuncle æ˜¯ RED

- parentã€uncle æŸ“æˆ BLACK
-  grand å‘ä¸Šåˆå¹¶

æŸ“æˆ REDï¼Œå½“åšæ˜¯æ–°æ·»åŠ çš„èŠ‚ç‚¹è¿›è¡Œå¤„ç†

![image-20220629201450876](https://cdn.fengxianhub.top/resources-master/202206292014998.png)

![image-20220629201527944](https://cdn.fengxianhub.top/resources-master/202206292015090.png)

### 3.7 æ·»åŠ æ€»ç»“LL/RR

åˆ¤å®šæ¡ä»¶ï¼šuncleä¸æ˜¯RED

- parentæŸ“æˆBLACKï¼ŒgrandæŸ“æˆRED
- grandè¿›è¡Œå•æ—‹æ“ä½œ

LLå³æ—‹è½¬ã€RRå·¦æ—‹è½¬

![image-20220629202902831](https://cdn.fengxianhub.top/resources-master/202206292029060.png)

### 3.8 æ·»åŠ æ€»ç»“LR/RL

![image-20220629205155204](https://cdn.fengxianhub.top/resources-master/202206292051465.png)

### 3.9 æ·»åŠ æ‰€æœ‰æƒ…å†µå°ç»“

![image-20220629205453664](https://cdn.fengxianhub.top/resources-master/202206292054963.png)



### 3.10 ç¼–ç å®ç°æ·»åŠ 

```java
/**
 * @param node æ–°æ·»åŠ çš„ç»“ç‚¹
 */
@Override
protected void afterAdd(Node<E> node) {
    // å…ˆå–å‡ºçˆ¶ç»“ç‚¹
    Node<E> parent = node.parent;
    // æ·»åŠ çš„æ˜¯æ ¹ç»“ç‚¹(å°†å…¶æŸ“æˆé»‘è‰²å¹¶è¿”å›)æˆ–è€…ä¸Šæº¢åˆ°æ ¹ç»“ç‚¹
    if(parent == null){
        black(node);
        return;
    }
    // å¦‚æœæ˜¯å‰å››ç§æƒ…å†µï¼Œå³çˆ¶ç»“ç‚¹ä¸ºé»‘è‰²ç»“ç‚¹ï¼Œä¸ç”¨å¤„ç†
    if(isBlack(parent)) return;
    // å–å‡ºuncleç»“ç‚¹
    // å–å‡ºç¥–çˆ¶ç»“ç‚¹
    Node<E> grand = parent.parent;
    Node<E> uncle = parent.sibling();
    // å¦‚æœå”çˆ¶ç»“ç‚¹æ˜¯çº¢è‰²ã€Bæ ‘ç»“ç‚¹ä¸Šæº¢ï¼Œåªéœ€è¦æŸ“è‰²ã€‘
    if(isRed(uncle)){
        black(parent);
        black(uncle);
        // æŠŠç¥–çˆ¶ç»“ç‚¹å½“åšæ˜¯æ–°æ·»åŠ çš„ç»“ç‚¹
        // é€’å½’è°ƒç”¨
        afterAdd(red(grand));
        return;
    }
    /*
     * å”çˆ¶ç»“ç‚¹ä¸æ˜¯çº¢è‰²ï¼Œæœ‰å››ç§æƒ…å†µ
     * LL/RR: parentæŸ“æˆBLACKï¼ŒgrandæŸ“æˆRED - grandè¿›è¡Œå•æ—‹æ“ä½œ
     * LR/RL: è‡ªå·±æŸ“æˆblackï¼ŒgrandæŸ“æˆredï¼Œå†åŒæ—‹
     */
    if(parent.isLeftChild()){ // L
        red(grand);
        if(node.isLeftChild()){ // LL
            black(parent);
        }else { // LR
            black(node);
            rotateLeft(parent);
        }
        rotateRight(grand);
    }else { //R
        red(grand);
        if(node.isLeftChild()){ // RL
            black(node);
            rotateRight(parent);
        }else { // RR
            black(parent);
        }
        rotateLeft(grand);
    }
}
```

**æµ‹è¯•ï¼š**

```java
@Test
public void test01(){
    Integer[] data = {
            55, 42, 96, 62, 24, 29, 18, 2, 89, 40, 23, 3
    };
    RedBlackTree<Integer> rb = new RedBlackTree<>();
    for(int i : data){
        rb.add(i);
    }
    BinaryTrees.println(rb);
}
```

ç»“æœï¼š

```css
     â”Œâ”€â”€â”€â”€â”€29â”€â”€â”€â”€â”€â”
     â”‚              â”‚
â”Œâ”€â”€R_18â”€â”€â”     â”Œâ”€R_55â”€â”
â”‚         â”‚     â”‚       â”‚
2â”€â”    â”Œâ”€24 â”Œâ”€42    â”Œâ”€89â”€â”
  â”‚     â”‚    â”‚       â”‚    â”‚
 R_3 R_23 R_40    R_62  R_96
```

## 4. åˆ é™¤

>é¦–å…ˆæˆ‘ä»¬åº”è¯¥çŸ¥é“ï¼š**Bæ ‘ä¸­ï¼Œæœ€åçœŸæ­£è¢«åˆ é™¤çš„å…ƒç´ éƒ½åœ¨å¶å­èŠ‚ç‚¹ä¸­**

å¶å­ç»“ç‚¹æˆ‘ä»¬å¯ä»¥åˆ†ç±»æˆåˆ é™¤`red`ç»“ç‚¹å’Œåˆ é™¤`black`ç»“ç‚¹ä¸¤ç§æƒ…å†µ

### 4.1 åˆ é™¤çº¢è‰²ç»“ç‚¹

å¦‚æœåˆ é™¤çš„æ˜¯çº¢è‰²ç»“ç‚¹ï¼Œç”±äºåˆ é™¤åä¾æ—§æ»¡è¶³çº¢é»‘æ ‘çš„æ€§è´¨ï¼Œæ‰€ä»¥ä¸éœ€è¦åšä»»ä½•çš„è°ƒæ•´

![image-20220711090148171](https://cdn.fengxianhub.top/resources-master/202207110901493.png)

### 4.2 åˆ é™¤é»‘è‰²éå¶å­	ç»“ç‚¹

![image-20220711090437889](https://cdn.fengxianhub.top/resources-master/202207110904057.png)

ä¸€å…±æœ‰ä¸‰ç§æƒ…å†µï¼š

**ç¬¬ä¸€ç§ï¼šåˆ é™¤æ‹¥æœ‰ä¸¤ä¸ªçº¢è‰²å­ç»“ç‚¹çš„blackç»“ç‚¹ï¼ˆå¦‚å›¾25ç»“ç‚¹ï¼‰**

- ä¸å¯èƒ½è¢«ç›´æ¥åˆ é™¤ï¼Œå› ä¸ºä¼šæ‰¾å®ƒçš„å­ç»“ç‚¹æ›¿ä»£åˆ é™¤
- è¿™ç§æƒ…å†µä¸ç”¨åˆ é™¤ä»»ä½•ç»“ç‚¹

ç”±BSTæ€§è´¨å¯çŸ¥ï¼Œåˆ é™¤ä¸€ä¸ªåº¦ä¸º2çš„ç»“ç‚¹ï¼Œå…¶å®æ˜¯åˆ é™¤å…¶å‰é©±æˆ–è€…åç»§ç»“ç‚¹ï¼Œä½†æ˜¯`25`ç»“ç‚¹å‰é©±å’Œåç»§éƒ½æ˜¯çº¢è‰²çš„ï¼Œæ‰€ä»¥ä¸ç”¨åˆ é™¤

**ç¬¬äºŒç§ï¼šæ‹¥æœ‰ä¸€ä¸ª`RED`å­ç»“ç‚¹çš„`BLACK`ç»“ç‚¹**

>å¦‚ä½•åˆ¤æ–­ ï¼Ÿçœ‹ç”¨ä»¥å–ä»£ä»–çš„å­ç»“ç‚¹æ˜¯ä¸æ˜¯çº¢è‰²ç»“ç‚¹

![image-20220711090950509](https://cdn.fengxianhub.top/resources-master/202207110909701.png)

æˆ‘ä»¬æŒ‰ç…§BSTçš„åšæ³•åº”è¯¥æ˜¯è®©å…¶å­ç»“ç‚¹å–ä»£è¦åˆ é™¤çš„ç»“ç‚¹ï¼Œä½†æ˜¯è¿™æ—¶å€™å‡ºç°äº†`double red`çš„æƒ…å†µ

![image-20220711091544683](https://cdn.fengxianhub.top/resources-master/202207110915837.png)

>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨éœ€è¦ä¿®å¤æ€§è´¨ã€‚**è¿™ç§æƒ…å†µä¸‹åªéœ€è¦å°†æ›¿ä»£ç»“ç‚¹æŸ“é»‘å³å¯**

é¦–å…ˆæˆ‘ä»¬è¦åœ¨çˆ¶ç±»BSTé‡Œé¢é‡è½½ä¸€ä¸ªæ–¹æ³•ï¼Œå› ä¸ºçº¢é»‘æ ‘æ˜¯é é¢œè‰²æ¥ç»´æŒæ€§è´¨çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨ä»¥æ›¿æ¢çš„ç»“ç‚¹ä¼ å…¥è¿›å»

```java
/**
 * åˆ é™¤ç»“ç‚¹æ—¶åè¿›è¡Œå¹³è¡¡ã€çˆ¶ç±»é‡è½½çš„æ–¹æ³•ã€‘
 * @param node åˆ é™¤çš„ç»“ç‚¹
 * @param replaceNode ç”¨æ¥æ›¿æ¢çš„ç»“ç‚¹
 */
protected void afterRemove(Node<E> node,Node<E> replaceNode){
}
```

è¿™é‡Œåªå¤„ç†ç¬¬ä¸€æ¬¡æƒ…å†µçš„æƒ…å†µ

```java
@Override
protected void afterRemove(Node<E> node, Node<E> replaceNode) {
    // å¦‚æœåˆ é™¤çš„ç»“ç‚¹æ˜¯çº¢è‰²ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†
    if(isRed(node)) return;
    // ç”¨ä»¥å–ä»£çš„nodeç»“ç‚¹æ˜¯çº¢è‰²
    if(isRed(replaceNode)){
        // ç›´æ¥æŸ“è‰²å°±å¯ä»¥äº†
        black(replaceNode);
        return;
    }
    // åˆ é™¤çš„æ˜¯é»‘è‰²å¶å­ç»“ç‚¹
}
```

### 4.3 ğŸˆåˆ é™¤é»‘è‰²å¶å­ç»“ç‚¹â€“ siblingä¸ºBLACK

#### 4.3.1 å…„å¼Ÿç»“ç‚¹æœ‰çº¢è‰²å­ç»“ç‚¹

>BLACK å¶å­èŠ‚ç‚¹è¢«åˆ é™¤åï¼Œ**ä¼šå¯¼è‡´Bæ ‘èŠ‚ç‚¹ä¸‹æº¢**ï¼ˆæ¯”å¦‚åˆ é™¤88ï¼‰ï¼Œåœ¨Bæ ‘ä¸­çš„åšæ³•ä¸ºï¼š**çˆ¶ç»“ç‚¹ä¸‹æ¥ï¼ŒæŒ‘ä¸€ä¸ªå…„å¼Ÿç»“ç‚¹çš„å­©å­åšçˆ¶äº²**

**å¦‚æœ sibling è‡³å°‘æœ‰ 1 ä¸ª RED å­èŠ‚ç‚¹**

**å£è¯€ï¼šåˆ é™¤é»‘è‰²ç»“ç‚¹ï¼Œå¦‚æœé»‘è‰²çš„å…„å¼Ÿæœ‰çº¢å­©å­ï¼Œå€Ÿå–ä¹‹å½“çˆ¹ï¼Œçˆ¹æ›¿æ¢è‡ªå·±**

- è¿›è¡Œæ—‹è½¬æ“ä½œ 
- æ—‹è½¬ä¹‹åçš„ä¸­å¿ƒèŠ‚ç‚¹ç»§æ‰¿ parent çš„é¢œè‰² 
- æ—‹è½¬ä¹‹åçš„å·¦å³èŠ‚ç‚¹æŸ“ä¸º BLACK

![image-20220711102945605](https://cdn.fengxianhub.top/resources-master/202207111029843.png)

å¹³è¡¡åï¼š

![image-20220711103839399](https://cdn.fengxianhub.top/resources-master/202207111038554.png)

#### 4.3.2 å…„å¼Ÿç»“ç‚¹æ²¡æœ‰çº¢è‰²å­ç»“ç‚¹

åˆ¤å®šæ¡ä»¶ï¼šsibling æ²¡æœ‰ 1 ä¸ª RED å­èŠ‚ç‚¹

**å°† sibling æŸ“æˆ REDã€parent æŸ“æˆ BLACK å³å¯ä¿®å¤çº¢é»‘æ ‘æ€§è´¨**

å¦‚æœ parent æ˜¯ BLACKï¼Œä¼šå¯¼è‡´ parent ä¹Ÿä¸‹æº¢ï¼Œè¿™æ—¶åªéœ€è¦æŠŠ parent å½“åšè¢«åˆ é™¤çš„èŠ‚ç‚¹å¤„ç†å³å¯

![image-20220711211527660](https://cdn.fengxianhub.top/resources-master/202207112115750.png)

#### 4.3.3 å°ç»“

![image-20220711211302679](https://cdn.fengxianhub.top/resources-master/202207112113789.png)

- å¦‚æœè¢«åˆ é™¤ç»“ç‚¹çš„é»‘å…„å¼Ÿå¯ä»¥å€Ÿï¼ˆæœ‰çº¢è‰²ç»“ç‚¹ï¼‰ï¼Œé€šè¿‡é€‰æ‹©å€Ÿå–ç»“ç‚¹
- å¦‚æœé»‘å…„å¼Ÿä¸èƒ½å€Ÿï¼Œå¦‚æœçˆ¶ç»“ç‚¹ä¸ºçº¢ï¼ˆä¸ä¼šå¯¼è‡´å¤±è¡¡ï¼‰å°±è®©çˆ¶ç»“ç‚¹ä¸‹æ¥å’Œæˆ‘çš„é»‘å…„å¼Ÿåˆå¹¶åˆ°ä¸€èµ·ï¼Œå¦‚æœçˆ¶ç»“ç‚¹ä¸ºé»‘ï¼Œå°†parent å½“åšè¢«åˆ é™¤çš„èŠ‚ç‚¹å¤„ç†å³å¯ï¼ˆé€’å½’ä¸€æ¬¡ï¼‰

### 4.4 åˆ é™¤é»‘è‰²å¶å­èŠ‚ç‚¹ â€“ siblingä¸ºRED

**åˆ¤æ–­æ¡ä»¶ï¼š sibling æ˜¯ RED**

**è§£å†³æ–¹æ¡ˆ**ï¼š

 

![image-20220711212233581](https://cdn.fengxianhub.top/resources-master/202207112122667.png)

### 4.5 ç¼–ç 

```java
@Override
protected void afterRemove(Node<E> node, Node<E> replaceNode) {
    // å¦‚æœåˆ é™¤çš„ç»“ç‚¹æ˜¯çº¢è‰²ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†
    if (isRed(node)) return;
    // ç”¨ä»¥å–ä»£çš„nodeç»“ç‚¹æ˜¯çº¢è‰²
    if (isRed(replaceNode)) {
        // ç›´æ¥æŸ“è‰²å°±å¯ä»¥äº†
        black(replaceNode);
        return;
    }
    // åˆ é™¤çš„æ˜¯é»‘è‰²å¶å­ç»“ç‚¹
    // æ‹¿åˆ°parent
    Node<E> parent = node.parent;
    // å¦‚æœæ˜¯æ ¹ç»“ç‚¹ä¸åšå¤„ç†
    if (parent == null) return;
    // è¿™é‡Œåˆ¤æ–­nodeç»“ç‚¹æ˜¯å·¦è¿˜æ˜¯å³ï¼Œéœ€è¦çœ‹çˆ¶ç»“ç‚¹æ¸…ç©ºäº†è°
    boolean left = parent.left == null || node.isLeftChild();
    Node<E> sibling = left ? parent.right : parent.left;
    if (left) { // è¢«åˆ é™¤çš„ç»“ç‚¹åœ¨å·¦è¾¹ï¼Œå…„å¼Ÿç»“ç‚¹åœ¨å³è¾¹
        /*
         * sibling æŸ“æˆ BLACKï¼Œparent æŸ“æˆ REDï¼Œè¿›è¡Œæ—‹è½¬
         * äºæ˜¯åˆå›åˆ° sibling æ˜¯ BLACK çš„æƒ…å†µ
         */
        if (isRed(sibling)) {
            black(sibling);
            red(parent);
            rotateLeft(parent);
            // æ›´æ¢å…„å¼Ÿ
            sibling = parent.right;
        }
        // å…„å¼Ÿç»“ç‚¹å¿…ç„¶æ˜¯é»‘è‰²
        if (isBlack(sibling.left) && isBlack(sibling.right)) {
            // å…„å¼Ÿç»“ç‚¹æ²¡æœ‰çº¢è‰²å­ç»“ç‚¹ï¼Œçˆ¶ç»“ç‚¹è¦å‘ä¸‹è·Ÿå…„å¼Ÿç»“ç‚¹åˆå¹¶ï¼Œå…¶å®å°±æ˜¯çˆ¶ç»“ç‚¹æŸ“çº¢ï¼Œå…„å¼Ÿç»“ç‚¹æŸ“é»‘
            boolean parentIsBlack = isBlack(parent);
            red(parent);
            black(sibling);
            // å¦‚æœä¸‹æº¢ä¼šå¯¼è‡´çˆ¶ç»“ç‚¹ç©ºï¼Œå¯ä»¥å½“åšçˆ¶ç»“ç‚¹è¢«åˆ é™¤æ¥çœ‹å¾…ï¼Œé€’å½’è°ƒç”¨å³å¯
            if (parentIsBlack) afterRemove(parent, null);
        } else { // å…„å¼Ÿç»“ç‚¹ä¸€å®šæœ‰çº¢è‰²çš„å­ç»“ç‚¹
            // å…„å¼Ÿç»“ç‚¹å·¦è¾¹æ˜¯é»‘è‰²ï¼Œå…„å¼Ÿè¦å…ˆæ—‹è½¬
            if (isBlack(sibling.right)) {
                rotateRight(sibling);
                // å…„å¼Ÿç»“ç‚¹éœ€è¦é‡æ–°èµ‹å€¼
                sibling = parent.right;
            }
            // å…„å¼Ÿç»“ç‚¹æŸ“æˆçˆ¶ç»“ç‚¹çš„é¢œè‰²
            color(sibling, colorOf(parent));
            // å°†çˆ¶ç»“ç‚¹çš„å·¦å³å­ç»“ç‚¹éƒ½æŸ“æˆé»‘è‰²
            black(sibling.right);
            black(parent);
            // å¯¹çˆ¶ç»“ç‚¹è¿›è¡Œå³æ—‹è½¬
            rotateLeft(parent);
        }
    } else { // è¢«åˆ é™¤çš„ç»“ç‚¹åœ¨å³è¾¹ï¼Œå…„å¼Ÿç»“ç‚¹åœ¨å·¦è¾¹
        /*
         * sibling æŸ“æˆ BLACKï¼Œparent æŸ“æˆ REDï¼Œè¿›è¡Œæ—‹è½¬
         * äºæ˜¯åˆå›åˆ° sibling æ˜¯ BLACK çš„æƒ…å†µ
         */
        if (isRed(sibling)) {
            black(sibling);
            red(parent);
            rotateRight(parent);
            // æ›´æ¢å…„å¼Ÿ
            sibling = parent.left;
        }
        // å…„å¼Ÿç»“ç‚¹å¿…ç„¶æ˜¯é»‘è‰²
        if (isBlack(sibling.left) && isBlack(sibling.right)) {
            // å…„å¼Ÿç»“ç‚¹æ²¡æœ‰çº¢è‰²å­ç»“ç‚¹ï¼Œçˆ¶ç»“ç‚¹è¦å‘ä¸‹è·Ÿå…„å¼Ÿç»“ç‚¹åˆå¹¶ï¼Œå…¶å®å°±æ˜¯çˆ¶ç»“ç‚¹æŸ“çº¢ï¼Œå…„å¼Ÿç»“ç‚¹æŸ“é»‘
            boolean parentIsBlack = isBlack(parent);
            red(parent);
            black(sibling);
            // å¦‚æœä¸‹æº¢ä¼šå¯¼è‡´çˆ¶ç»“ç‚¹ç©ºï¼Œå¯ä»¥å½“åšçˆ¶ç»“ç‚¹è¢«åˆ é™¤æ¥çœ‹å¾…ï¼Œé€’å½’è°ƒç”¨å³å¯
            if (parentIsBlack) afterRemove(parent, null);
        } else { // å…„å¼Ÿç»“ç‚¹ä¸€å®šæœ‰çº¢è‰²çš„å­ç»“ç‚¹
            // å…„å¼Ÿç»“ç‚¹å·¦è¾¹æ˜¯é»‘è‰²ï¼Œå…„å¼Ÿè¦å…ˆæ—‹è½¬
            if (isBlack(sibling.left)) {
                rotateLeft(sibling);
                // å…„å¼Ÿç»“ç‚¹éœ€è¦é‡æ–°èµ‹å€¼
                sibling = parent.left;
            }
            // å…„å¼Ÿç»“ç‚¹æŸ“æˆçˆ¶ç»“ç‚¹çš„é¢œè‰²
            color(sibling, colorOf(parent));
            // å°†çˆ¶ç»“ç‚¹çš„å·¦å³å­ç»“ç‚¹éƒ½æŸ“æˆé»‘è‰²
            black(sibling.left);
            black(parent);
            // å¯¹çˆ¶ç»“ç‚¹è¿›è¡Œå³æ—‹è½¬
            rotateRight(parent);
        }
    }
}
```



## 5. çº¢é»‘æ ‘å®Œæ•´ä»£ç 

BSTä¸­ä¿®æ”¹çš„éƒ¨åˆ†

```java
/**
 * å¯¹å¤–æš´éœ²çš„åˆ é™¤æ–¹æ³•
 */
public void remove(E element) {
    remove(node(element));
}
/**
 * æ ¹æ®ç»“ç‚¹åˆ é™¤è¯¥ç»“ç‚¹
 */
private void remove(Node<E> node) {
    if (node == null) return;
    //ä¼˜å…ˆå¤„ç†åº¦ä¸º2çš„ç»“ç‚¹
    if (node.hasTwoChildren()) {
        //æ‰¾åˆ°å…¶åç»§ç»“ç‚¹
        Node<E> successor = successor(node);
        //ç”¨åç»§ç»“ç‚¹çš„å€¼è¦†ç›–åº¦ä¸º2çš„ç»“ç‚¹çš„å€¼
        node.element = successor.element;
        //å› ä¸ºåº¦ä¸º2çš„ç»“ç‚¹çš„åç»§æˆ–è€…å‰é©±ç»“ç‚¹ä¸€å®šæ˜¯åº¦ä¸º1æˆ–0ï¼Œæ‰€ä»¥å°†åˆ é™¤ç»“ç‚¹äº¤ç»™åé¢çš„ä»£ç æ¥åš
        node = successor;
    }
    //åˆ é™¤åº¦ä¸º1æˆ–è€…åº¦ä¸º0çš„ç»“ç‚¹
    Node<E> replaceNode = node.left != null ? node.left : node.right;
    /*
     * è¿™é‡Œæœ‰ä¸‰ç§æƒ…å†µï¼Œéœ€è¦åˆ†ç±»è®¨è®º
     *  1. nodeæ˜¯åº¦ä¸º1çš„ç»“ç‚¹
     *  2. nodeæ˜¯å¶å­ç»“ç‚¹å¹¶ä¸”æ˜¯æ ¹ç»“ç‚¹
     *  3. nodeæ˜¯å¶å­ç»“ç‚¹
     */
    if (replaceNode != null) {
        //å…ˆä¿®æ”¹node.parentçš„æŒ‡å‘
        replaceNode.parent = node.parent;
        //ä¿®æ”¹parentçš„leftã€rightæŒ‡å‘
        if (node.parent == null) { //nodeæ˜¯åº¦ä¸º1çš„ç»“ç‚¹ä¸”æ˜¯æ ¹ç»“ç‚¹
            root = replaceNode;
        } else if (node == node.parent.left) {
            node.parent.left = replaceNode;
        } else {
            node.parent.right = replaceNode;
        }
        //åˆ é™¤ç»“ç‚¹ä¹‹åçš„å¤„ç†
        afterRemove(replaceNode);
    } else if (node.parent == null) {
        //nodeæ˜¯å¶å­ç»“ç‚¹å¹¶ä¸”æ˜¯æ ¹ç»“ç‚¹,ç›´æ¥è®©è¯¥ç»“ç‚¹ä¸ºnull
        root = null;
        //åˆ é™¤ç»“ç‚¹ä¹‹åçš„å¤„ç†ï¼Œè¿™é‡Œä¸éœ€è¦æ›¿ä»£
        afterRemove(node);
    } else {
        //å¶å­ç»“ç‚¹
        //çˆ¶ç»“ç‚¹çš„å·¦å­æ ‘
        if (node == node.parent.left) {
            node.parent.left = null;
        } else {
            //çˆ¶ç»“ç‚¹å³å­æ ‘
            node.parent.right = null;
        }
        //åˆ é™¤ç»“ç‚¹ä¹‹åçš„å¤„ç†ï¼Œè¿™é‡Œä¹Ÿä¸éœ€è¦æ›¿ä»£
        afterRemove(node);
    }
    size--;
}
```

çº¢é»‘æ ‘ä»£ç 

```java
package com.fx.RBTree;

import java.util.Comparator;

public class RBTree<E> extends BBST<E> {
	private static final boolean RED = false;
	private static final boolean BLACK = true;
	
	public RBTree() {
		this(null);
	}
	
	public RBTree(Comparator<E> comparator) {
		super(comparator);
	}
	
	@Override
	protected void afterAdd(Node<E> node) {
		Node<E> parent = node.parent;
		
		// æ·»åŠ çš„æ˜¯æ ¹èŠ‚ç‚¹ æˆ–è€… ä¸Šæº¢åˆ°è¾¾äº†æ ¹èŠ‚ç‚¹
		if (parent == null) {
			black(node);
			return;
		}
		
		// å¦‚æœçˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œç›´æ¥è¿”å›
		if (isBlack(parent)) return;
		
		// å”çˆ¶èŠ‚ç‚¹
		Node<E> uncle = parent.sibling();
		// ç¥–çˆ¶èŠ‚ç‚¹
		Node<E> grand = red(parent.parent);
		if (isRed(uncle)) { // å”çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ã€Bæ ‘èŠ‚ç‚¹ä¸Šæº¢ã€‘
			black(parent);
			black(uncle);
			// æŠŠç¥–çˆ¶èŠ‚ç‚¹å½“åšæ˜¯æ–°æ·»åŠ çš„èŠ‚ç‚¹
			afterAdd(grand);
			return;
		}
		
		// å”çˆ¶èŠ‚ç‚¹ä¸æ˜¯çº¢è‰²
		if (parent.isLeftChild()) { // L
			if (node.isLeftChild()) { // LL
				black(parent);
			} else { // LR
				black(node);
				rotateLeft(parent);
			}
			rotateRight(grand);
		} else { // R
			if (node.isLeftChild()) { // RL
				black(node);
				rotateRight(parent);
			} else { // RR
				black(parent);
			}
			rotateLeft(grand);
		}
	}
	
	@Override
	protected void afterRemove(Node<E> node) {
		// å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯çº¢è‰²
		// æˆ–è€… ç”¨ä»¥å–ä»£åˆ é™¤èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯çº¢è‰²
		if (isRed(node)) {
			black(node);
			return;
		}
		
		Node<E> parent = node.parent;
		// åˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹
		if (parent == null) return;
		
		// åˆ é™¤çš„æ˜¯é»‘è‰²å¶å­èŠ‚ç‚¹ã€ä¸‹æº¢ã€‘
		// åˆ¤æ–­è¢«åˆ é™¤çš„nodeæ˜¯å·¦è¿˜æ˜¯å³
		boolean left = parent.left == null || node.isLeftChild();
		Node<E> sibling = left ? parent.right : parent.left;
		if (left) { // è¢«åˆ é™¤çš„èŠ‚ç‚¹åœ¨å·¦è¾¹ï¼Œå…„å¼ŸèŠ‚ç‚¹åœ¨å³è¾¹
			if (isRed(sibling)) { // å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²
				black(sibling);
				red(parent);
				rotateLeft(parent);
				// æ›´æ¢å…„å¼Ÿ
				sibling = parent.right;
			}
			
			// å…„å¼ŸèŠ‚ç‚¹å¿…ç„¶æ˜¯é»‘è‰²
			if (isBlack(sibling.left) && isBlack(sibling.right)) {
				// å…„å¼ŸèŠ‚ç‚¹æ²¡æœ‰1ä¸ªçº¢è‰²å­èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹è¦å‘ä¸‹è·Ÿå…„å¼ŸèŠ‚ç‚¹åˆå¹¶
				boolean parentBlack = isBlack(parent);
				black(parent);
				red(sibling);
				if (parentBlack) {
					afterRemove(parent);
				}
			} else { // å…„å¼ŸèŠ‚ç‚¹è‡³å°‘æœ‰1ä¸ªçº¢è‰²å­èŠ‚ç‚¹ï¼Œå‘å…„å¼ŸèŠ‚ç‚¹å€Ÿå…ƒç´ 
				// å…„å¼ŸèŠ‚ç‚¹çš„å·¦è¾¹æ˜¯é»‘è‰²ï¼Œå…„å¼Ÿè¦å…ˆæ—‹è½¬
				if (isBlack(sibling.right)) {
					rotateRight(sibling);
					sibling = parent.right;
				}
				
				color(sibling, colorOf(parent));
				black(sibling.right);
				black(parent);
				rotateLeft(parent);
			}
		} else { // è¢«åˆ é™¤çš„èŠ‚ç‚¹åœ¨å³è¾¹ï¼Œå…„å¼ŸèŠ‚ç‚¹åœ¨å·¦è¾¹
			if (isRed(sibling)) { // å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²
				black(sibling);
				red(parent);
				rotateRight(parent);
				// æ›´æ¢å…„å¼Ÿ
				sibling = parent.left;
			}
			
			// å…„å¼ŸèŠ‚ç‚¹å¿…ç„¶æ˜¯é»‘è‰²
			if (isBlack(sibling.left) && isBlack(sibling.right)) {
				// å…„å¼ŸèŠ‚ç‚¹æ²¡æœ‰1ä¸ªçº¢è‰²å­èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹è¦å‘ä¸‹è·Ÿå…„å¼ŸèŠ‚ç‚¹åˆå¹¶
				boolean parentBlack = isBlack(parent);
				black(parent);
				red(sibling);
				if (parentBlack) {
					afterRemove(parent);
				}
			} else { // å…„å¼ŸèŠ‚ç‚¹è‡³å°‘æœ‰1ä¸ªçº¢è‰²å­èŠ‚ç‚¹ï¼Œå‘å…„å¼ŸèŠ‚ç‚¹å€Ÿå…ƒç´ 
				// å…„å¼ŸèŠ‚ç‚¹çš„å·¦è¾¹æ˜¯é»‘è‰²ï¼Œå…„å¼Ÿè¦å…ˆæ—‹è½¬
				if (isBlack(sibling.left)) {
					rotateLeft(sibling);
					sibling = parent.left;
				}
				
				color(sibling, colorOf(parent));
				black(sibling.left);
				black(parent);
				rotateRight(parent);
			}
		}
	}

	private Node<E> color(Node<E> node, boolean color) {
		if (node == null) return node;
		((RBNode<E>)node).color = color;
		return node;
	}
	
	private Node<E> red(Node<E> node) {
		return color(node, RED);
	}
	
	private Node<E> black(Node<E> node) {
		return color(node, BLACK);
	}
	
	private boolean colorOf(Node<E> node) {
		return node == null ? BLACK : ((RBNode<E>)node).color;
	}
	
	private boolean isBlack(Node<E> node) {
		return colorOf(node) == BLACK;
	}
	
	private boolean isRed(Node<E> node) {
		return colorOf(node) == RED;
	}
	
	@Override
	protected Node<E> createNode(E element, Node<E> parent) {
		return new RBNode<>(element, parent);
	}

	private static class RBNode<E> extends Node<E> {
		boolean color = RED;
		public RBNode(E element, Node<E> parent) {
			super(element, parent);
		}
		
		@Override
		public String toString() {
			String str = "";
			if (color == RED) {
				str = "R_";
			}
			return str + element.toString();
		}
	}
}

```

æµ‹è¯•ï¼š

```java
@Test
public void test01(){
    Integer[] data = {
            55, 42, 96, 62, 24, 29, 18, 2, 89, 40, 23, 3
    };
    RedBlackTree<Integer> rb = new RedBlackTree<>();
    for(int i : data){
        rb.add(i);
    }
    BinaryTrees.println(rb);
    // åˆ é™¤ç»“ç‚¹
    for (Integer datum : data) {
        rb.remove(datum);
        System.out.println("åˆ é™¤å…ƒç´ ï¼šã€" + datum + "ã€‘");
        BinaryTrees.println(rb);
        System.out.println("---------------------------------");
    }
}
```

ç»“æœï¼š

```java
     â”Œâ”€â”€â”€â”€â”€29â”€â”€â”€â”€â”€â”
     â”‚            â”‚
â”Œâ”€â”€R_18â”€â”€â”     â”Œâ”€R_55â”€â”
â”‚        â”‚     â”‚      â”‚
2â”€â”    â”Œâ”€24 â”Œâ”€42    â”Œâ”€89â”€â”
  â”‚    â”‚    â”‚       â”‚    â”‚
 R_3 R_23 R_40    R_62  R_96
åˆ é™¤å…ƒç´ ï¼šã€55ã€‘
     â”Œâ”€â”€â”€â”€â”€29â”€â”€â”€â”€â”€â”
     â”‚            â”‚
â”Œâ”€â”€R_18â”€â”€â”     â”Œâ”€R_62â”€â”
â”‚        â”‚     â”‚      â”‚
2â”€â”    â”Œâ”€24 â”Œâ”€42      89â”€â”
  â”‚    â”‚    â”‚            â”‚
 R_3 R_23 R_40          R_96
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€42ã€‘
     â”Œâ”€â”€â”€â”€29â”€â”€â”€â”€â”
     â”‚          â”‚
â”Œâ”€â”€R_18â”€â”€â”   â”Œâ”€R_62â”€â”
â”‚        â”‚   â”‚      â”‚
2â”€â”    â”Œâ”€24 40      89â”€â”
  â”‚    â”‚               â”‚
 R_3 R_23             R_96
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€96ã€‘
     â”Œâ”€â”€â”€â”€29â”€â”€â”€â”€â”
     â”‚          â”‚
â”Œâ”€â”€R_18â”€â”€â”   â”Œâ”€R_62â”€â”
â”‚        â”‚   â”‚      â”‚
2â”€â”    â”Œâ”€24 40      89
  â”‚    â”‚
 R_3 R_23
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€62ã€‘
     â”Œâ”€â”€â”€â”€29â”€â”€â”€â”€â”
     â”‚          â”‚
â”Œâ”€â”€R_18â”€â”€â”    â”Œâ”€89
â”‚        â”‚    â”‚
2â”€â”    â”Œâ”€24 R_40
  â”‚    â”‚
 R_3 R_23
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€24ã€‘
    â”Œâ”€â”€â”€â”€29â”€â”€â”€â”
    â”‚         â”‚
â”Œâ”€R_18â”€â”    â”Œâ”€89
â”‚      â”‚    â”‚
2â”€â”    23 R_40
  â”‚
 R_3
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€29ã€‘
    â”Œâ”€40â”€â”
    â”‚    â”‚
â”Œâ”€R_18â”€â” 89
â”‚      â”‚
2â”€â”    23
  â”‚
 R_3
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€18ã€‘
   â”Œâ”€40â”€â”
   â”‚    â”‚
â”Œâ”€R_3â”€â” 89
â”‚     â”‚
2     23
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€2ã€‘
â”Œâ”€40â”€â”
â”‚    â”‚
3â”€â”  89
  â”‚
 R_23
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€89ã€‘
â”Œâ”€23â”€â”
â”‚    â”‚
3    40
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€40ã€‘
 â”Œâ”€23
 â”‚
R_3
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€23ã€‘
3
---------------------------------
åˆ é™¤å…ƒç´ ï¼šã€3ã€‘
---------------------------------

Process finished with exit code 0

```



## 6. çº¢é»‘æ ‘å¹³è¡¡çš„å¥¥ç§˜

æˆ‘ä»¬åœ¨å­¦ä¹ AVLæ ‘çš„æ—¶å€™ï¼Œæœ‰æ˜ç¡®çš„å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œæˆ‘ä»¬åœ¨æ·»åŠ åˆ é™¤çš„æ—¶å€™éƒ½è¦è®¡ç®—å¹³è¡¡å› å­ï¼Œé˜²æ­¢ç»“ç‚¹å¤±è¡¡

ä½†æ˜¯æˆ‘ä»¬åœ¨çº¢é»‘æ ‘ä¸­ï¼Œå¥½åƒå¹¶æ²¡æœ‰å»åˆ»æ„çš„ç»´æŠ¤å¹³è¡¡ï¼Œä¹Ÿæ²¡æœ‰å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œè€Œæ˜¯ä¸€ç›´åœ¨**ç»´æŠ¤é‚£äº”æ¡æ€§è´¨**ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆç»´æŠ¤äº†è¿™äº”æ¡æ€§è´¨å°±èƒ½ç»´æŠ¤æ€§è´¨å‘¢ï¼Ÿ

**é‚£5æ¡æ€§è´¨ï¼Œå¯ä»¥ä¿è¯ çº¢é»‘æ ‘ ç­‰ä»·äº 4é˜¶Bæ ‘**

ä»€ä¹ˆæ˜¯å¹³è¡¡ï¼Ÿå³æ ‘çš„é«˜åº¦è¶ŠçŸ®è¶Šå¹³è¡¡

- ç›¸æ¯”AVLæ ‘ï¼Œçº¢é»‘æ ‘çš„å¹³è¡¡æ ‡å‡†æ¯”è¾ƒå®½æ¾ï¼š**æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šå¤§äºå…¶ä»–è·¯å¾„çš„2å€**
- æ˜¯ä¸€ç§å¼±å¹³è¡¡ã€é»‘é«˜åº¦å¹³è¡¡ï¼ˆåªç®—é»‘ç»“ç‚¹çš„é«˜åº¦éƒ½ä¸€æ ·ï¼‰
- çº¢é»‘æ ‘çš„æœ€å¤§é«˜åº¦æ˜¯ 2 âˆ— log2(n + 1) ï¼Œä¾ç„¶æ˜¯ O(logn) çº§åˆ«

## 7. çº¢é»‘æ ‘ä¸AVLæ ‘æ€§èƒ½å¯¹æ¯”

### 7.1 å¹³å‡æ—¶é—´å¤æ‚åº¦

â—¼ æœç´¢ï¼šO(logn) 

â—¼ æ·»åŠ ï¼šO(logn)ï¼ŒO(1) æ¬¡çš„æ—‹è½¬æ“ä½œ 

â—¼ åˆ é™¤ï¼šO(logn)ï¼ŒO(1) æ¬¡çš„æ—‹è½¬æ“ä½œ

æ˜¾ç„¶æ·»åŠ åˆ é™¤æƒ…å†µæ¯”AVLæ ‘æ›´å¥½ï¼ŒAVLæ ‘éƒ½æ˜¯O(logn)çº§åˆ«çš„

### 7.2 AVLæ ‘ 

- å¹³è¡¡æ ‡å‡†æ¯”è¾ƒä¸¥æ ¼ï¼šæ¯ä¸ªå·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1 
- æœ€å¤§é«˜åº¦æ˜¯ 1.44 âˆ— log2 n + 2 âˆ’ 1.328ï¼ˆ100Wä¸ªèŠ‚ç‚¹ï¼ŒAVLæ ‘æœ€å¤§æ ‘é«˜28ï¼‰ 
- æœç´¢ã€æ·»åŠ ã€åˆ é™¤éƒ½æ˜¯ O(logn) å¤æ‚åº¦ï¼Œå…¶ä¸­æ·»åŠ ä»…éœ€ O(1) æ¬¡æ—‹è½¬è°ƒæ•´ã€åˆ é™¤æœ€å¤šéœ€è¦ O(logn) æ¬¡æ—‹è½¬è°ƒæ•´

### 7.3 çº¢é»‘æ ‘

- å¹³è¡¡æ ‡å‡†æ¯”è¾ƒå®½æ¾ï¼šæ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šå¤§äºå…¶ä»–è·¯å¾„çš„2å€ 
- æœ€å¤§é«˜åº¦æ˜¯ 2 âˆ— log2(n + 1)ï¼ˆ 100Wä¸ªèŠ‚ç‚¹ï¼Œçº¢é»‘æ ‘æœ€å¤§æ ‘é«˜40ï¼‰ 
- æœç´¢ã€æ·»åŠ ã€åˆ é™¤éƒ½æ˜¯ O(logn) å¤æ‚åº¦ï¼Œå…¶ä¸­æ·»åŠ ã€åˆ é™¤éƒ½ä»…éœ€ O(1) æ¬¡æ—‹è½¬è°ƒæ•´

### 7.4 å°ç»“

- æœç´¢çš„æ¬¡æ•°è¿œè¿œå¤§äºæ’å…¥å’Œåˆ é™¤ï¼Œé€‰æ‹©AVLæ ‘ï¼›æœç´¢ã€æ’å…¥ã€åˆ é™¤æ¬¡æ•°å‡ ä¹å·®ä¸å¤šï¼Œé€‰æ‹©çº¢é»‘æ ‘ 
- **ç›¸å¯¹äºAVLæ ‘æ¥è¯´ï¼Œçº¢é»‘æ ‘ç‰ºç‰²äº†éƒ¨åˆ†å¹³è¡¡æ€§ä»¥æ¢å–æ’å…¥/åˆ é™¤æ“ä½œæ—¶å°‘é‡çš„æ—‹è½¬æ“ä½œï¼Œæ•´ä½“æ¥è¯´æ€§èƒ½è¦ä¼˜äºAVLæ ‘** 
- **çº¢é»‘æ ‘çš„å¹³å‡ç»Ÿè®¡æ€§èƒ½ä¼˜äºAVLæ ‘ï¼Œå®é™…åº”ç”¨ä¸­æ›´å¤šé€‰æ‹©ä½¿ç”¨çº¢é»‘æ ‘**

## 8. BST VS AVL VS RedBlack Tree

![image-20220712130218713](https://cdn.fengxianhub.top/resources-master/202207121303985.png)







