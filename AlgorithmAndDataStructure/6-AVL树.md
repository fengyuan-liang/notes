# AVLæ ‘

æ€ç»´å¯¼å›¾ï¼š

![image-20220408170620773](https://cdn.fengxianhub.top/resources-master/202204081706974.png)

## 1. äºŒå‰æœç´¢æ ‘å¤æ‚åº¦

>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹BSTçš„å¤æ‚åº¦ï¼š
>
>å¦‚ä¸‹å›¾å·¦è¾¹éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“BSTçš„`æ·»åŠ `ã€`åˆ é™¤`å’Œ`æœç´¢`æ•ˆç‡éƒ½éå¸¸çš„é«˜ï¼Œå…¶å¤æ‚åº¦ä¸å…ƒç´ çš„ä¸ªæ•°æ²¡æœ‰å…³ç³»ï¼Œåªä¸æ ‘çš„é«˜åº¦æœ‰å…³ç³»ï¼Œå³å¤æ‚åº¦ä¸ºï¼šO(h) ï¼Œhä¸ºæ ‘çš„é«˜åº¦ï¼Œå½“BSTä¸ºæ»¡äºŒå‰æ ‘æ—¶ï¼Œå…¶å¤æ‚åº¦ä¸ºO(logn)ï¼Œnä¸ºå…ƒç´ ä¸ªæ•°ï¼Œæ­¤æ—¶ï¼š`O(h)  == O(logn)`

![image-20220328134437941](https://cdn.fengxianhub.top/resources-master/202203281344175.png)

>ä½†æ˜¯å¦‚æœæ˜¯æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ·»åŠ ç»“ç‚¹ï¼Œå¦‚ä¸Šå›¾å³è¾¹æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„BSTä¸é“¾è¡¨æ˜¯ä¸€æ ·çš„ï¼Œå…¶å¤æ‚åº¦`O(h)  == O(n)`
>
>æˆ‘ä»¬ç§°è¿™æ ·çš„BSTé€€åŒ–æˆäº†é“¾è¡¨
>
>ğŸš©ä»¥ä¸Šä¸¤ç§BSTçš„çš„`æ•ˆç‡æœ‰å·¨å¤§çš„å·®è·`ï¼Œå½“n = 1000000ï¼ˆä¸€ç™¾ä¸‡ï¼‰æ—¶ï¼Œå·¦è¾¹çš„BSTæœ€åæƒ…å†µä¸‹åªéœ€è¦è¿›è¡Œ`20æ¬¡æŸ¥æ‰¾`ï¼Œå³è¾¹çš„BSTæœ€åæƒ…å†µä¸‹éœ€è¦è¿›è¡Œ`ä¸€ç™¾ä¸‡æ¬¡æŸ¥æ‰¾`

é™¤äº†æ·»åŠ å…ƒç´ å¯èƒ½ä¼šè®©BSTé€€åŒ–æˆé“¾è¡¨ä¹‹å¤–ï¼Œåˆ é™¤ä¹Ÿæœ‰å¯èƒ½ä¼šè®©BSTé€€åŒ–æˆé“¾è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æ ‘çš„é«˜åº¦è¶³å¤Ÿå¤§æ—¶ï¼Œä¹Ÿé¢ä¸´ç€ä¸Šé¢çš„é—®é¢˜ã€‚

![image-20220328193628291](https://cdn.fengxianhub.top/resources-master/202203281936472.png)

## 2. BSTçš„å¹³è¡¡

>æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿè§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢ï¼Ÿå½“æˆ‘ä»¬çš„äºŒå‰æ ‘æ›´åŠ `å¹³è¡¡`æ—¶ï¼Œå°±å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæ‰€è°“çš„`å¹³è¡¡`å°±æ˜¯å½“èŠ‚ç‚¹æ•°é‡å›ºå®šæ—¶ï¼Œå·¦å³å­æ ‘çš„é«˜åº¦è¶Šæ¥è¿‘ï¼Œè¿™æ£µäºŒå‰æ ‘å°±è¶Šå¹³è¡¡ï¼ˆé«˜åº¦è¶Šä½ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![image-20220328200730904](https://cdn.fengxianhub.top/resources-master/202203282007037.png)

>æœ€ç†æƒ³çš„å¹³è¡¡ï¼Œå°±æ˜¯åƒå®Œå…¨äºŒå‰æ ‘ã€æ»¡äºŒå‰æ ‘é‚£æ ·ï¼Œé«˜åº¦æ˜¯æœ€å°çš„

![image-20220328201046761](https://cdn.fengxianhub.top/resources-master/202203282010863.png)

## 3. æ”¹è¿›äºŒå‰æœç´¢æ ‘

é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼š

- é¦–å…ˆï¼ŒèŠ‚ç‚¹çš„æ·»åŠ ã€åˆ é™¤é¡ºåºæ˜¯æ— æ³•é™åˆ¶çš„ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„
- æ‰€ä»¥ï¼Œæ”¹è¿›æ–¹æ¡ˆæ˜¯ï¼šåœ¨èŠ‚ç‚¹çš„æ·»åŠ ã€åˆ é™¤æ“ä½œä¹‹åï¼Œæƒ³åŠæ³•è®©äºŒå‰æœç´¢æ ‘æ¢å¤å¹³è¡¡ï¼ˆå‡å°æ ‘çš„é«˜åº¦ï¼‰

ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬å°†ä¸‹å›¾ä¸­å·¦è¾¹çš„BSTè°ƒæ•´ä¸ºå³è¾¹çš„BSTï¼š

![image-20220328201643226](https://cdn.fengxianhub.top/resources-master/202203282016356.png)

å¯ä»¥çœ‹åˆ°è¿™æ ·çš„è°ƒæ•´è®©BSTçš„é«˜åº¦å‡å°‘äº†1ï¼Œå¹¶ä¸”æ²¡æœ‰æ”¹å˜BSTçš„æ€§è´¨ï¼Œè¿™å°±æ˜¯ä¸€ç§`æœ‰æ•ˆè°ƒæ•´`

é‚£å³è¾¹çš„BSTå¯ä»¥ç»§ç»­è°ƒæ•´å—ï¼Ÿå…¶å®å¯ä»¥ç»§ç»­è°ƒæ•´çš„ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºå¦‚æœæ¥ç€ç»§ç»­è°ƒæ•´èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¼šåšè¿‡å¤šçš„è¿ç®—ï¼Œè¿™æ ·çš„è¯`ä»˜å‡ºçš„ä»£ä»·å¯èƒ½ä¼šæ¯”è¾ƒå¤§`

æ‰€ä»¥æˆ‘ä»¬çš„åšæ³•æ˜¯ï¼š`ç”¨å°½é‡å°‘çš„è°ƒæ•´æ¬¡æ•°è¾¾åˆ°é€‚åº¦å¹³è¡¡å³å¯`

**ä¸€æ£µè¾¾åˆ°é€‚åº¦å¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºï¼šå¹³è¡¡äºŒå‰æœç´¢æ ‘**

## 4. å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆBalanced Binary Search Treeï¼‰

æˆ‘ä»¬å°†å¹³è¡¡äºŒå‰æœç´¢æ ‘ç®€ç§°ä¸º`BBST`

ç»å…¸çš„BBSTæœ‰ï¼š

- **AVLæ ‘**ï¼ˆWindows NT å†…æ ¸ä¸­å¹¿æ³›ä½¿ç”¨ï¼‰
- **çº¢é»‘æ ‘**ï¼ˆçº¢é»‘æ ‘çš„åº”ç”¨ååˆ†å¹¿æ³›ï¼Œä¾‹å¦‚C++ STLåº“ä¸­çš„`map`ã€`set`ï¼›Java çš„ `TreeMap`ã€`TreeSet`ã€`HashMap`ã€`HashSet`ï¼›Linux çš„è¿›ç¨‹è°ƒåº¦ï¼›Nginx çš„ timer ç®¡ç†ï¼‰

ä¸€èˆ¬ä¹Ÿç§°å®ƒä»¬ä¸ºï¼šè‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼ˆSelf-balancing Binary Search Treeï¼‰

## 5. AVLæ ‘

é¦–å…ˆï¼ŒAVLæ ‘æ˜¯æœ€æ—©å‘æ˜çš„è‡ªå¹³è¡¡äºŒå‰æœç´¢æ ‘ä¹‹ä¸€ï¼ŒAVL å–åäºä¸¤ä½å‘æ˜è€…çš„åå­—ï¼ŒG. M. `A`delson-`V`elsky å’Œ E. M. `L`andisï¼ˆæ¥è‡ªè‹è”çš„ç§‘å­¦å®¶ï¼‰

å› ä¸ºè¯»éŸ³é…·ä¼¼è‰¾è–‡å„¿ï¼Œæ‰€ä»¥æœ‰äººæŠŠAVLæ ‘å¿µåšâ€œè‰¾è–‡å„¿æ ‘â€

### 5.1 AVLæ ‘çš„ç›¸å…³æ¦‚å¿µåŠç‰¹ç‚¹

**å¹³è¡¡å› å­**ï¼ˆBalance Factorï¼‰ï¼šæŸç»“ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®ï¼Œå³å·¦å­æ ‘é«˜åº¦å‡å»å³å­æ ‘é«˜åº¦

ä¾‹å¦‚ï¼šä¸‹å›¾ä¸­7è¿™ä¸ªç»“ç‚¹å·¦å­æ ‘é«˜åº¦ä¸º2ï¼Œå³å­æ ‘é«˜åº¦ä¸º4ï¼Œæ‰€ä»¥å…¶å¹³è¡¡å› å­ä¸º 2 - 4 = -2

![image-20220328203941373](https://cdn.fengxianhub.top/resources-master/202203282039483.png)

**AVLæ ‘çš„ç‰¹ç‚¹ï¼š**

- æ¯ä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­åªå¯èƒ½æ˜¯ 1ã€0ã€-1ï¼ˆç»å¯¹å€¼ â‰¤ 1ï¼Œå¦‚æœè¶…è¿‡ 1ï¼Œç§°ä¹‹ä¸ºâ€œå¤±è¡¡â€ï¼‰
- æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡ 1
- å› ä¸ºæ¯ä¸ªç»“ç‚¹çš„é«˜åº¦å·®ä¸è¶…è¿‡1ï¼Œæ‰€ä»¥AVLæ ‘æœç´¢ã€æ·»åŠ ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)

æˆ‘ä»¬çœ‹ä¸€æ£µAVLæ ‘ï¼ˆæ¯ä¸ªç»“ç‚¹ä¸Šéƒ½æ ‡è®°äº†å¹³è¡¡å› å­ï¼‰ï¼š

![image-20220328204416187](https://cdn.fengxianhub.top/resources-master/202203282044295.png)

### 5.2 æ™®é€šBSTå’ŒAVLæ ‘æ·»åŠ å¯¹æ¯”

æˆ‘ä»¬å¾€ä¸€æ£µæ™®é€šçš„BSTå’Œä¸€æ£µAVLæ ‘ä¸­æ·»åŠ åŒä¸€ç»„ç»“ç‚¹ï¼š35, 37, 34, 56, 25, 62, 57, 9, 74, 32, 94, 80, 75, 100, 16, 82

æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ™®é€šBSTçš„AVLçš„ç»“æ„åŒºåˆ«å¦‚ä¸‹ï¼š

![image-20220328204650378](https://cdn.fengxianhub.top/resources-master/202203282046557.png)

## 6. AVLæ ‘è®¾è®¡

### 6.1 ç»§æ‰¿ç»“æ„

é¦–å…ˆæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç®€å•çš„ç»§æ‰¿ç»“æ„ï¼š

å…¶ä¸­RBTreeæŒ‡çš„æ˜¯çº¢é»‘æ ‘

<img src="https://cdn.fengxianhub.top/resources-master/202203282108764.png" style="zoom:50%"/>

### 6.2 æ™®é€šBSTæ·»åŠ å¯¼è‡´å¤±è¡¡ä¾‹å­

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªBSTå› ä¸ºæ·»åŠ ç»“ç‚¹è€Œå¯¼è‡´å¤±è¡¡çš„ä¾‹å­

æˆ‘ä»¬å¾€ä¸‹é¢çš„BSTä¸­æ·»åŠ 13è¿™ä¸ªå…ƒç´ ï¼ˆæ³¨æ„ä¸‹é¢çš„BSTå¹¶ä¸å®Œæ•´ï¼Œåªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼‰

![image-20220328212403202](https://cdn.fengxianhub.top/resources-master/202203282124285.png)

å¯ä»¥çœ‹åˆ°åœ¨æ·»åŠ 13è¿™ä¸ªå…ƒç´ å‰ï¼Œå›¾ç‰‡é‡Œçš„æ ‘æ˜¯å¹³è¡¡çš„ï¼Œå› ä¸ºä»»æ„ç»“ç‚¹çš„å¹³è¡¡å› å­éƒ½å°äº1ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ·»åŠ 13è¿™ä¸ªç»“ç‚¹åï¼Œè¿™æ£µæ ‘å°±ä¼šå˜æˆä»¥ä¸‹è¿™æ ·ï¼š

![image-20220328212218085](https://cdn.fengxianhub.top/resources-master/202203282122271.png)

å¯ä»¥çœ‹åˆ°å½“æ·»åŠ äº†å…ƒç´ ä¹‹åï¼Œæœ‰ä¸‰ä¸ªç»“ç‚¹å¤„äºä¸å¹³è¡¡çš„çŠ¶æ€äº†ï¼Œå¹¶ä¸”å¯¹äºæ•´æ£µäºŒå‰æ ‘æœ‰ï¼š

- æœ€åæƒ…å†µï¼šå¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹éƒ½å¤±è¡¡
- çˆ¶èŠ‚ç‚¹ã€éç¥–å…ˆèŠ‚ç‚¹ï¼Œéƒ½ä¸å¯èƒ½å¤±è¡¡

### 6.3 è§£å†³æ·»åŠ å¤±è¡¡â€”â€”LL-å³æ—‹è½¬(å•æ—‹)

æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š

åœ¨å›¾ä¸­å±•ç¤ºçš„äºŒå‰æ ‘é‡Œnè¡¨ç¤ºnodeï¼Œpè¡¨ç¤ºparentã€gè¡¨ç¤ºgrandparentã€‚è¿™æ£µæœ¬æ¥æ˜¯å¹³è¡¡çš„ï¼ˆçœ‹ä¸‹é¢çš„è¾…åŠ©çº¿ï¼‰ï¼Œä½†æ˜¯å› ä¸º`n`ç»“ç‚¹æ·»åŠ äº†ä¸€ä¸ªå…ƒç´ ï¼Œç°åœ¨å¯¼è‡´`g`ç»“ç‚¹ç°åœ¨ä¸å¹³è¡¡äº†

å› ä¸º`g`ç»“ç‚¹ä¸å¹³è¡¡ï¼Œä¸”æ˜¯å› ä¸º`g`ç»“ç‚¹çš„å·¦å­æ ‘çš„å·¦å­æ ‘ï¼ˆLLï¼‰è®©å…¶ä¸å¹³è¡¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°æ—‹è½¬çš„æ–¹å¼ä¸ºï¼š`LL-å³æ—‹è½¬`

![image-20220328224015655](https://cdn.fengxianhub.top/resources-master/202203282144450.png)

æˆ‘ä»¬ä¸ºäº†è®©`g`ç»“ç‚¹å¹³è¡¡ï¼Œå¯ä»¥é‡‡å–å¦‚ä¸‹æªæ–½ï¼š

```java
g.left = p.right
p.right = g
è®©pæˆä¸ºè¿™æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹
```

ç»“æœå¦‚ä¸‹ï¼ˆå³è¾¹çš„æ ‘æ˜¯æ•´ç†åçš„ï¼‰ï¼š

![image-20220328224015655](https://cdn.fengxianhub.top/resources-master/202203282240716.png)

æ ¹æ®ä¸Šé¢çš„è°ƒæ•´æˆ‘ä»¬å¾—åˆ°ï¼š

- è°ƒæ•´åçš„äºŒå‰æ ‘ä»ç„¶æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼šT0 < n < T1 < p < T2 < g < T3
- æ•´æ£µæ ‘éƒ½å·²ç»è¾¾åˆ°å¹³è¡¡

ä½†æ˜¯åœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- T2ã€pã€g çš„ parent å±æ€§éœ€è¦æ›´æ–°
- å…ˆåæ›´æ–° gã€p çš„é«˜åº¦

>æ¥ä¸€å¼ åŠ¨å›¾å±•ç¤ºä¸€ä¸‹

![](https://cdn.fengxianhub.top/resources-master/202204051755162.gif)

>è¿™äº›åŠ¨ç”»éƒ½å¯ä»¥åœ¨<a href="https://myusf.usfca.edu/~galles/visualization/Algorithms.html">å›½å¤–çš„ä¸€ä¸ªç½‘å€</a>ä¸Šï¼Œå¯ä»¥è‡ªè¡Œå°è¯•ï¼Œæˆ‘è¿™é‡Œæä¾›ä¸€ä¸ªå°†å›½å¤–ç½‘ç«™æ±‰åŒ–ç‰ˆçš„åœ°å€ï¼Œè¿™é‡Œèµ„æºæ˜¯å€Ÿé‰´äº†åˆ«äººçš„ï¼Œç„¶å<a href="https://cdn.fengxianhub.top/eureka-static/Visualization/index.html">æ”¾åœ¨è‡ªå·±çš„æœåŠ¡ä¸Šäº†</a>ï¼Œä¾µåˆ ğŸ˜–ï¼Œç‚¹è¿›å»å°±èƒ½ä½“éªŒäº†

![image-20220406223050515](https://cdn.fengxianhub.top/resources-master/202204062230789.png)

### 6.4 è§£å†³æ·»åŠ å¤±è¡¡â€”â€”RR-å·¦æ—‹è½¬(å•æ—‹)

ä¸‹é¢è¿™ç§æƒ…å†µçš„å¤±è¡¡ï¼Œç”±äºå¤±è¡¡ç»“ç‚¹`g`çš„`å³å­æ ‘çš„å³å­æ ‘`ï¼ˆRRï¼‰å¢åŠ äº†ä¸€ä¸ªç»“ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©`g`å·¦æ—‹è½¬æ¥ç»´æŒå¹³è¡¡

![image-20220329142724771](https://cdn.fengxianhub.top/resources-master/202203291427939.png)

å…·ä½“åšæ³•ä¸ºï¼š

```java
g.right = p.left
p.left = g
è®©pæˆä¸ºè¿™æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹
```

![image-20220329143140699](https://cdn.fengxianhub.top/resources-master/202203291431767.png)

åŒç†ï¼Œæ ¹æ®ä¸Šé¢çš„è°ƒæ•´æˆ‘ä»¬å¾—åˆ°ï¼š

- è°ƒæ•´åçš„äºŒå‰æ ‘ä»ç„¶æ˜¯ä¸€æ£µäºŒå‰æœç´¢æ ‘ï¼šT0 < n < T1 < p < T2 < g < T3
- æ•´æ£µæ ‘éƒ½å·²ç»è¾¾åˆ°å¹³è¡¡

ä½†æ˜¯åœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- T1ã€pã€g çš„ parent å±æ€§éœ€è¦æ›´æ–°
- å…ˆåæ›´æ–° gã€p çš„é«˜åº¦

>æ¥ä¸€å¼ åŠ¨å›¾æ¼”ç¤ºä¸€ä¸‹

![202204051759188](https://cdn.fengxianhub.top/resources-master/202204051759188.gif)

### 6.5 è§£å†³æ·»åŠ å¤±è¡¡â€”â€”LR-RRå·¦æ—‹è½¬ï¼ŒLLå³æ—‹è½¬(åŒæ—‹)

æˆ‘ä»¬çœ‹ä¸‹é¢å¤±å»å¹³è¡¡çš„ä¾‹å­ï¼Œç»“ç‚¹`g`çš„`å·¦å­æ ‘çš„å³å­æ ‘`ï¼ˆLRï¼‰å¢åŠ äº†ä¸€ä¸ªç»“ç‚¹ï¼Œä»è€Œä½¿`g`å¤±å»äº†å¹³è¡¡

![image-20220329143442889](https://cdn.fengxianhub.top/resources-master/202203291434946.png)

è¿™é‡Œæˆ‘ä»¬é‡‡å–çš„æªæ–½æ˜¯å…ˆè®©ç»“ç‚¹`P`å·¦æ—‹è½¬ï¼Œå³

```java
p.right = n.left
n.left = p
è®©næˆä¸ºçˆ¶ç»“ç‚¹
```

ç»“æœå¦‚ä¸‹ï¼š

![image-20220329144853194](https://cdn.fengxianhub.top/resources-master/202203291448256.png)

ç°åœ¨åˆå›åˆ°`g`å·¦å­æ ‘çš„å·¦å­æ ‘ï¼ˆT0ç»“ç‚¹ï¼‰ä¸å¹³è¡¡çš„æƒ…å†µäº†ï¼Œè¿™ç§æˆ‘ä»¬éœ€è¦`LL-å³æ—‹è½¬`ï¼Œè¿™é‡Œå¯¹`g`è¿›è¡Œå³æ—‹è½¬

```java
g.left = n.right
n.right = g
è®©næˆä¸ºæ ¹ç»“ç‚¹
```

å¯ä»¥çœ‹åˆ°æœ€åæˆ‘ä»¬çš„æ ‘å˜å¾—`å¹³è¡¡`äº†

![image-20220329145338273](https://cdn.fengxianhub.top/resources-master/202203291453327.png)

>æ¥ä¸€å¼ åŠ¨å›¾æ¼”ç¤ºä¸€ä¸‹

![doubleRotate](https://cdn.fengxianhub.top/resources-master/202204051821236.gif)

### 6.6 è§£å†³æ·»åŠ å¤±è¡¡â€”â€”RL-LLå³æ—‹è½¬ï¼ŒRRå·¦æ—‹è½¬(åŒæ—‹)

ç»“ç‚¹`g`çš„`å³å­æ ‘çš„å·¦å­æ ‘`ï¼ˆRLï¼‰æ·»åŠ ç»“ç‚¹åè®©`g`å¤±å»å¹³è¡¡

![image-20220329145827019](https://cdn.fengxianhub.top/resources-master/202203291458083.png)

æˆ‘ä»¬éœ€è¦å…ˆå¯¹`p`ç»“ç‚¹è¿›è¡Œ`LL-å³æ—‹è½¬`

```java
p.left = n.right
n.right = p
è®©nå˜ä¸ºæ ¹ç»“ç‚¹
```

![image-20220329150127812](https://cdn.fengxianhub.top/resources-master/202203291501875.png)

ç°åœ¨åªéœ€è¦å°†`g`è¿›è¡Œ`RRå·¦æ—‹è½¬`å³å¯è®©æ•´æ£µäºŒå‰æ ‘æ¢å¤å¹³è¡¡

```java
g.right = n.left
n.left = g
è®©næˆä¸ºæ ¹ç»“ç‚¹
```

![image-20220329150336132](https://cdn.fengxianhub.top/resources-master/202203291503182.png)

### 6.7 åˆ é™¤å…ƒç´ å¯¼è‡´å¤±è¡¡

é™¤äº†æ·»åŠ ç»“ç‚¹å¯èƒ½ä¼šå¯¼è‡´å¤±è¡¡ï¼Œåˆ é™¤ç»“ç‚¹ä¹ŸåŒæ ·ä¼šå¯¼è‡´æ ‘å¤±å»å¹³è¡¡ï¼Œä¾‹å¦‚æˆ‘ä»¬ç°åœ¨è¦åˆ é™¤ä¸‹é¢çš„ç»“ç‚¹`16`

![image-20220408143240431](https://cdn.fengxianhub.top/resources-master/202204081432532.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“ç‚¹`16`è¢«åˆ é™¤åæ•´ä¸ªäºŒå‰æ ‘ä¼šå˜æˆä¸‹å›¾ä¸­çš„æƒ…å†µï¼Œå¾ˆæ˜¾ç„¶ç»“ç‚¹`15`çš„å¹³è¡¡å› å­ä¸º2ï¼Œå¤±å»äº†å¹³è¡¡ï¼š

![image-20220408143405423](https://cdn.fengxianhub.top/resources-master/202204081434513.png)

è¿™é‡Œæœ‰ï¼š

- å¯èƒ½ä¼šå¯¼è‡´çˆ¶èŠ‚ç‚¹æˆ–ç¥–å…ˆèŠ‚ç‚¹å¤±è¡¡ï¼ˆåªæœ‰1ä¸ªèŠ‚ç‚¹ä¼šå¤±è¡¡ï¼‰

>å…¶å®çœ‹åˆ°ä¸Šé¢å¤±è¡¡çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„å‘ç°ï¼Œè¿™ç§å¤±è¡¡å¯ä»¥é€šè¿‡`LL-å³æ—‹è½¬`æ¥è§£å†³ï¼Œè¿™ç§ä¸æ˜¯å’Œæ·»åŠ ç»“ç‚¹å¤±è¡¡ä¸€æ ·å—ï¼Ÿ
>
>ä½†çœŸçš„æ˜¯ä¸€æ ·çš„å—ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹é¢å°†å¤±è¡¡ç»“ç‚¹è¿›è¡Œå³æ—‹è½¬çš„æ —å­

![image-20220408151143834](https://cdn.fengxianhub.top/resources-master/202204081511948.png)

çœ‹ä¸Šå»å¥½åƒè¾¾åˆ°å¹³è¡¡çš„æ•ˆæœï¼Œä½†æ˜¯**å¦‚æœæˆ‘ä»¬å‡è®¾ç»¿è‰²çš„ç»“ç‚¹åˆšå¼€å§‹æ˜¯ä¸å­˜åœ¨çš„**ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾çš„è¿™ç§æƒ…å†µ

![image-20220408151628296](https://cdn.fengxianhub.top/resources-master/202204081516495.png)

æˆ‘ä»¬ä¼šå‘ç°åœ¨å³è¾¹çš„æ ‘è™½ç„¶è¾¾åˆ°äº†å¹³è¡¡çš„æ•ˆæœï¼Œä½†æ˜¯æ•´ä½“çš„é«˜åº¦å‡å°‘äº†1**ï¼Œæ•´ä½“é«˜åº¦å‡å°‘äº†å°±æœ‰å¯èƒ½ä¼šå¯¼è‡´å…¶çˆ¶ç»“ç‚¹å¤±å»å¹³è¡¡**

- å¦‚æœç»¿è‰²èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæ›´é«˜å±‚çš„ç¥–å…ˆèŠ‚ç‚¹å¯èƒ½ä¹Ÿä¼šå¤±è¡¡ï¼Œéœ€è¦å†æ¬¡æ¢å¤å¹³è¡¡ï¼Œç„¶ååˆå¯èƒ½å¯¼è‡´æ›´é«˜å±‚çš„ç¥–å…ˆèŠ‚ç‚¹å¤±è¡¡
- æç«¯æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œæ¢å¤å¹³è¡¡çš„æ“ä½œï¼Œå…± O(logn) æ¬¡è°ƒæ•´

>åŒæ ·çš„ï¼Œæˆ‘ä»¬åˆ é™¤å…ƒç´ å¯¼è‡´å¤±è¡¡ä¹Ÿæœ‰LLã€RRã€LR-RRã€RL-LLå‡ ç§æƒ…å†µï¼Œå’Œæ·»åŠ ç»“ç‚¹å¯¼è‡´çš„å¤±è¡¡æ˜¯ä¸€æ ·çš„å¤„ç†æ–¹å¼

## 7. ä»£ç å®ç°AVLæ ‘æ·»åŠ æ“ä½œ

### 7.1 å¹³è¡¡å‰çš„å‡†å¤‡

ç”±äºè¿™é‡Œçš„ä»£ç å¿…é¡»è¦åŸºäºäºŒå‰æœç´¢æ ‘ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/fengxiandada/article/details/123735085">javaå®ç°ï¼ŒäºŒå‰æœç´¢æ ‘(è¿‡ç¨‹éå¸¸è¯¦ç»†)</a>ï¼Œå¯ä»¥æŠŠæ–‡ç« æœ€åçš„ä»£ç ç›´æ¥copyï¼

é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸‹æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™éœ€è¦è°ƒæ•´æˆ‘ä»¬çš„BSTï¼Œå¾ˆæ˜¾ç„¶ï¼Œ**æˆ‘ä»¬éœ€è¦åœ¨BSTæ·»åŠ å…ƒç´ åè¿›è¡Œåˆ¤æ–­**ï¼Œå¦‚æœä¸å¹³è¡¡æˆ‘ä»¬å°±éœ€è¦å°†å…¶è°ƒæ•´ä¸ºå¹³è¡¡çŠ¶æ€ã€‚

å› ä¸ºæˆ‘ä»¬è®¾è®¡äº†ç»§æ‰¿å…³ç³»æ¥å¤ç”¨ä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬çš„åšæ³•æ˜¯åœ¨`AVL`çš„çˆ¶ç±»`BinarySearchTree`çš„`add`æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´çš„æ–¹æ³•`afterAdd`ï¼Œç„¶åç”±å­ç±»`AVL`æ¥è¿›è¡Œå®ç°ï¼Œè¿™æ ·èƒ½å¤Ÿå°½å¯èƒ½å¤šçš„è¿›è¡Œä»£ç å¤ç”¨

```java
/**
 * åˆ¤æ–­æ·»åŠ ç»“ç‚¹åæ˜¯å¦éœ€è¦å¹³è¡¡äºŒå‰æ ‘
 * @param node æ–°æ·»åŠ çš„ç»“ç‚¹
 */
protected void afterAdd(Node<E> node){
}
```

`BinarySearchTree`é‡Œçš„addæ–¹æ³•

```java
...çœç•¥addæ–¹æ³•éƒ¨åˆ†ä»£ç 
    //æ·»åŠ å…ƒç´ 
    Node<E> newNode = new Node<>(element, parent);
    if (cmp > 0) {
        parent.right = newNode;
    } else {
        parent.left = newNode;
    }
    size++;
    //åˆ¤æ–­æ˜¯å¦éœ€è¦å¹³è¡¡è¿™æ£µäºŒå‰æ ‘
    afterAdd(newNode);
}
```

>ç”±ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå¤±è¡¡ç»“ç‚¹åªå¯èƒ½æ˜¯å½“å‰æ·»åŠ ç»“ç‚¹çš„çˆ¶ç»“ç‚¹æˆ–ç¥–çˆ¶ç»“ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæ‰¾`æœ€é è¿‘å½“å‰ç»“ç‚¹çš„å¤±è¡¡ç»“ç‚¹`ï¼ˆå¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªç¥–çˆ¶ç»“ç‚¹å¤±è¡¡ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æœ€è¿‘çš„é‚£ä¸€ä¸ªï¼Œè§£å†³å®ƒçš„å¤±è¡¡é—®é¢˜ï¼Œå…¶ä»–ç»“ç‚¹å°±éƒ½ä¼šå¹³è¡¡ï¼‰

é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨`Node`ç»“ç‚¹ä¸­æ·»åŠ é«˜åº¦å±æ€§`height`ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ³¨æ„ä¸è¦åœ¨`BinaryTree`ä¸­æ·»åŠ ï¼Œå› ä¸ºè¿™ä¸ªå±æ€§æ˜¯`AVL`ç‰¹æœ‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ç»§æ‰¿çš„æ–¹å¼æ·»åŠ æˆ‘ä»¬çš„å±æ€§

```java
/**
 * AVLæ ‘ç»“ç‚¹
 * @param <E>
 */
private static class AVLNode<E> extends BinaryTree.Node<E>{
    int height;//AVLæ ‘æœ‰å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œéœ€è¦æœ‰é«˜åº¦
    public AVLNode(E element, Node<E> parent) {
        super(element,parent);
    }
}
```

ä½†æ˜¯è¿™é‡Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ·»åŠ ç»“ç‚¹çš„æ—¶å€™è°ƒç”¨çš„æ˜¯çˆ¶ç±»`BinarySearchTree`çš„`add`æ–¹æ³•ï¼Œè¿™é‡Œæ·»åŠ çš„æ—¶å€™æˆ‘ä»¬æ˜¯ç›´æ¥æ·»åŠ `BinarySearchTree`é‡Œé¢çš„`Node`ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨`BinarySearchTree`ä¸­åœ¨æš´éœ²ä¸€ä¸ªæ·»åŠ ç»“ç‚¹çš„æ¥å£

```java
/**
 * åˆ›å»ºç»“ç‚¹
 * @param element ç»“ç‚¹ä¸­çš„å…ƒç´ 
 * @param parent å½“å‰ç»“ç‚¹çš„çˆ¶ç»“ç‚¹
 * @return è¿”å›åˆ›å»ºå¥½çš„ç»“ç‚¹
 */
protected Node<E> createNode(E element,Node<E> parent){
    return new Node<>(element,parent);
}
```

æˆ‘ä»¬éœ€è¦å°†`add`æ–¹æ³•ä¸­æ·»åŠ ç»“ç‚¹çš„ä»£ç æ”¹æˆè¿™ä¸ªæ–¹æ³•

ç„¶åè®©`AVLTree`å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè¿™æ ·æ·»åŠ çš„å°±æ˜¯`AVLTree`çš„ç»“ç‚¹äº†

```java
/**
 * åˆ›å»ºAVLæ ‘ç»“ç‚¹
 * @param element ç»“ç‚¹ä¸­çš„å…ƒç´ 
 * @param parent å½“å‰ç»“ç‚¹çš„çˆ¶ç»“ç‚¹
 * @return è¿”å›AVLæ ‘çš„ç»“ç‚¹
 */
@Override
protected Node<E> createNode(E element, Node<E> parent) {
    return new AVLNode<>(element,parent);
}
```

å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦åœ¨æˆ‘ä»¬çš„`AVLNode`ç»“ç‚¹ä¸­å®šä¹‰ä¸€ä¸ªè·å¾—`å¹³è¡¡å› å­`çš„æ–¹æ³•ï¼š

```java
/**
 * AVLæ ‘ç»“ç‚¹
 * @param <E>
 */
private static class AVLNode<E> extends BinaryTree.Node<E>{
    int height = 1;//AVLæ ‘æœ‰å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œéœ€è¦æœ‰é«˜åº¦ï¼Œæ ¹æ®BSTçš„æ€§è´¨æˆ‘ä»¬çŸ¥é“ä¼ å…¥çš„ç»“ç‚¹ä¸€å®šä¼šå˜æˆå¶å­ç»“ç‚¹ï¼Œé«˜åº¦ä¸º1
    public AVLNode(E element, Node<E> parent) {
        super(element,parent);
    }
    //è·å–å½“å‰ç»“ç‚¹çš„å¹³è¡¡å› å­ï¼Œå³å·¦å­æ ‘é«˜åº¦ å‡å» å³å­æ ‘é«˜åº¦
    public int balanceFactor(){
        int leftHeight = left == null ? 0 : ((AVLNode<E>)left).height;
        int rightHeight = right == null ? 0 : ((AVLNode<E>)right).height;
        return leftHeight - rightHeight;
    }
}
```

å†å†™ä¸€ä¸ªåˆ¤æ–­å¹³è¡¡çš„æ–¹æ³•ï¼š

```java
/**
 * åˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦å¹³è¡¡
 * @param node ä¼ å…¥éœ€è¦åˆ¤æ–­çš„ç»“ç‚¹
 * @return è¿”å›ç»“ç‚¹çš„å¹³è¡¡æƒ…å†µ <br> tree å¹³è¡¡ <br> false ä¸å¹³è¡¡
 */
private boolean isBalanced(Node<E> node){
    //å…ˆå°†ä¼ å…¥çš„ç»“ç‚¹è½¬ä¸ºAVLNodeï¼Œåœ¨è¿›è¡Œåˆ¤æ–­ï¼Œç»“ç‚¹çš„å¹³è¡¡å› å­çš„ç»å¯¹å€¼å°äºç­‰äº1è¡¨ç¤ºå¹³è¡¡
    return Math.abs(((AVLNode<E>)node).balanceFactor()) <= 1;
}
```

åœ¨ç»“ç‚¹ä¸­å†™æ›´æ–°è¯¥ç»“ç‚¹é«˜åº¦çš„æ–¹æ³•ï¼š

```java
/**
 * AVLæ ‘ç»“ç‚¹
 * @param <E>
 */
private static class AVLNode<E> extends BinaryTree.Node<E>{
    int height;//AVLæ ‘æœ‰å¹³è¡¡å› å­çš„æ¦‚å¿µï¼Œéœ€è¦æœ‰é«˜åº¦
    public AVLNode(E element, Node<E> parent) {
        super(element,parent);
    }
    //è·å–å½“å‰ç»“ç‚¹çš„å¹³è¡¡å› å­ï¼Œå³å·¦å­æ ‘é«˜åº¦ å‡å» å³å­æ ‘é«˜åº¦
    public int balanceFactor(){
        int leftHeight = left == null ? 0 : ((AVLNode<E>)left).height;
        int rightHeight = right == null ? 0 : ((AVLNode<E>)right).height;
        return leftHeight - rightHeight;
    }
    //æ›´æ–°å½“å‰ç»“ç‚¹çš„é«˜åº¦
    public void updateHeight(Node<E> node){
        int leftHeight = left == null ? 0 : ((AVLNode<E>)left).height;
        int rightHeight = right == null ? 0 : ((AVLNode<E>)right).height;
        this.height = 1 + Math.max(leftHeight,rightHeight);
    }
}
```

>ç°åœ¨æˆ‘ä»¬éœ€è¦å†™æˆ‘ä»¬çš„`afteradd`æ–¹æ³•äº†ï¼Œç”±ä¸Šé¢çš„ç»“è®ºæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸å¹³è¡¡çš„ç»“ç‚¹åªå¯èƒ½åœ¨å…¶ç¥–çˆ¶ç»“ç‚¹ä¸­å‡ºç°ï¼Œä¸”æˆ‘ä»¬åªéœ€è¦æ”¹å˜ç¦»è¯¥ç»“ç‚¹æœ€è¿‘çš„ä¸å¹³è¡¡çš„ç¥–çˆ¶ç»“ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ªç¯åˆ¤æ–­å…¶æ‰€æœ‰çˆ¶ç»“ç‚¹ï¼Œè¿™é‡Œæœ‰ï¼š
>
>- è¯¥ç»“ç‚¹å¹³è¡¡ï¼Œæ›´æ–°è¿™ä¸ªç»“ç‚¹çš„é«˜åº¦
>- ä¸å¹³è¡¡ï¼Œæ‰§è¡Œå¹³è¡¡é€»è¾‘
>
>è¿™é‡Œå¯èƒ½æœ‰çš„åœ°æ–¹éœ€è¦å¥½å¥½æ¨æ•²ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆåœ¨ç»“ç‚¹ä¸­å†™æ›´æ–°ç»“ç‚¹é«˜åº¦çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯ä¸ºäº†ä¸å»é€’å½’è·å¾—é«˜åº¦ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­æœ¬èº«å°±å·²ç»éå†äº†æ‰€æœ‰çš„çˆ¶ç»“ç‚¹ï¼Œè¿™ä¹ˆåšéƒ½æ˜¯ä¸ºäº†å°½å¯èƒ½çš„æå‡æ•ˆç‡ï¼Œå¯ä»¥åœ¨åé¢å®Œæ•´ä»£ç ä¸­åå¤æ¨æ•²

```java
/**
 * é‡å†™å¹³è¡¡BSTçš„é€»è¾‘
 * @param node æ–°æ·»åŠ çš„ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¯¼è‡´å¤±è¡¡çš„ç»“ç‚¹
 */
@Override
protected void afterAdd(Node<E> node) {
    //åœ¨å…¶ç¥–çˆ¶ç»“ç‚¹ä¸­å¯»åˆ°æœ€è¿‘çš„å¤±è¡¡ç»“ç‚¹
    while ((node = node.parent) != null){
        //åˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦å¹³è¡¡
        if(isBalanced(node)){
            //å¹³è¡¡ï¼Œæ›´æ–°è¯¥ç»“ç‚¹çš„é«˜åº¦
            updateHeight(node);
        }else {
            //ä¸å¹³è¡¡ï¼Œè¯¥ç»“ç‚¹ä¸ºç¦»æ·»åŠ ç»“ç‚¹æœ€è¿‘çš„ä¸å¹³è¡¡çš„ç»“ç‚¹
            reBalance(node);
            //è¯¥ç»“ç‚¹æ¢å¤å¹³è¡¡åæ•´æ£µæ ‘ä¹Ÿå°†æ¢å¤å¹³è¡¡ï¼Œç›´æ¥é€€å‡ºå¾ªç¯
            break;
        }
    }
}
```

### 7.2 æ¢å¤å¹³è¡¡

>æ¥ä¸‹æ¥å°±æ˜¯æ•´æ£µ`AVL`æ ‘çš„ç²¾åäº†â€”â€”æ¢å¤å¹³è¡¡

é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å¦‚æœç¨‹åºèƒ½å¤Ÿåˆ°è¿™é‡Œï¼Œè¯´æ˜ä¸€å®šæ‰¾åˆ°äº†ä¸å¹³è¡¡çš„çˆ¶ç»“ç‚¹ï¼Œä¾‹å¦‚ä¸‹å›¾ä¸­çš„`g`ç»“ç‚¹

![image-20220328224015655](https://cdn.fengxianhub.top/resources-master/202203282144450.png)

å…ˆæ‰¾æˆ‘ä»¬è¦æ‰¾åˆ°`p`ç»“ç‚¹å’Œ`n`ç»“ç‚¹ï¼Œå…¶ä¸­ï¼Œpç»“ç‚¹åº”è¯¥æ˜¯gç»“ç‚¹å·¦å³å­æ ‘ä¸­è¾ƒé«˜çš„ç»“ç‚¹ï¼Œå¦‚æœé«˜åº¦ç›¸åŒï¼Œåº”è¯¥è¿”å›ä¸è¯¥ç»“ç‚¹åŒä¸€ä¾§çš„ç»“ç‚¹

æˆ‘ä»¬åœ¨AVLçš„çˆ¶ç±»BSTçš„ç»“ç‚¹ä¸­å¢åŠ ä¸¤ä¸ªåˆ¤æ–­å·¦å³å­ç»“ç‚¹çš„æ–¹æ³•

```java
public boolean isLeftChild(){
    return parent != null && this == parent.left;
}
public boolean isRightChild(){
    return parent != null && this == parent.right;
}
```

å¯¹ä¸å¹³è¡¡çš„åŸå› è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥å…ˆå¾—å‡ºä¸€ä¸ªå¤§è‡´çš„æ¡†æ¶å‡ºæ¥

```java
/**
 * è®©å½“å‰AVLæ ‘æ¢å¤å¹³è¡¡
 *
 * @param grand ç¦»æ·»åŠ ç»“ç‚¹æœ€è¿‘çš„ä¸å¹³è¡¡çš„ç»“ç‚¹
 */
private void reBalance(Node<E> grand) {
    //åˆ†åˆ«è·å¾—parentç»“ç‚¹å’Œnodeç»“ç‚¹
    Node<E> parent = ((AVLNode<E>) grand).tallerChild();
    Node<E> node = ((AVLNode<E>) parent).tallerChild();
    //å¯¹ä¸å¹³è¡¡çš„åŸå› è¿›è¡Œåˆ†ç±»
    if (parent.isLeftChild()) { //L
        if (node.isLeftChild()) {  //LL
        } else {  //LR
        }
    } else {  //R
        if (node.isLeftChild()) {  //RL
        } else {  //RR
        }
    }
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯å®Œå–„é‡Œé¢çš„ä»£ç 

æˆ‘ä»¬å°†ä¹‹å‰è§£å†³å¤±è¡¡çš„ç»“è®ºå›é¡¾ä¸€ä¸‹ï¼š

- LLâ€”â€”gå³æ—‹è½¬
- RRâ€”â€”gå·¦æ—‹è½¬
- LRâ€”â€”på·¦æ—‹è½¬ï¼Œgå³æ—‹è½¬
- RLâ€”â€”På³æ—‹è½¬ï¼Œgå·¦æ—‹è½¬

æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç”¨æ¥æ—‹è½¬ç»“ç‚¹çš„æ–¹æ³•

```java
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå·¦æ—‹è½¬
 * @param node å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateLeft(Node<E> node){
}
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå³æ—‹è½¬
 * @param node å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateRight(Node<E> node){
}
```

åœ¨å°†åˆ†ç±»å¥½çš„`reBalance`æ–¹æ³•ç”¨è¿™ä¸¤ä¸ªæ—‹è½¬çš„æ–¹æ³•è¿›è¡Œå¡«å……

```java
//å…ˆåˆ¤æ–­LLå³æ—‹è½¬çš„æƒ…å†µ
if (parent.isLeftChild()) { //L
    if (node.isLeftChild()) {  //LL
        rotateRight(grand);
    } else {  //LR
        rotateLeft(parent);
        rotateRight(grand);
    }
} else {  //R
    if (node.isLeftChild()) {  //RL
        rotateRight(parent);
        rotateLeft(grand);
    } else {  //RR
        rotateLeft(grand);
    }
}
```

>æœ€åå°±æ˜¯å®Œå–„`rotateLeft`å·¦æ—‹å’Œ`rotateRight`å³æ—‹çš„ä»£ç äº†

æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¬¬å…­ç‚¹é‡Œé¢å·¦æ—‹å’Œå³æ—‹çš„æ€è·¯

![image-20220405171057108](https://cdn.fengxianhub.top/resources-master/202204051710222.png)

å·¦æ—‹ï¼š

```java
g.right = p.left
p.left = g
è®©pæˆä¸ºè¿™æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹
T1ã€pã€g çš„ parent å±æ€§éœ€è¦æ›´æ–°
å…ˆåæ›´æ–° gã€p çš„é«˜åº¦
```

å³æ—‹ï¼š

```java
g.left = p.right
p.right = g;
è®©pæˆä¸ºè¿™æ£µå­æ ‘çš„æ ¹èŠ‚ç‚¹
T2ã€pã€g çš„ parent å±æ€§éœ€è¦æ›´æ–°
å…ˆåæ›´æ–° gã€p çš„é«˜åº¦
```

æ¥ä¸‹æ¥ç”¨ä»£ç æ¥å®ç°ä¸€ä¸‹ï¼š

```java
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå·¦æ—‹è½¬
 * @param grand å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateLeft(Node<E> grand){
    //è·å¾—parentç»“ç‚¹
    Node<E> parent = grand.right;
    //å°†parentçš„å·¦å­ç»“ç‚¹å–å‡º
    Node<E> leftChild = parent.left;
    grand.right = leftChild;
    parent.left = grand;
    /*
     * è®©parentç»“ç‚¹æˆä¸ºå½“å‰å­æ ‘çš„æ ¹ç»“ç‚¹
     * è¿™é‡Œæœ‰ä¸¤æ­¥ï¼š
     *  1. è®©parentçš„çˆ¶ç»“ç‚¹æŒ‡å‘grandçš„çˆ¶ç»“ç‚¹
     *  2. è®©grandçˆ¶ç»“ç‚¹æœ¬æ¥æŒ‡å‘grandçš„æŒ‡é’ˆæŒ‡å‘parent,è¿™é‡Œé¡ºä¾¿æ›´æ–°äº†parentç»“ç‚¹çš„çˆ¶ç»“ç‚¹
     **/
    parent.parent = grand.parent;
    if(grand.isLeftChild()){
        grand.parent.left = parent;
    }else if(grand.isRightChild()){
        grand.parent.right = parent;
    }else {
        //å½“å‰ç»“ç‚¹æ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œå³grandç»“ç‚¹å°±æ˜¯rootç»“ç‚¹
        root = parent;
    }
    /*
     * ä¸€å…±éœ€è¦æ›´æ–°ä¸‰ä¸ªç»“ç‚¹çš„parentï¼Œgrandã€parentå’ŒleftChildç»“ç‚¹
     * grandç»“ç‚¹åœ¨ä¸Šé¢ç¬¬äºŒæ­¥ä¸­å·²ç»æ›´æ–°äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°parentç»“ç‚¹å’ŒleftChildç»“ç‚¹çš„parentç»“ç‚¹
     **/
    if(leftChild != null){
        leftChild.parent = grand;
    }
    //æ›´æ–°grandçš„parentç»“ç‚¹
    grand.parent = parent;
    //æ›´æ–°é«˜åº¦ï¼Œå…ˆæ¯”è¾ƒçŸ®çš„ç»“ç‚¹å†æ›´æ–°è¾ƒé«˜çš„ç»“ç‚¹
    updateHeight(grand);
    updateHeight(parent);
}
```

```java
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå³æ—‹è½¬
 * @param grand å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateRight(Node<E> grand){
    //è·å¾—parentç»“ç‚¹,å³grandç»“ç‚¹çš„å·¦ç»“ç‚¹
    Node<E> parent = grand.left;
    //è·å¾—parentç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œæ–¹ä¾¿åé¢æ›´æ–°é«˜åº¦
    Node<E> rightChild = parent.right;
    //å³æ—‹
    grand.left = parent.right;
    parent.right = grand;
    //è®©parentç»“ç‚¹æˆä¸ºå½“å‰æ ‘çš„æ ¹ç»“ç‚¹
    parent.parent = grand.parent;
    if(grand.isLeftChild()){
        grand.parent.left = parent;
    }else if(grand.isRightChild()){
        grand.parent.right = parent;
    }else {
        //å½“å‰ç»“ç‚¹æ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œå³grandç»“ç‚¹å°±æ˜¯rootç»“ç‚¹
        root = parent;
    }
    //æ›´æ–°parentç»“ç‚¹å’Œgrandç»“ç‚¹çš„çˆ¶ç»“ç‚¹å’Œgrandç»“ç‚¹å·¦å­æ ‘æˆ–å³å­æ ‘çš„æŒ‡å‘
    if(rightChild != null){
        rightChild.parent = grand;
    }
    grand.parent = parent;
    //æ›´æ–°é«˜åº¦ï¼Œå…ˆæ¯”è¾ƒçŸ®çš„ç»“ç‚¹å†æ›´æ–°è¾ƒé«˜çš„ç»“ç‚¹
    updateHeight(grand);
    updateHeight(parent);
}
```

å…¶å®æˆ‘ä»¬ä¼šå‘ç°è¿™ä¸¤æ®µä»£ç é‡å¤åº¦å¾ˆé«˜ï¼Œæˆ‘ä»¬å°†å…±æœ‰ä»£ç æå–ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œæ—‹è½¬çš„å®Œæ•´ä»£ç ä¸ºï¼š

```java
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå·¦æ—‹è½¬
 * @param grand å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateLeft(Node<E> grand){
    //è·å¾—parentç»“ç‚¹
    Node<E> parent = grand.right;
    //å°†parentçš„å·¦å­ç»“ç‚¹å–å‡º
    Node<E> leftChild = parent.left;
    //å·¦æ—‹
    grand.right = leftChild;
    parent.left = grand;
    //æ—‹è½¬ä¹‹åè®©parentç»“ç‚¹æˆä¸ºæ ¹ç»“ç‚¹å¹¶æ›´æ–°grandã€parentã€childç»“ç‚¹çš„é«˜åº¦
    afterRotate(grand,parent,leftChild);
}
/**
 * å¯¹è¯¥å…ƒç´ è¿›è¡Œå³æ—‹è½¬
 * @param grand å¾…æ—‹è½¬çš„ç»“ç‚¹
 */
private void rotateRight(Node<E> grand){
    //è·å¾—parentç»“ç‚¹,å³grandç»“ç‚¹çš„å·¦ç»“ç‚¹
    Node<E> parent = grand.left;
    //è·å¾—parentç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œæ–¹ä¾¿åé¢æ›´æ–°é«˜åº¦
    Node<E> rightChild = parent.right;
    //å³æ—‹
    grand.left = rightChild;
    parent.right = grand;
    //æ—‹è½¬ä¹‹åè®©parentç»“ç‚¹æˆä¸ºæ ¹ç»“ç‚¹å¹¶æ›´æ–°grandã€parentã€childç»“ç‚¹çš„é«˜åº¦
    afterRotate(grand,parent,rightChild);
}
/**
 * æ—‹è½¬ä¹‹åè®©parentç»“ç‚¹æˆä¸ºæ ¹ç»“ç‚¹å¹¶æ›´æ–°grandã€parentã€childç»“ç‚¹çš„é«˜åº¦
 */
private void afterRotate(Node<E> grand,Node<E> parent,Node<E> child){
    /*
     * è®©parentç»“ç‚¹æˆä¸ºå½“å‰å­æ ‘çš„æ ¹ç»“ç‚¹
     * è¿™é‡Œæœ‰ä¸¤æ­¥ï¼š
     *  1. è®©parentçš„çˆ¶ç»“ç‚¹æŒ‡å‘grandçš„çˆ¶ç»“ç‚¹
     *  2. è®©grandçˆ¶ç»“ç‚¹æœ¬æ¥æŒ‡å‘grandçš„æŒ‡é’ˆæŒ‡å‘parent,è¿™é‡Œé¡ºä¾¿æ›´æ–°äº†parentç»“ç‚¹çš„çˆ¶ç»“ç‚¹
     **/
    parent.parent = grand.parent;
    if(grand.isLeftChild()){
        grand.parent.left = parent;
    }else if(grand.isRightChild()){
        grand.parent.right = parent;
    }else {
        //å½“å‰ç»“ç‚¹æ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œå³grandç»“ç‚¹å°±æ˜¯rootç»“ç‚¹
        root = parent;
    }
    /*
     * ä¸€å…±éœ€è¦æ›´æ–°ä¸‰ä¸ªç»“ç‚¹çš„parentï¼Œgrandã€parentå’ŒleftChildç»“ç‚¹
     * grandç»“ç‚¹åœ¨ä¸Šé¢ç¬¬äºŒæ­¥ä¸­å·²ç»æ›´æ–°äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°parentç»“ç‚¹å’ŒleftChildç»“ç‚¹çš„parentç»“ç‚¹
     **/
    if(child != null){
        child.parent = grand;
    }
    //æ›´æ–°grandçš„parentç»“ç‚¹
    grand.parent = parent;
    //æ›´æ–°é«˜åº¦ï¼Œå…ˆæ¯”è¾ƒçŸ®çš„ç»“ç‚¹å†æ›´æ–°è¾ƒé«˜çš„ç»“ç‚¹
    updateHeight(grand);
    updateHeight(parent);
}
```

### 7.3 æµ‹è¯•

æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªå¯ä»¥å°†äºŒå‰æ ‘æ‰“å°å‡ºæ¥çš„å°è£…å¥½çš„å·¥å…·åŒ…ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨å®ƒè¿›è¡Œæµ‹è¯•

æˆ‘ä»¬é¦–å…ˆåœ¨<a href="https://520it.com/binarytrees/">ä¸‹é¢çš„ç½‘ç«™</a>ä¸Šéšæœºç”Ÿæˆä¸€äº›ç»“ç‚¹å¹¶æ„æˆAVLæ ‘

![image-20220408002415279](https://cdn.fengxianhub.top/resources-master/202204080024527.png)

ç„¶åä¸€ä¸‹æµ‹è¯•ä»£ç ï¼Œå°†éšæœºç”Ÿæˆçš„æ•°å­—æ·»åŠ åˆ°è‡ªå·±çš„AVLæ ‘ä¸­

```java
@Test
public void test01() {
    Integer[] data = {
            17, 29, 40, 48, 97, 59, 65, 39, 25, 94, 43, 91, 37, 64, 13, 66, 53, 28, 34
    };
    AVLTree<Integer> avl = new AVLTree<>();
    for(int i : data){
        avl.add(i);
    }
    //è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å°†æ ‘æ‰“å°å‡ºæ¥çš„å·¥å…·ï¼Œä»£ç æœ‰ç‚¹å¤šå°±ä¸è´´å‡ºæ¥äº†ï¼Œå¯ä»¥æ»´æ»´æˆ‘ç§å‘
    BinaryTrees.println(avl);
}
```

è¾“å‡ºç»“æœï¼š

![image-20220408002620243](https://cdn.fengxianhub.top/resources-master/202204080026424.png)

å°†æ¯ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹å’Œé«˜åº¦ä¹Ÿä¸€èµ·è¾“å‡ºå‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°é«˜åº¦ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š

![image-20220408004800602](https://cdn.fengxianhub.top/resources-master/202204080048724.png)

## 8. æ·»åŠ æ“ä½œçš„ç»Ÿä¸€å¹³è¡¡å¤„ç†

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é‡‡å–çš„æ–¹å¼æ˜¯æ¯æ·»åŠ ä¸€ä¸ªç»“ç‚¹éƒ½ä¼šè¿›è¡Œå¹³è¡¡åˆ¤æ–­å¹¶æ›´æ–°ç»“ç‚¹çš„é«˜åº¦ï¼Œæˆ‘ä»¬å…¶å®è¿˜æœ‰ä¸€ç§åšæ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»åˆ¤æ–­LLã€RRæˆ–è€…åŒæ—‹çš„æƒ…å†µï¼Œ**æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä»½ä»£ç è¿›è¡Œç»Ÿä¸€çš„å¹³è¡¡å¤„ç†**

æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹æ‰€æœ‰å¤±å»å¹³è¡¡çš„æƒ…å†µï¼š

è¿™é‡Œæˆ‘å°†æ‰€æœ‰çš„ç»“ç‚¹ä»å·¦å¾€å³æŒ‰å­—æ¯è¡¨è¿›è¡Œæ ‡å·ï¼Œæ ¹æ®BSTæ€§è´¨æˆ‘ä»¬çŸ¥é“ï¼šg > f > e > d > c > b > a

![image-20220408102524684](https://cdn.fengxianhub.top/resources-master/202204081025844.png)

ä»–ä»¬ä¿®å¤å¹³è¡¡åçš„çŠ¶æ€ä¸ºï¼š

![image-20220408102632766](https://cdn.fengxianhub.top/resources-master/202204081026913.png)

>æˆ‘ä»¬å¯ä»¥æƒŠå¥‡çš„å‘ç°ï¼Œæ‰€æœ‰ä¸å¹³è¡¡çš„æƒ…å†µï¼Œå¹³è¡¡ä¹‹åçš„çŠ¶æ€éƒ½æ˜¯ä¸€æ ·çš„ï¼
>
>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°å¾…å¹³è¡¡çš„äºŒå‰æ ‘çš„å¯¹åº”ç»“ç‚¹å³å¯

è¿™é‡Œæˆ‘ä»¬ç»Ÿä¸€æ“ä½œçš„æ­¥éª¤ä¸ºï¼š

```java
è®©dæˆä¸ºæ•´æ£µå­æ ‘çš„æ ¹ç»“ç‚¹
å¤„ç†dçš„å·¦å­æ ‘ï¼Œå³a-b-cç»“ç‚¹
å¤„ç†dçš„å³å­æ ‘ï¼Œå³e-f-gç»“ç‚¹
å¤„ç†b-d-fç»“ç‚¹
```

>æˆ‘ä»¬åœ¨ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ä¼šå‘ç°ï¼Œå…¶å®ç»“ç‚¹`a`å’Œç»“ç‚¹`g`æ— è®ºæ€ä¹ˆé€‰æ‹©å…¶parentç»“ç‚¹åŠå…¶parentç»“ç‚¹çš„æŒ‡å‘éƒ½æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¤„ç†çš„æ—¶å€™å¯ä»¥ä¸å¤„ç†è¿™ä¸¤ä¸ªç»“ç‚¹ï¼Œåœ¨çº¢é»‘æ ‘ä¸­ä¹Ÿä¸ç”¨å¤„ç†è¿™ä¸¤ä¸ªç»“ç‚¹ï¼Œä½†ä¸ºäº†è®©ä»£ç æ›´åŠ ç›´è§‚ï¼Œä¸‹é¢æˆ‘å®ç°çš„ä»£ç è¿˜æ˜¯å¯¹è¿™ä¸¤ä¸ªç»“ç‚¹è¿›è¡Œäº†å¤„ç†

ä»£ç å®ç°ä¸€ä¸‹ï¼š

```java
/**
 * è¿›è¡Œç»Ÿä¸€æ—‹è½¬å¤„ç†
 *
 * @param r æ ¹ç»“ç‚¹
 */
private void rotate(Node<E> r,  //å­æ ‘çš„æ ¹ç»“ç‚¹
                    Node<E> a,
                    Node<E> b,
                    Node<E> c,
                    Node<E> d,
                    Node<E> e,
                    Node<E> f,
                    Node<E> g) {
    //è®©dæˆä¸ºè¿™æ£µæ ‘çš„æ ¹ç»“ç‚¹
    d.parent = r.parent;
    if (r.isLeftChild()) {
        r.parent.left = d;
    } else if (r.isRightChild()) {
        r.parent.right = d;
    } else {
        //ræ²¡æœ‰çˆ¶ç»“ç‚¹
        root = d;
    }
    //å¤„ç†dçš„å·¦å­æ ‘ï¼Œå³a-b-cç»“ç‚¹
    b.right = c;
    if (c != null) {
        c.parent = b;
    }
    b.left = a;
    if (a != null) {
        a.parent = b;
    }
    //æ›´æ–°bç»“ç‚¹çš„é«˜åº¦
    updateHeight(b);
    //å¤„ç†dçš„å³å­æ ‘ï¼Œå³e-f-gç»“ç‚¹
    f.right = g;
    if (g != null) {
        g.parent = f;
    }
    f.left = e;
    if (e != null) {
        e.parent = f;
    }
    //æ›´æ–°fç»“ç‚¹çš„é«˜åº¦
    updateHeight(f);
    //ç°åœ¨å¤„ç†b-d-fç»“ç‚¹
    d.left = b;
    d.right = f;
    b.parent = d;
    f.parent = d;
    //dçš„å·¦å³å­æ ‘ç»“ç‚¹é«˜åº¦éƒ½æ›´æ–°äº†ï¼Œdçš„é«˜åº¦ä¹Ÿéœ€è¦æ›´æ–°
    updateHeight(d);
}
```

åœ¨è®©æ ‘æ¢å¤å¹³è¡¡çš„`reBalance`æ–¹æ³•ä¸­è¿›è¡Œç»Ÿä¸€å¹³è¡¡å¤„ç†ï¼Œå¯ä»¥å¯¹ç€ä¸Šé¢çš„å›¾å°†ç»“ç‚¹ä¼ å…¥å³å¯ï¼

```java
/**
     * è®©å½“å‰AVLæ ‘æ¢å¤å¹³è¡¡
     *
     * @param grand ç¦»æ·»åŠ ç»“ç‚¹æœ€è¿‘çš„ä¸å¹³è¡¡çš„ç»“ç‚¹
     */
private void reBalance(Node<E> grand) {
    //åˆ†åˆ«è·å¾—parentç»“ç‚¹å’Œnodeç»“ç‚¹
    Node<E> parent = ((AVLNode<E>) grand).tallerChild();
    Node<E> node = ((AVLNode<E>) parent).tallerChild();
    //å…ˆåˆ¤æ–­LLå³æ—‹è½¬çš„æƒ…å†µ
    if (parent.isLeftChild()) { //L
        if (node.isLeftChild()) {  //LL
            //                rotateRight(grand);
            rotate(grand,node.left,node,node.right,parent,parent.right,grand,grand.right);
        } else {  //LR
            //                rotateLeft(parent);
            //                rotateRight(grand);
            rotate(grand,parent.left,parent,node.left,node,node.right,grand,grand.right);
        }
    } else {  //R
        if (node.isLeftChild()) {  //RL
            //                rotateRight(parent);
            //                rotateLeft(grand);
            rotate(grand,grand.left,grand,node.left,node,node.right,parent,parent.right);
        } else {  //RR
            //                rotateLeft(grand);
            rotate(grand,grand.left,grand,parent.left,parent,node.left,node,node.right);
        }
    }
}
```

æµ‹è¯•ä¸€ä¸‹ï¼

![image-20220408115518177](https://cdn.fengxianhub.top/resources-master/202204081155310.png)

## 9. ä»£ç å®ç°AVLæ ‘åˆ é™¤å…ƒç´ 

æˆ‘ä»¬åœ¨6.7ä¸­æåˆ°è¿‡ï¼Œåœ¨åˆ é™¤å…ƒç´ å¯¼è‡´çš„å¤±è¡¡ä¸­ï¼Œä¸èƒ½è®©æ•´æ£µæ ‘çš„é«˜åº¦å‡å°‘ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä»£ç å®ç°ä¸€ä¸‹

è·Ÿæ·»åŠ ç»“ç‚¹æ—¶çš„æ“ä½œä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨AVLæ ‘çš„çˆ¶ç±»`BinarySearchTree`åˆ é™¤ç»“ç‚¹æ—¶ä¹Ÿè¦æ·»åŠ ä¸€ä¸ªæ–¹æ³•

```java
/**
 * åˆ é™¤ç»“ç‚¹æ—¶åˆ¤æ–­æ˜¯å¦è¿›è¡Œå¹³è¡¡
 * @param node åˆ é™¤çš„ç»“ç‚¹
 */
protected void afterRemove(Node<E> node){
}
```

æˆ‘ä»¬éœ€è¦åœ¨`remove`æ–¹æ³•ä¸­æ’å…¥`afterRemove`æ–¹æ³•è¿›è¡Œåˆ é™¤å…ƒç´ ååˆ¤æ–­æ˜¯å¦éœ€è¦å¹³è¡¡BST

æ’å…¥çš„ä½ç½®å¾ˆå€¼å¾—æ¨æ•²ï¼Œé¦–å…ˆæˆ‘ä»¬çŸ¥é“åˆ é™¤çš„ç»“ç‚¹å¯èƒ½æ˜¯åº¦ä¸º0ã€1ã€2çš„ç»“ç‚¹ï¼Œä½†æ˜¯åˆ é™¤åº¦ä¸º2çš„ç»“ç‚¹å®é™…ä¸Šæ˜¯åˆ é™¤å…¶å‰é©±æˆ–è€…åç»§ç»“ç‚¹ï¼Œè¿™æ ·å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹æˆ‘ä»¬åˆ°åº•è¦ä¼ å…¥çš„å…ƒç´ æ˜¯å“ªä¸€ä¸ªäº†ï¼Œæˆ‘ä»¬è¿™é‡Œæ’å…¥çš„åœ°æ–¹æ˜¯removeå‡½æ•°çš„æœ€åé¢ï¼Œç­‰å¾…åˆ é™¤çš„ç»“ç‚¹çœŸæ­£è¢«åˆ é™¤ä¹‹åï¼Œæˆ‘ä»¬å†æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ¢å¤å¹³è¡¡çš„æ“ä½œ

æˆ‘ä»¬åœ¨AVLTreeä¸­é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºçˆ¶ç»“ç‚¹ä¹Ÿå¯èƒ½ä¼šå¤±å»å¹³è¡¡ï¼Œæ‰€ä»¥æ‰€æœ‰çš„çˆ¶ç»“ç‚¹éƒ½è¦è¿›è¡Œåˆ¤æ–­

ä»£ç å°±å¾ˆç®€å•äº†ï¼Œåªæ˜¯æ¯”ä¸Šé¢æ·»åŠ åˆ¤æ–­å°‘äº†ä¸€è¡Œ`break`çš„ä»£ç ï¼Œå› ä¸ºå…¶çˆ¶ç»“ç‚¹ä¹Ÿå¯èƒ½ä¼šå¤±å»å¹³è¡¡

```java
/**
 * åˆ é™¤å…ƒç´ è¿›è¡Œå¹³è¡¡
 * @param node åˆ é™¤çš„ç»“ç‚¹
 */
@Override
protected void afterRemove(Node<E> node) {
    //åœ¨å…¶ç¥–çˆ¶ç»“ç‚¹ä¸­å¯»åˆ°æœ€è¿‘çš„å¤±è¡¡ç»“ç‚¹
    while ((node = node.parent) != null) {
        //åˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦å¹³è¡¡
        if (isBalanced(node)) {
            //å¹³è¡¡ï¼Œæ›´æ–°è¯¥ç»“ç‚¹çš„é«˜åº¦
            updateHeight(node);
        } else {
            //ä¸å¹³è¡¡ï¼Œè¯¥ç»“ç‚¹ä¸ºç¦»æ·»åŠ ç»“ç‚¹æœ€è¿‘çš„ä¸å¹³è¡¡çš„ç»“ç‚¹
            reBalance(node);
        }
    }
}
```

**æµ‹è¯•ä¸€ä¸‹**ï¼š

æˆ‘ä»¬å‡†å¤‡ä¸€æ£µAVLç„¶ååˆ é™¤ä¸€äº›æ•°æ®

![image-20220408162405602](https://cdn.fengxianhub.top/resources-master/202204081624745.png)



æµ‹è¯•ä»£ç 

```java
@Test
public void test01() {
    Integer[] data = {
            17, 29, 40, 48, 97, 59, 65
    };
    AVLTree<Integer> avl = new AVLTree<>();
    for(int i : data){
        avl.add(i);
    }
    avl.remove(97);
    avl.remove(59);
    avl.remove(65);
    BinaryTrees.println(avl);
}
```

è¾“å‡ºç»“æœï¼š

![image-20220408162523684](https://cdn.fengxianhub.top/resources-master/202204081625843.png)

å¯ä»¥çœ‹åˆ°åˆ é™¤å…ƒç´ åä¹Ÿèƒ½æ¢å¤å¹³è¡¡

## 10. æ€»ç»“

![image-20220408163155272](https://cdn.fengxianhub.top/resources-master/202204081631433.png)























