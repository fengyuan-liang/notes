# ä¸ºé˜¿é‡Œäº‘åŸŸåé…ç½®æ³›è§£æSSLè¯ä¹¦å¹¶è‡ªåŠ¨åˆ·æ–°

æœ€è¿‘é˜¿é‡Œäº‘å…è´¹çš„SSLè¿‡æœŸäº†ï¼Œéœ€è¦æ›´æ¢ï¼Œæ‰“å¼€æ§åˆ¶å°ä¸€çœ‹ï¼Œå¥½å®¶ä¼™ï¼Œå±…ç„¶å·²ç»ç”¨å®Œäº†ğŸ˜±

![image-20231210235422273](https://cdn.fengxianhub.top/resources-master/image-20231210235422273.png)

è€Œä¸”é˜¿é‡Œäº‘è¯ä¹¦æœ‰å‡ ä¸ªç—›ç‚¹ï¼š

- ä¸€å¹´åˆ·æ–°ä¸€æ¬¡ï¼Œä¸èƒ½è‡ªåŠ¨æ›´æ–°
- å…è´¹çš„æ²¡æœ‰æ³›è§£æè¯ä¹¦ï¼Œæ¯ä¸ªåŸŸåä¸€ä¸ªè¯ä¹¦æœ‰ç‚¹éº»çƒ¦
- å…è´¹è¯ä¹¦æœ‰é™

åŸºäºä»¥ä¸Šç—›ç‚¹ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨å¼€æºå…è´¹çš„æ³›è§£æè¯ä¹¦

- åŸºäºdockerå®¹å™¨è¿›è¡Œä¸€é”®éƒ¨ç½²ï¼ˆå¯ä»¥è‡ªåŠ¨åˆ·æ–°ï¼‰ï¼Œå¹¶ä¸”å¼‚å¸¸æƒ…å†µä¼šé‚®ä»¶è¿›è¡Œé€šçŸ¥
- ä½¿ç”¨`Let's Encrypt`æˆ–è€…`ZeroSSL`çš„æ³›è§£æè¯ä¹¦
- æ³›è§£æè¯ä¹¦ç†è®ºä¸Šæ²¡æœ‰é™åˆ¶

>ä¸‹é¢æ˜¯ä»‹ç»ï¼Œå¯ä»¥è·³è¿‡ğŸ˜

å¸‚é¢ä¸Šä¸»æµçš„è¯ä¹¦ç”Ÿæˆå·¥å…·æœ‰ `certbot`ã€`acme.sh`ã€`acme-tiny`ï¼Œå…¶ä¸­[acme.sh](https://github.com/acmesh-official/acme.sh)ç”³è¯·æ³›è§£æè¯ä¹¦æœ€ä¸ºæ–¹ä¾¿

å¸‚é¢ä¸Šä½¿ç”¨æœ€å¤šçš„å…è´¹æ³›è§£æè¯ä¹¦æ˜¯`Let's Encrypt`å®¶çš„ï¼Œ[acme.sh](https://link.zhihu.com/?target=http%3A//acme.sh) v3.0ä¹‹å‰é»˜è®¤ç”³è¯·çš„ä¹Ÿæ˜¯è¿™å®¶çš„è¯ä¹¦ï¼Œä½†æ˜¯åœ¨[acme.sh](https://link.zhihu.com/?target=http%3A//acme.sh) v3.0ä¹‹åï¼Œé»˜è®¤ç”³è¯·çš„è¯ä¹¦æ˜¯`ZeroSSL`ï¼Œ[ZeroSSL](https://app.zerossl.com/)åŒæ ·å¯ä»¥ç”³è¯·`90`å¤©çš„å…è´¹æ³›è§£æè¯ä¹¦ï¼Œç›¸è¾ƒäº`Let's Encrypt`ï¼ŒZeroSSLæä¾›äº†ä¸€ä¸ªç®¡ç†ç•Œé¢å¯ä»¥ç®¡ç†æˆ‘ä»¬çš„è¯ä¹¦ï¼Œå¹¶ä¸”æä¾›apiå¯ä»¥è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå¯ç©æ€§æ–¹é¢æ¯”Let's Encryptæ›´å¤šä¸€äº›ï¼›ç¼ºç‚¹æ˜¯ç¨³å®šæ€§æ–¹é¢å¯èƒ½æ²¡æœ‰è€ç‰ŒLet's Encryptè¯ä¹¦å¥½ï¼Œä½†æ˜¯ç¬”è€…å¹¶æ²¡æœ‰é‡åˆ°è¿‡ï¼›å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Let's EncryptğŸˆ



## dockerå®¹å™¨ä¸€é”®éƒ¨ç½²

>ä¸ºäº†æ–¹ä¾¿ä½ æˆ‘ä»–ï¼Œç¬”è€…æ„å»ºäº†dockerå®¹å™¨è¿›è¡Œä¸€é”®éƒ¨ç½²ï¼Œå¹¶ä¸”èƒ½é€šè¿‡é‚®ä»¶å¯¹è¯ä¹¦å¼‚å¸¸è¿›è¡Œè‡ªåŠ¨é€šçŸ¥
>
>è¿™é‡Œåˆ†ä¸ºä¸¤æ­¥
>
>- è‡ªåŠ¨ä½¿ç”¨`acme.sh`åˆ·æ–°è¯ä¹¦
>- è‡ªåŠ¨è°ƒç”¨é˜¿é‡Œäº‘APIæ›´æ–°OSSè¯ä¹¦

```shell
version: '3'
services:
  acme-sh:
    image: neilpang/acme.sh
    container_name: acme.sh
    restart: always
    command: daemon
    environment:
      - Ali_Key="xxxxx"
      - Ali_Secret="xxxxx"
    volumes:
      - ./acme/out:/acme.sh
    network_mode: host
```

**å¯åŠ¨å®¹å™¨**

```shell
$ docker-compose -f docker-compose-acme.sh.yaml -p acme.sh up -d
```

**ç”³è¯·SSLè¯ä¹¦**

```shell
1ã€é¦–å…ˆå°†é»˜è®¤è¯ä¹¦æœåŠ¡å™¨åˆ‡æ¢ä¸º letsencrypt
docker exec acme.sh acme.sh --set-default-ca --server letsencrypt

# --debug å¯ä»¥å»æ‰ï¼Œæˆ‘ä»¬åŠ ä¸Šèƒ½ç›´æ¥æ‰“å°å‡ºæ¯ä¸€æ­¥è¯¦ç»†æ—¥å¿—ï¼Œå¦‚æœå‡ºé”™çš„è¯å¯ä»¥çŸ¥é“åœ¨å“ªä¸€æ­¥å‡ºé”™
# -d åé¢æ¢æˆä½ è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥ä½¿ç”¨*å· æ³›æŒ‡æ‰€æœ‰å­åŸŸå,eg *.3658k.com
docker exec acme.sh  --issue  --dns dns_ali -d example.com -d *.example.com --debug
# å…¶ä»–äº‘å‚å•† ä¾‹å¦‚è…¾è®¯äº‘åªéœ€è¦ä¿®æ”¹--dns dns_dp 
```

**è®¾ç½® crontab ä»»åŠ¡è‡ªåŠ¨ç»­ç­¾**

åœ¨å®¿ä¸»ä¸»æœºçš„crontaï¼Œæ·»åŠ ä¸€æ¡å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©è®©acmeå®¹å™¨å»è‡ªåŠ¨æ£€æŸ¥ä¸‹é‚£äº›åŸŸåè¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œacmeä¼šè‡ªåŠ¨ç»­ç­¾,è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒè¯ä¹¦è¿‡æœŸäº†

`crontab -e` æ·»åŠ ä¸€ä¸‹å†…å®¹

```shell
0 0 * * * docker exec acme.sh --cron
```

**å‡çº§ acme**

æœ‰çš„æ—¶å€™ç»­ç­¾å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦å‡çº§ä¸€ä¸‹acmeçœ‹èƒ½ä¸èƒ½è‡ªåŠ¨è§£å†³äº†

```shell
docker exec acme.sh acme.sh --upgrade
```















